{"version":3,"file":"webrtmp.worker.js","mappings":"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","sources":["webpack://webrtmp/./utils/logger.js","webpack://webrtmp/./utils/utils.js","webpack://webrtmp/./rtmp/RTMPMessage.js","webpack://webrtmp/./rtmp/Chunk.js","webpack://webrtmp/./rtmp/UserControlMessage.js","webpack://webrtmp/./rtmp/ProtocolControlMessage.js","webpack://webrtmp/./rtmp/NetConnection.js","webpack://webrtmp/./utils/exception.js","webpack://webrtmp/./formats/media-info.js","webpack://webrtmp/./utils/utf8-conv.js","webpack://webrtmp/./flv/amf-parser.js","webpack://webrtmp/./flv/sps-parser.js","webpack://webrtmp/./flv/exp-golomb.js","webpack://webrtmp/./formats/mp4.js","webpack://webrtmp/./formats/media-segment-info.js","webpack://webrtmp/./formats/aac-silent.js","webpack://webrtmp/./utils/browser.js","webpack://webrtmp/./rtmp/AMF0Object.js","webpack://webrtmp/./wss/connection.worker.js","webpack://webrtmp/./wss/WSSConnectionManager.js","webpack://webrtmp/./rtmp/RTMPHandshake.js","webpack://webrtmp/./rtmp/RTMPMessageHandler.js","webpack://webrtmp/./rtmp/ChunkParser.js","webpack://webrtmp/./rtmp/RTMPMediaMessageHandler.js","webpack://webrtmp/./flv/transmuxer.js","webpack://webrtmp/./utils/event_emitter.js","webpack://webrtmp/./formats/mp4-remuxer.js"],"sourcesContent":["/*\n * Copyright (C) 2016 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nclass Log {\n    static OFF = -1;\n    static TRACE = 0;\n    static DEBUG = 1;\n    static INFO = 2;\n    static WARN = 3;\n    static ERROR = 4;\n    static CRITICAL = 5;\n    static WITH_STACKTRACE = true;\n\n    static LEVEL = Log.INFO;\n\n    /**\n     * Array with [ClassName, Loglevel]\n     * @type {[]}\n     */\n    static loglevels = [];\n\n    /**\n     *\n     * @param {Number} level\n     * @param {String} tag\n     * @param txt\n     * @private\n     */\n    static _output = function output(level, tag, ...txt){\n        let tmpLevel = Log.LEVEL;\n\n        if(Log.loglevels[tag]) tmpLevel = Log.loglevels[tag];\n\n        if(tmpLevel === Log.OFF) return;\n        if(tmpLevel > level) return;\n\n        const callstack = Log._getStackTrace();\n\n        // debug aufruf entfernen\n        callstack.shift();\n        callstack.shift();\n\n        let color = \"color: silver\";\n\n        switch(level) {\n            case Log.TRACE:\t// TRACE\n                color = \"background-color: gray\";\n                break;\n\n            case Log.DEBUG:\t// DEBUG\n                break;\n\n            case Log.INFO:\t// INFO\n                color = \"color: green\";\n                break;\n\n            case Log.WARN:\t// WARN\n                color = \"color: orange; background-color: #EAA80035\";\n                break;\n\n            case Log.ERROR:\t// ERROR\n                color = \"color: red; background-color: #FF000020\";\n                break;\n\n            case Log.CRITICAL:\t// CRITICAL\n                color = \"color: red\";\n                break;\n        }\n\n        Log._print(callstack, color, tag, ...txt);\n    };\n\n    /**\n     * Internal for console dump\n     * @param {String[]} callstack\n     * @param {String} color\n     * @param {String} tag\n     * @param txt\n     * @private\n     */\n    static _print(callstack, color, tag, ...txt){\n        if(Log.WITH_STACKTRACE){\n            if(Log.LEVEL === Log.ERROR){\n                console.group(\"%c[\" + tag + \"]\", color, ...txt);\n            } else {\n                console.groupCollapsed(\"%c[\" + tag + \"]\", color, ...txt);\n            }\n\n            for(let i = 0; i < callstack.length; i++) {\n                console.log(\"%c\" + callstack[i], color);\n            }\n\n            console.groupEnd();\n\n        } else {\n            console.log(\"%c[\" + tag + \"]\", color, ...txt)\n        }\n    }\n\n    /**\n     * Get Callstack\n     * @returns {String[]}\n     * @private\n     */\n    static _getStackTrace = function() {\n        let callstack = [];\n\n        try {\n            i.dont.exist+=0; //doesn't exist- that's the point\n\n        } catch(e) {\n            if (e.stack) { //Firefox\n                let lines = e.stack.split('\\n');\n\n                for (let i=0; i < lines.length; i++) {\n                    callstack.push(lines[i]);\n                }\n\n                //Ersten Eintrag entfernen\n                callstack.shift();\n                callstack.shift();\n            }\n        }\n\n        return(callstack);\n    };\n\n    /**\n     * Log Critical\n     * @param {String} tag\n     * @param msg\n     */\n    static c(tag, ...msg) {\n        Log._output(Log.CRITICAL, tag, ...msg);\n    }\n\n    /**\n     * Log Error\n     * @param {String} tag\n     * @param msg\n     */\n    static e(tag, ...msg) {\n        Log._output(Log.ERROR, tag, ...msg);\n    }\n\n    /**\n     * Log Info\n     * @param {String} tag\n     * @param msg\n     */\n    static i(tag, ...msg) {\n        Log._output(Log.INFO, tag, ...msg);\n    }\n\n    /**\n     * Log Warning\n     * @param {String} tag\n     * @param msg\n     */\n    static w(tag, ...msg) {\n        Log._output(Log.WARN, tag, ...msg);\n    }\n\n    /**\n     * Log Debug\n     * @param {String} tag\n     * @param msg\n     */\n    static d(tag, ...msg) {\n        Log._output(Log.DEBUG, tag, ...msg);\n    }\n\n    /**\n     * Log Debug\n     * @param {String} tag\n     * @param msg\n     */\n    static v(tag, ...msg) {\n        Log._output(Log.DEBUG, tag, ...msg);\n    }\n\n    /**\n     * Log Trace\n     * @param {String} tag\n     * @param msg\n     */\n    static t(tag, ...msg) {\n        Log._output(Log.TRACE, tag, ...msg);\n    }\n}\n\nexport default Log;\n","\n/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\n/**\n *\n * @param {Uint8Array} bufs\n * @returns {Uint8Array}\n */\n\nexport function _concatArrayBuffers(...bufs){\n    const result = new Uint8Array(bufs.reduce((totalSize, buf)=>totalSize+buf.byteLength,0));\n    bufs.reduce((offset, buf)=>{\n        result.set(buf,offset)\n        return offset+buf.byteLength\n    },0)\n\n    return result;\n}\n\n/**\n *\n * @param {String} str\n * @returns {*[]}\n * @private\n */\nexport function _stringToByteArray(str) {\n    const bytes = [];\n\n    for(let i = 0; i < str.length; i++) {\n        const char = str.charCodeAt(i);\n        if(char > 0xFF) {\n            bytes.push(char >>> 8);\n        }\n\n        bytes.push(char & 0xFF);\n    }\n    return bytes;\n}\n\n/**\n *\n * @param {Number} num\n * @returns {*[]}\n * @private\n */\nexport function _numberToByteArray(num) {\n    const buffer = new ArrayBuffer(8);\n    new DataView(buffer).setFloat64(0, num, false);\n    return [].slice.call(new Uint8Array(buffer));\n}\n\n/**\n *\n * @param {byte[]} ba\n * @returns {number}\n * @private\n */\nexport function _byteArrayToNumber(ba){\n    let buf = new ArrayBuffer(ba.length);\n    let view = new DataView(buf);\n\n    ba.forEach(function (b, i) {\n        view.setUint8(i, b);\n    });\n\n    return view.getFloat64(0);\n}\n\n/**\n *\n * @param {byte[]} ba\n * @returns {string}\n * @private\n */\nexport function _byteArrayToString(ba){\n    let ret = \"\";\n\n    for(let i = 0; i < ba.length; i++){\n        ret += String.fromCharCode(ba[i]);\n    }\n\n    return ret;\n}\n\nexport const defaultConfig = {\n    enableWorker: false,\n    enableStashBuffer: true,\n    stashInitialSize: undefined,\n\n    isLive: true,\n\n    lazyLoad: true,\n    lazyLoadMaxDuration: 3 * 60,\n    lazyLoadRecoverDuration: 30,\n    deferLoadAfterSourceOpen: true,\n\n    autoCleanupSourceBuffer: true,\n    autoCleanupMaxBackwardDuration: 3 * 60,\n    autoCleanupMinBackwardDuration: 2 * 60,\n\n    statisticsInfoReportInterval: 600,\n\n    fixAudioTimestampGap: true,\n\n    accurateSeek: false,\n    seekType: 'range',  // [range, param, custom]\n    seekParamStart: 'bstart',\n    seekParamEnd: 'bend',\n    rangeLoadZeroStart: false,\n    customSeekHandler: undefined,\n    reuseRedirectedURL: false,\n    // referrerPolicy: leave as unspecified\n\n    headers: undefined,\n    customLoader: undefined\n};\n\n\nexport const TransmuxingEvents = {\n    IO_ERROR: 'io_error',\n    DEMUX_ERROR: 'demux_error',\n    INIT_SEGMENT: 'init_segment',\n    MEDIA_SEGMENT: 'media_segment',\n    LOADING_COMPLETE: 'loading_complete',\n    RECOVERED_EARLY_EOF: 'recovered_early_eof',\n    MEDIA_INFO: 'media_info',\n    METADATA_ARRIVED: 'metadata_arrived',\n    SCRIPTDATA_ARRIVED: 'scriptdata_arrived',\n    STATISTICS_INFO: 'statistics_info',\n    RECOMMEND_SEEKPOINT: 'recommend_seekpoint'\n};\n\nexport const DemuxErrors = {\n    OK: 'OK',\n    FORMAT_ERROR: 'FormatError',\n    FORMAT_UNSUPPORTED: 'FormatUnsupported',\n    CODEC_UNSUPPORTED: 'CodecUnsupported'\n};\n\nexport const MSEEvents = {\n    ERROR: 'error',\n    SOURCE_OPEN: 'source_open',\n    UPDATE_END: 'update_end',\n    BUFFER_FULL: 'buffer_full'\n};\n\nexport const PlayerEvents = {\n    ERROR: 'error',\n    LOADING_COMPLETE: 'loading_complete',\n    RECOVERED_EARLY_EOF: 'recovered_early_eof',\n    MEDIA_INFO: 'media_info',\n    METADATA_ARRIVED: 'metadata_arrived',\n    SCRIPTDATA_ARRIVED: 'scriptdata_arrived',\n    STATISTICS_INFO: 'statistics_info'\n};\n\nexport const ErrorTypes = {\n    NETWORK_ERROR: 'NetworkError',\n    MEDIA_ERROR: 'MediaError',\n    OTHER_ERROR: 'OtherError'\n};\n\nexport const LoaderErrors = {\n    OK: 'OK',\n    EXCEPTION: 'Exception',\n    HTTP_STATUS_CODE_INVALID: 'HttpStatusCodeInvalid',\n    CONNECTING_TIMEOUT: 'ConnectingTimeout',\n    EARLY_EOF: 'EarlyEof',\n    UNRECOVERABLE_EARLY_EOF: 'UnrecoverableEarlyEof'\n};\n\nexport const ErrorDetails = {\n    NETWORK_EXCEPTION: LoaderErrors.EXCEPTION,\n    NETWORK_STATUS_CODE_INVALID: LoaderErrors.HTTP_STATUS_CODE_INVALID,\n    NETWORK_TIMEOUT: LoaderErrors.CONNECTING_TIMEOUT,\n    NETWORK_UNRECOVERABLE_EARLY_EOF: LoaderErrors.UNRECOVERABLE_EARLY_EOF,\n\n    MEDIA_MSE_ERROR: 'MediaMSEError',\n\n    MEDIA_FORMAT_ERROR: DemuxErrors.FORMAT_ERROR,\n    MEDIA_FORMAT_UNSUPPORTED: DemuxErrors.FORMAT_UNSUPPORTED,\n    MEDIA_CODEC_UNSUPPORTED: DemuxErrors.CODEC_UNSUPPORTED\n};\n","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport {_concatArrayBuffers} from \"../utils/utils\";\nimport Log from \"../utils/logger\";\n\nclass RTMPMessage{\n\tTAG = \"RTMPMessage\";\n\n    static MessageTypes = [\"dummy\", \"PCMSetChunkSize\", \"PCMAbortMessage\", \"PCMAcknolegement\", \"UserControlMessage\", \"WindowAcknowledgementSize\", \"PCMSetPeerBandwidth\",\n        \"dummy\", \"AudioMessage\", \"VideoMessage\", \"dummy\", \"dummy\", \"dummy\", \"dummy\", \"dummy\", \"DataMessageAMF3\", \"Shared Object Message AMF3\", \"CommandMessageAMF3\",\n        \"DataMessageAMF0\", \"SharedObjectMessageAMF0\", \"CommandMessageAMF0\", \"dummy\", \"Aggregate Message\"];\n\n    messageType;\n\tmessageLength = 0;\n    length = 0;\n\ttimestamp = 0;\n    extendedTimestamp = false;\n\tmessage_stream_id = 0;\n\tpayload = new Uint8Array(0);\n\n    /**\n     *\n     * @param {Uint8Array} payload\n     */\n\tconstructor(payload) {\n        if(payload) {\n\t\t\tthis.setMessageLength(payload.length);\n            this.addPayload(payload);\n        }\n\t}\n\n\tclearPayload(){\n\t\tthis.payload = new Uint8Array(0);\n\t}\n\n    /**\n     *\n     * @returns {Uint8Array}\n     */\n\tgetBytes(){\n\t\tthis.header = new Uint8Array(11);\n\t\tthis.header[0] = this.messageType;\n\n\t\tthis.header[1] = (this.length >>> 16);\n\t\tthis.header[2] = (this.length >>> 8);\n\t\tthis.header[3] = (this.length);\n\n\t\tthis.header[4] = (this.timestamp >>> 24);\n\t\tthis.header[5] = (this.timestamp >>> 16);\n\t\tthis.header[6] = (this.timestamp >>> 8);\n\t\tthis.header[7] = (this.timestamp);\n\n\t\tthis.header[8] = (this.message_stream_id >>> 16);\n\t\tthis.header[9] = (this.message_stream_id >>> 8);\n\t\tthis.header[10] = (this.message_stream_id);\n\n\t\treturn _concatArrayBuffers(this.header, this.payload);\n\t}\n\n\t/**\n\t *\n\t * @param {Number} message_type\n\t */\n    setMessageType(message_type){\n        this.messageType = message_type;\n        switch(message_type){\n            case 1:\t\t// setBandwidth\n            case 2:\n            case 3:\n            case 4:     // UserControlMSG\n            case 5:\n            case 6:\n                this.message_stream_id = 0;\n                break;\n        }\n    }\n\n\tgetMessageType(){\n\t\treturn this.messageType;\n\t}\n\n    getMessageStreamID(){\n        return this.message_stream_id;\n    }\n\n\tsetMessageStreamID(messageStreamID) {\n\t\tthis.message_stream_id = messageStreamID;\n\t}\n\n\tgetPayloadlength(){\n\t\treturn this.payload.length;\n\t}\n\n    getTimestamp(){\n        return this.timestamp;\n    }\n\n\tsetMessageTimestamp(timestamp) {\n\t\tLog.v(this.TAG, \"TS: \" + timestamp);\n\t\tthis.timestamp = timestamp;\n\t}\n\n    /**\n     *\n     * @param {boolean} yes\n     */\n    setExtendedTimestamp(yes){\n\t\tLog.w(this.TAG, \"setExtendedTimestamp\");\n        this.extendedTimestamp = yes;\n    }\n\n    getExtendedTimestamp(){\n        return this.extendedTimestamp;\n    }\n\n\tsetTimestampDelta(timestamp_delta){\n\t\tLog.v(this.TAG, \"TS: \" + this.timestamp + \" Delta: \" + timestamp_delta);\n\t\tthis.timestamp += timestamp_delta;\n\t}\n\n\t/**\n\t *\n\t * @param {Uint8Array} data\n\t */\n\taddPayload(data){\n\t\tif(data.length > this.bytesMissing()) {\n\t\t\tLog.e(this.TAG, \"try to add too much data\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.payload = _concatArrayBuffers(this.payload, data);\n\t\tthis.length = this.payload.length;\n\t\tLog.d(this.TAG, \"[ RTMPMessage ] payload size is now: \" + this.length);\n\t}\n\n\tgetPayload(){\n\t\treturn this.payload;\n\t}\n\n    setMessageLength(message_length) {\n        this.messageLength = message_length;\n    }\n\n\tgetMessageLength(){\n\t\treturn this.messageLength;\n\t}\n\n\tisComplete(){\n\t\tif(this.payload.length === this.messageLength) return true;\n\t\treturn false;\n\t}\n\n\tbytesMissing(){\n\t\treturn this.messageLength - this.payload.length;\n\t}\n}\n\nexport default RTMPMessage;\n","\n/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport {_concatArrayBuffers} from \"../utils/utils\";\nimport Log from \"../utils/logger\";\n\nclass Chunk{\n    TAG = \"Chunk\";\n    chunk_stream_id = 0;\n\n    length;\n\n    message_type;\n    message_stream_id = 0;\n\n    timestamp;\n    CHUNK_SIZE = 128;\n    payload;\n\n    /**\n     * @param {RTMPMessage} message\n     */\n    constructor(message) {  // RTMP Message\n        this.payload = message.getPayload();\n        this.length = this.payload.length;\n        this.message_type = message.getMessageType();\n        this.message_stream_id = message.getMessageStreamID();\n    }\n\n    /**\n     *\n     * @returns {Uint8Array}\n     */\n    getBytes(){\n        let p = new Uint8Array(this.payload);\n\n        let ret = new Uint8Array(0);\n        let fmt = 0;\n\n        do {\n            Log.d(this.TAG, \"create chunk: \" + p.length);\n            ret = _concatArrayBuffers(ret, this._getHeaderBytes(fmt), p.slice(0,this.CHUNK_SIZE));\n            p = p.slice(this.CHUNK_SIZE);\n            fmt = 0x3;\t// next chunk without header\n\n        } while(p.length > 0);\n\n        return ret;\n    }\n\n    /**\n     *\n     * @param {Number} fmt\n     * @returns {Uint8Array}\n     * @private\n     */\n    _getHeaderBytes(fmt){\n        let basic_header;\n        let header;\n\n        if(this.chunk_stream_id < 63) {\n            basic_header = new Uint8Array(1);\n            basic_header[0] = (fmt << 6) | this.chunk_stream_id;\n\n        } else if(this.chunk_stream_id < 65599) {\n            basic_header = new Uint8Array(2);\n            basic_header[0] = (fmt << 6);\n            basic_header[1] = (this.chunk_stream_id -64);\n\n        } else {\n            basic_header = new Uint8Array(3);\n            basic_header[0] = (fmt << 6) | 63;\n            basic_header[1] = ((this.chunk_stream_id -64) >>> 8);\n            basic_header[2] = ((this.chunk_stream_id -64));\n        }\n\n        switch(fmt){\n            case 0x0:\n                header = new Uint8Array(11);\n                header[0] = (this.timestamp >>> 16);\n                header[1] = (this.timestamp >>> 8);\n                header[2] = (this.timestamp);\n\n                header[3] = (this.length >>> 16);\n                header[4] = (this.length >>> 8);\n                header[5] = (this.length);\n\n                header[6] = (this.message_type);\n\n                header[7] = (this.message_stream_id >>> 24);\n                header[8] = (this.message_stream_id >>> 16);\n                header[9] = (this.message_stream_id >>> 8);\n                header[10] = (this.message_stream_id);\n                break;\n\n            case 0x1:\n                header = new Uint8Array(7);\n                header[0] = (this.timestamp >>> 16);\n                header[1] = (this.timestamp >>> 8);\n                header[2] = (this.timestamp);\n\n                header[3] = (this.length >>> 16);\n                header[4] = (this.length >>> 8);\n                header[5] = (this.length);\n\n                header[6] = (this.message_type);\n                break;\n\n\n            case 0x2:\n                header = new Uint8Array(3);\n                header[0] = (this.timestamp >>> 16);\n                header[1] = (this.timestamp >>> 8);\n                header[2] = (this.timestamp);\n                break;\n\n            case 0x3:\n                header = new Uint8Array(0);\n                break;\n        }\n\n        return _concatArrayBuffers(basic_header, header);\n    }\n\n    getPayload(){\n        return this.payload;\n    }\n\n    getMessageType(){\n        return this.message_type;\n    }\n\n    getMessageStreamID() {\n        return this.message_stream_id;\n    }\n\n    setChunkSize(size){\n        this.CHUNK_SIZE = size;\n    }\n\n    /**\n     *\n     * @param {Number} chunk_stream_id\n     */\n    setChunkStreamID(chunk_stream_id) {\n        Log.d(this.TAG, \"setChunkStreamID:\" + chunk_stream_id);\n        this.chunk_stream_id = chunk_stream_id;\n    }\n\n    /**\n     *\n     * @param {Number} message_stream_id\n     */\n    setMessageStreamID(message_stream_id) {\n        this.message_stream_id = message_stream_id;\n    }\n\n    /**\n     *\n     * @param {Number} timestamp\n     */\n    setTimestamp(timestamp){\n        this.timestamp = timestamp;\n    }\n}\n\nexport default Chunk;\n","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nclass UserControlMessage{\n    event_type;\n    event_data1;\n    event_data2;\n\n    static events = [\"StreamBegin\", \"StreamEOF\", \"StreamDry\", \"SetBuffer\", \"StreamIsRecorded\", \"dummy\", \"PingRequest\", \"PingResponse\"];\n\n    /**\n     *\n     * @returns {Uint8Array}\n     */\n    getBytes(){\n        let ret;\n\n        if(this.event_data2) {\n            ret = new Uint8Array(10);\n            ret[0] = (this.event_type >>> 8);\n            ret[1] = (this.event_type);\n\n            ret[2] = (this.event_data1 >>> 24);\n            ret[3] = (this.event_data1 >>> 16);\n            ret[4] = (this.event_data1 >>> 8);\n            ret[5] = (this.event_data1);\n\n            ret[6] = (this.event_data2 >>> 24);\n            ret[7] = (this.event_data2 >>> 16);\n            ret[8] = (this.event_data2 >>> 8);\n            ret[9] = (this.event_data2);\n\n        } else {\n            ret = new Uint8Array(6);\n            ret[0] = (this.event_type >>> 8);\n            ret[1] = (this.event_type);\n\n            ret[2] = (this.event_data1 >>> 24);\n            ret[3] = (this.event_data1 >>> 16);\n            ret[4] = (this.event_data1 >>> 8);\n            ret[5] = (this.event_data1);\n        }\n\n        return ret;\n    }\n\n    getEventMessage(){\n        let o = {};\n\n        if(this.event_type === 3) {\n            o[UserControlMessage.events[this.event_type]] = [this.event_data1, this.event_data2];\n        } else {\n            o[UserControlMessage.events[this.event_type]] = this.event_data1;\n        }\n\n        return o;\n    }\n\n    setType(event_type){\n        this.event_type = event_type;\n    }\n\n    setEventData(event_data){\n        this.event_data1 = event_data;\n    }\n}\n\nexport default UserControlMessage;\n","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport Log from \"../utils/logger\";\n\nclass ProtocolControlMessage{\n    TAG = \"ProtocolControlMessage\";\n    pcm_type;\n    data;\n\n    static pcm_types = [\"dummy\", \"SetChunkSize\", \"AbortMessage\", \"Acknowledgement\", \"UserControlMessage\", \"WindowAcknowledgementSize\", \"SetPeerBandwidth\"];\n\n    constructor(pcm_type, data) {\n        switch(pcm_type){\n        case 1:\n        case 2:\n        case 3:\n        case 5:\n            this.pcm_type = pcm_type;\n            this.data = (data[0] << 24) | (data[1] << 16) | (data[2] << 8) | (data[3]);\n            break;\n\n        case 6:\n            Log.w(this.TAG, \"Protocol Control Message Type: \" + pcm_type + \" use SetPeerBandwidthMessage\");\n            break;\n\n        default:\n            Log.e(this.TAG, \"Protocol Control Message Type: \" + pcm_type + \" not supported\");\n            break;\n        }\n    }\n\n    setPayload(data){\n        this.data = data;\n    }\n\n    getEventMessage(){\n        let o = {};\n        o[ProtocolControlMessage.pcm_types[this.pcm_type]] = this.data;\n        return o;\n    }\n\n    getBytes(){\n        let ret = [];\n\n        ret[0] = (this.data >>> 24);\n        ret[1] = (this.data >>> 16);\n        ret[2] = (this.data >>> 8);\n        ret[3] = (this.data);\n\n        return new Uint8Array(ret);\n    }\n}\nexport default ProtocolControlMessage;\n","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport ProtocolControlMessage from \"./ProtocolControlMessage\";\nimport RTMPMessage from \"./RTMPMessage\";\nimport Chunk from \"./Chunk\";\nimport Log from \"../utils/logger\";\n\nclass NetConnection{\n    TAG = \"NetConnection\";\n    WindowAcknowledgementSize;\n    MessageStreamID;\n    CHUNK_SIZE = 128;\n    BandWidth;\n    socket;\n\n    netstreams = [];\n\n    /**\n     *\n     * @param {Number} message_stream_id\n     * @param {RTMPMessageHandler} handler\n     */\n    constructor(message_stream_id, handler) {\n        this.MessageStreamID = message_stream_id;\n\n        Log.d(this.TAG, handler);\n\n        this.handler = handler;\n        this.socket = handler.socket;\n    }\n\n    /**\n     *\n     * @param {RTMPMessage} message\n     */\n    parseMessage(message){      // RTMPMessage\n        let data = message.getPayload();\n\n        switch(message.getMessageType()){\n        case 1:         // PCM Set Chunk Size\n            this.CHUNK_SIZE = (data[0] << 24) | (data[1] << 16) | (data[2] << 8) | (data[3]);\n            this.handler.setChunkSize(this.CHUNK_SIZE)\n            break;\n\n        case 2:         // PCM Abort Message\n        case 3:         // PCM Acknowledgement\n        case 5:         // PCM Window Acknowledgement Size\n            this.WindowAcknowledgementSize = (data[0] << 24) | (data[1] << 16) | (data[2] << 8) | (data[3]);\n            Log.i(this.TAG, \"WindowAcknowledgementSize: \" + this.WindowAcknowledgementSize);\n            break;\n\n        case 6:         // PCM Set Peer Bandwidth\n            this.BandWidth = (data[0] << 24) | (data[1] << 16) | (data[2] << 8) | (data[3]);\n            Log.i(this.TAG, \"SetPeerBandwidth: \" + this.BandWidth);\n\n            // send Window Ack Size\n            let msg = new ProtocolControlMessage(0x05, this.WindowAcknowledgementSize);\n\n            let m2 = new RTMPMessage(msg.getBytes());\n            m2.setMessageType(0x05)     // WinACKSize\n\n            const chunk = new Chunk(m2);\n            chunk.setChunkStreamID(2);  // Control Channel\n\n            Log.i(this.TAG, \"send WindowAcksize\");\n            this.socket.send(chunk.getBytes());\n\n            break;\n\n        default:\n            break;\n        }\n    }\n\n    createStream(){\n\n    }\n}\n\nexport default NetConnection;\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport class RuntimeException {\n    constructor(message) {\n        this._message = message;\n    }\n\n    get name() {\n        return 'RuntimeException';\n    }\n\n    get message() {\n        return this._message;\n    }\n\n    toString() {\n        return this.name + ': ' + this.message;\n    }\n}\n\nexport class IllegalStateException extends RuntimeException {\n    constructor(message) {\n        super(message);\n    }\n\n    get name() {\n        return 'IllegalStateException';\n    }\n}\n\nexport class InvalidArgumentException extends RuntimeException {\n    constructor(message) {\n        super(message);\n    }\n\n    get name() {\n        return 'InvalidArgumentException';\n    }\n}\n\nexport class NotImplementedException extends RuntimeException {\n    constructor(message) {\n        super(message);\n    }\n\n    get name() {\n        return 'NotImplementedException';\n    }\n}\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass MediaInfo {\n\n\tconstructor() {\n\t\tthis.mimeType = null;\n\t\tthis.duration = null;\n\n\t\tthis.hasAudio = null;\n\t\tthis.hasVideo = null;\n\t\tthis.audioCodec = null;\n\t\tthis.videoCodec = null;\n\t\tthis.audioDataRate = null;\n\t\tthis.videoDataRate = null;\n\n\t\tthis.audioSampleRate = null;\n\t\tthis.audioChannelCount = null;\n\n\t\tthis.width = null;\n\t\tthis.height = null;\n\t\tthis.fps = null;\n\t\tthis.profile = null;\n\t\tthis.level = null;\n\t\tthis.refFrames = null;\n\t\tthis.chromaFormat = null;\n\t\tthis.sarNum = null;\n\t\tthis.sarDen = null;\n\n\t\tthis.metadata = null;\n\t\tthis.segments = null;  // MediaInfo[]\n\t\tthis.segmentCount = null;\n\t\tthis.hasKeyframesIndex = null;\n\t\tthis.keyframesIndex = null;\n\t}\n\n\tisComplete() {\n\t\tlet audioInfoComplete = (this.hasAudio === false) ||\n\t\t\t(this.hasAudio === true &&\n\t\t\t\tthis.audioCodec != null &&\n\t\t\t\tthis.audioSampleRate != null &&\n\t\t\t\tthis.audioChannelCount != null);\n\n\t\tlet videoInfoComplete = (this.hasVideo === false) ||\n\t\t\t(this.hasVideo === true &&\n\t\t\t\tthis.videoCodec != null &&\n\t\t\t\tthis.width != null &&\n\t\t\t\tthis.height != null &&\n\t\t\t\tthis.fps != null &&\n\t\t\t\tthis.profile != null &&\n\t\t\t\tthis.level != null &&\n\t\t\t\tthis.refFrames != null &&\n\t\t\t\tthis.chromaFormat != null &&\n\t\t\t\tthis.sarNum != null &&\n\t\t\t\tthis.sarDen != null);\n\n\t\t// keyframesIndex may not be present\n\t\treturn this.mimeType != null &&\n\t\t\tthis.duration != null &&\n\t\t\tthis.metadata != null &&\n\t\t\tthis.hasKeyframesIndex != null &&\n\t\t\taudioInfoComplete &&\n\t\t\tvideoInfoComplete;\n\t}\n\n\tisSeekable() {\n\t\treturn this.hasKeyframesIndex === true;\n\t}\n\n\tgetNearestKeyframe(milliseconds) {\n\t\tif (this.keyframesIndex == null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet table = this.keyframesIndex;\n\t\tlet keyframeIdx = this._search(table.times, milliseconds);\n\n\t\treturn {\n\t\t\tindex: keyframeIdx,\n\t\t\tmilliseconds: table.times[keyframeIdx],\n\t\t\tfileposition: table.filepositions[keyframeIdx]\n\t\t};\n\t}\n\n\t_search(list, value) {\n\t\tlet idx = 0;\n\n\t\tlet last = list.length - 1;\n\t\tlet mid = 0;\n\t\tlet lbound = 0;\n\t\tlet ubound = last;\n\n\t\tif (value < list[0]) {\n\t\t\tidx = 0;\n\t\t\tlbound = ubound + 1;  // skip search\n\t\t}\n\n\t\twhile (lbound <= ubound) {\n\t\t\tmid = lbound + Math.floor((ubound - lbound) / 2);\n\t\t\tif (mid === last || (value >= list[mid] && value < list[mid + 1])) {\n\t\t\t\tidx = mid;\n\t\t\t\tbreak;\n\t\t\t} else if (list[mid] < value) {\n\t\t\t\tlbound = mid + 1;\n\t\t\t} else {\n\t\t\t\tubound = mid - 1;\n\t\t\t}\n\t\t}\n\n\t\treturn idx;\n\t}\n\n}\n\nexport default MediaInfo;\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * This file is derived from C++ project libWinTF8 (https://github.com/m13253/libWinTF8)\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport function checkContinuation(uint8array, start, checkLength) {\n    let array = uint8array;\n    if (start + checkLength < array.length) {\n        while (checkLength--) {\n            if ((array[++start] & 0xC0) !== 0x80)\n                return false;\n        }\n        return true;\n    } else {\n        return false;\n    }\n}\n\nexport function decodeUTF8(uint8array) {\n    let out = [];\n    let input = uint8array;\n    let i = 0;\n    let length = uint8array.length;\n\n    while (i < length) {\n        if (input[i] < 0x80) {\n            out.push(String.fromCharCode(input[i]));\n            ++i;\n            continue;\n        } else if (input[i] < 0xC0) {\n            // fallthrough\n        } else if (input[i] < 0xE0) {\n            if (checkContinuation(input, i, 1)) {\n                let ucs4 = (input[i] & 0x1F) << 6 | (input[i + 1] & 0x3F);\n                if (ucs4 >= 0x80) {\n                    out.push(String.fromCharCode(ucs4 & 0xFFFF));\n                    i += 2;\n                    continue;\n                }\n            }\n        } else if (input[i] < 0xF0) {\n            if (checkContinuation(input, i, 2)) {\n                let ucs4 = (input[i] & 0xF) << 12 | (input[i + 1] & 0x3F) << 6 | input[i + 2] & 0x3F;\n                if (ucs4 >= 0x800 && (ucs4 & 0xF800) !== 0xD800) {\n                    out.push(String.fromCharCode(ucs4 & 0xFFFF));\n                    i += 3;\n                    continue;\n                }\n            }\n        } else if (input[i] < 0xF8) {\n            if (checkContinuation(input, i, 3)) {\n                let ucs4 = (input[i] & 0x7) << 18 | (input[i + 1] & 0x3F) << 12\n                    | (input[i + 2] & 0x3F) << 6 | (input[i + 3] & 0x3F);\n                if (ucs4 > 0x10000 && ucs4 < 0x110000) {\n                    ucs4 -= 0x10000;\n                    out.push(String.fromCharCode((ucs4 >>> 10) | 0xD800));\n                    out.push(String.fromCharCode((ucs4 & 0x3FF) | 0xDC00));\n                    i += 4;\n                    continue;\n                }\n            }\n        }\n        out.push(String.fromCharCode(0xFFFD));\n        ++i;\n    }\n\n    return out.join('');\n}\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {IllegalStateException} from \"../utils/exception\";\nimport {decodeUTF8} from \"../utils/utf8-conv\";\nimport Log from \"../utils/logger\";\n\nlet le = (function () {\n    let buf = new ArrayBuffer(2);\n    (new DataView(buf)).setInt16(0, 256, true);  // little-endian write\n    return (new Int16Array(buf))[0] === 256;  // platform-spec read, if equal then LE\n})();\n\nclass AMF {\n    static TAG = \"AMF\";\n\n    /**\n     *\n     * @param {Uint8Array} array\n     * @returns {{}}\n     */\n    static parseScriptData(array) {\n        Log.d(this.TAG, array);\n\n        let data = {};\n\n        try {\n            let name = AMF.parseValue(array);\n            Log.d(this.TAG, name);\n\n            let value = AMF.parseValue(array.slice(name.size));\n            Log.d(this.TAG, value);\n\n            data[name.data] = value.data;\n\n        } catch (e) {\n            Log.w(this.TAG, e.toString());\n        }\n\n        return data;\n    }\n\n    /**\n     *\n     * @param {Uint8Array} array\n     * @returns {{data: {name: string, value: {}}, size: number, objectEnd: boolean}}\n     */\n    static parseObject(array) {\n        if (array.length < 3) {\n            throw new IllegalStateException('Data not enough when parse ScriptDataObject');\n        }\n        let name = AMF.parseString(array);\n        let value = AMF.parseValue(array.slice(name.size, array.length - name.size));\n        let isObjectEnd = value.objectEnd;\n\n        return {\n            data: {\n                name: name.data,\n                value: value.data\n            },\n            size: name.size + value.size,\n            objectEnd: isObjectEnd\n        };\n    }\n\n    /**\n     *\n     * @param {Uint8Array} array\n     * @returns {{data: {name: string, value: {}}, size: number, objectEnd: boolean}}\n     */\n    static parseVariable(array) {\n        return AMF.parseObject(array);\n    }\n\n    /**\n     *\n     * @param {Uint8Array} array\n     * @returns {{data: string, size: number}}\n     */\n    static parseString(array) {\n        if (array.length < 2) {\n            throw new IllegalStateException('Data not enough when parse String');\n        }\n        let v = new DataView(array.buffer);\n        let length = v.getUint16(0, !le);\n\n        let str;\n        if (length > 0) {\n            str = decodeUTF8(new Uint8Array(array.slice(2, 2 + length)));\n        } else {\n            str = '';\n        }\n\n        return {\n            data: str,\n            size: 2 + length\n        };\n    }\n\n    static parseLongString(array) {\n        if (array.length() < 4) {\n            throw new IllegalStateException('Data not enough when parse LongString');\n        }\n        let v = new DataView(array.buffer);\n        let length = v.getUint32(0, !le);\n\n        let str;\n        if (length > 0) {\n            str = decodeUTF8(new Uint8Array(array.slice(4, 4 +length)));\n        } else {\n            str = '';\n        }\n\n        return {\n            data: str,\n            size: 4 + length\n        };\n    }\n\n    static parseDate(array) {\n        if (array.length() < 10) {\n            throw new IllegalStateException('Data size invalid when parse Date');\n        }\n        let v = new DataView(array.buffer);\n        let timestamp = v.getFloat64(0, !le);\n        let localTimeOffset = v.getInt16(8, !le);\n        timestamp += localTimeOffset * 60 * 1000;  // get UTC time\n\n        return {\n            data: new Date(timestamp),\n            size: 8 + 2\n        };\n    }\n\n    /**\n     *\n     * @param {Uint8Array} array\n     * @returns {{data: {}, size: number, objectEnd: boolean}}\n     */\n    static parseValue(array) {\n        if (array.length < 1) {\n            throw new IllegalStateException('Data not enough when parse Value');\n        }\n\n        let v = new DataView(array.buffer);\n\n        let offset = 1;\n        let type = v.getUint8(0);\n        let value;\n        let objectEnd = false;\n\n        try {\n            switch (type) {\n                case 0:  // Number(Double) type\n                    value = v.getFloat64(1, !le);\n                    offset += 8;\n                    break;\n                case 1: {  // Boolean type\n                    let b = v.getUint8(1);\n                    value = b ? true : false;\n                    offset += 1;\n                    break;\n                }\n                case 2: {  // String type\n                    let amfstr = AMF.parseString(array.slice(1));\n                    value = amfstr.data;\n                    offset += amfstr.size;\n                    break;\n                }\n                case 3: { // Object(s) type\n                    value = {};\n                    let terminal = 0;  // workaround for malformed Objects which has missing ScriptDataObjectEnd\n                    if ((v.getUint32(array.length - 4, !le) & 0x00FFFFFF) === 9) {\n                        terminal = 3;\n                    }\n                    while (offset < array.length - 4) {  // 4 === type(UI8) + ScriptDataObjectEnd(UI24)\n                        let amfobj = AMF.parseObject(array.slice(offset, offset + array.length - terminal));\n                        if (amfobj.objectEnd)\n                            break;\n                        value[amfobj.data.name] = amfobj.data.value;\n                        offset += amfobj.size;\n                    }\n                    if (offset <= array.length - 3) {\n                        let marker = v.getUint32(offset - 1, !le) & 0x00FFFFFF;\n                        if (marker === 9) {\n                            offset += 3;\n                        }\n                    }\n                    break;\n                }\n                case 8: { // ECMA array type (Mixed array)\n                    value = {};\n                    offset += 4;  // ECMAArrayLength(UI32)\n                    let terminal = 0;  // workaround for malformed MixedArrays which has missing ScriptDataObjectEnd\n                    if ((v.getUint32(array.length - 4, !le) & 0x00FFFFFF) === 9) {\n                        terminal = 3;\n                    }\n                    while (offset < array.length - 8) {  // 8 === type(UI8) + ECMAArrayLength(UI32) + ScriptDataVariableEnd(UI24)\n                        let amfvar = AMF.parseVariable(array.slice(offset, offset + array.length - terminal));\n                        if (amfvar.objectEnd)\n                            break;\n                        value[amfvar.data.name] = amfvar.data.value;\n                        offset += amfvar.size;\n                    }\n                    if (offset <= array.length - 3) {\n                        let marker = v.getUint32(offset - 1, !le) & 0x00FFFFFF;\n                        if (marker === 9) {\n                            offset += 3;\n                        }\n                    }\n                    break;\n                }\n                case 9:  // ScriptDataObjectEnd\n                    value = undefined;\n                    offset = 1;\n                    objectEnd = true;\n                    break;\n                case 10: {  // Strict array type\n                    // ScriptDataValue[n]. NOTE: according to video_file_format_spec_v10_1.pdf\n                    value = [];\n                    let strictArrayLength = v.getUint32(1, !le);\n                    offset += 4;\n                    for (let i = 0; i < strictArrayLength; i++) {\n                        let val = AMF.parseValue(array.slice(offset, array.length));\n                        value.push(val.data);\n                        offset += val.size;\n                    }\n                    break;\n                }\n                case 11: {  // Date type\n                    let date = AMF.parseDate(array.slice(1));\n                    value = date.data;\n                    offset += date.size;\n                    break;\n                }\n                case 12: {  // Long string type\n                    let amfLongStr = AMF.parseString(array.slice(1));\n                    value = amfLongStr.data;\n                    offset += amfLongStr.size;\n                    break;\n                }\n                default:\n                    // ignore and skip\n                    offset = array.length;\n                    Log.w(this.TAG, 'Unsupported AMF value type ' + type);\n            }\n        } catch (e) {\n            Log.e(this.TAG, e.toString());\n        }\n\n        return {\n            data: value,\n            size: offset,\n            objectEnd: objectEnd\n        };\n    }\n}\n\nexport default AMF;\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n\nimport ExpGolomb from \"./exp-golomb\";\n\nclass SPSParser {\n    static _ebsp2rbsp(uint8array) {\n        let src = uint8array;\n        let src_length = src.byteLength;\n        let dst = new Uint8Array(src_length);\n        let dst_idx = 0;\n\n        for (let i = 0; i < src_length; i++) {\n            if (i >= 2) {\n                // Unescape: Skip 0x03 after 00 00\n                if (src[i] === 0x03 && src[i - 1] === 0x00 && src[i - 2] === 0x00) {\n                    continue;\n                }\n            }\n            dst[dst_idx] = src[i];\n            dst_idx++;\n        }\n\n        return new Uint8Array(dst.buffer, 0, dst_idx);\n    }\n\n    static parseSPS(uint8array) {\n        let rbsp = SPSParser._ebsp2rbsp(uint8array);\n        let gb = new ExpGolomb(rbsp);\n\n        gb.readByte();\n        let profile_idc = gb.readByte();  // profile_idc\n        gb.readByte();  // constraint_set_flags[5] + reserved_zero[3]\n        let level_idc = gb.readByte();  // level_idc\n        gb.readUEG();  // seq_parameter_set_id\n\n        let profile_string = SPSParser.getProfileString(profile_idc);\n        let level_string = SPSParser.getLevelString(level_idc);\n        let chroma_format_idc = 1;\n        let chroma_format = 420;\n        let chroma_format_table = [0, 420, 422, 444];\n        let bit_depth = 8;\n\n        if (profile_idc === 100 || profile_idc === 110 || profile_idc === 122 ||\n            profile_idc === 244 || profile_idc === 44 || profile_idc === 83 ||\n            profile_idc === 86 || profile_idc === 118 || profile_idc === 128 ||\n            profile_idc === 138 || profile_idc === 144) {\n\n            chroma_format_idc = gb.readUEG();\n            if (chroma_format_idc === 3) {\n                gb.readBits(1);  // separate_colour_plane_flag\n            }\n            if (chroma_format_idc <= 3) {\n                chroma_format = chroma_format_table[chroma_format_idc];\n            }\n\n            bit_depth = gb.readUEG() + 8;  // bit_depth_luma_minus8\n            gb.readUEG();  // bit_depth_chroma_minus8\n            gb.readBits(1);  // qpprime_y_zero_transform_bypass_flag\n            if (gb.readBool()) {  // seq_scaling_matrix_present_flag\n                let scaling_list_count = (chroma_format_idc !== 3) ? 8 : 12;\n                for (let i = 0; i < scaling_list_count; i++) {\n                    if (gb.readBool()) {  // seq_scaling_list_present_flag\n                        if (i < 6) {\n                            SPSParser._skipScalingList(gb, 16);\n                        } else {\n                            SPSParser._skipScalingList(gb, 64);\n                        }\n                    }\n                }\n            }\n        }\n        gb.readUEG();  // log2_max_frame_num_minus4\n        let pic_order_cnt_type = gb.readUEG();\n        if (pic_order_cnt_type === 0) {\n            gb.readUEG();  // log2_max_pic_order_cnt_lsb_minus_4\n        } else if (pic_order_cnt_type === 1) {\n            gb.readBits(1);  // delta_pic_order_always_zero_flag\n            gb.readSEG();  // offset_for_non_ref_pic\n            gb.readSEG();  // offset_for_top_to_bottom_field\n            let num_ref_frames_in_pic_order_cnt_cycle = gb.readUEG();\n            for (let i = 0; i < num_ref_frames_in_pic_order_cnt_cycle; i++) {\n                gb.readSEG();  // offset_for_ref_frame\n            }\n        }\n        let ref_frames = gb.readUEG();  // max_num_ref_frames\n        gb.readBits(1);  // gaps_in_frame_num_value_allowed_flag\n\n        let pic_width_in_mbs_minus1 = gb.readUEG();\n        let pic_height_in_map_units_minus1 = gb.readUEG();\n\n        let frame_mbs_only_flag = gb.readBits(1);\n        if (frame_mbs_only_flag === 0) {\n            gb.readBits(1);  // mb_adaptive_frame_field_flag\n        }\n        gb.readBits(1);  // direct_8x8_inference_flag\n\n        let frame_crop_left_offset = 0;\n        let frame_crop_right_offset = 0;\n        let frame_crop_top_offset = 0;\n        let frame_crop_bottom_offset = 0;\n\n        let frame_cropping_flag = gb.readBool();\n        if (frame_cropping_flag) {\n            frame_crop_left_offset = gb.readUEG();\n            frame_crop_right_offset = gb.readUEG();\n            frame_crop_top_offset = gb.readUEG();\n            frame_crop_bottom_offset = gb.readUEG();\n        }\n\n        let sar_width = 1, sar_height = 1;\n        let fps = 0, fps_fixed = true, fps_num = 0, fps_den = 0;\n\n        let vui_parameters_present_flag = gb.readBool();\n        if (vui_parameters_present_flag) {\n            if (gb.readBool()) {  // aspect_ratio_info_present_flag\n                let aspect_ratio_idc = gb.readByte();\n                let sar_w_table = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2];\n                let sar_h_table = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33,  99, 3, 2, 1];\n\n                if (aspect_ratio_idc > 0 && aspect_ratio_idc < 16) {\n                    sar_width = sar_w_table[aspect_ratio_idc - 1];\n                    sar_height = sar_h_table[aspect_ratio_idc - 1];\n                } else if (aspect_ratio_idc === 255) {\n                    sar_width = gb.readByte() << 8 | gb.readByte();\n                    sar_height = gb.readByte() << 8 | gb.readByte();\n                }\n            }\n\n            if (gb.readBool()) {  // overscan_info_present_flag\n                gb.readBool();  // overscan_appropriate_flag\n            }\n            if (gb.readBool()) {  // video_signal_type_present_flag\n                gb.readBits(4);  // video_format & video_full_range_flag\n                if (gb.readBool()) {  // colour_description_present_flag\n                    gb.readBits(24);  // colour_primaries & transfer_characteristics & matrix_coefficients\n                }\n            }\n            if (gb.readBool()) {  // chroma_loc_info_present_flag\n                gb.readUEG();  // chroma_sample_loc_type_top_field\n                gb.readUEG();  // chroma_sample_loc_type_bottom_field\n            }\n            if (gb.readBool()) {  // timing_info_present_flag\n                let num_units_in_tick = gb.readBits(32);\n                let time_scale = gb.readBits(32);\n                fps_fixed = gb.readBool();  // fixed_frame_rate_flag\n\n                fps_num = time_scale;\n                fps_den = num_units_in_tick * 2;\n                fps = fps_num / fps_den;\n            }\n        }\n\n        let sarScale = 1;\n        if (sar_width !== 1 || sar_height !== 1) {\n            sarScale = sar_width / sar_height;\n        }\n\n        let crop_unit_x = 0, crop_unit_y = 0;\n        if (chroma_format_idc === 0) {\n            crop_unit_x = 1;\n            crop_unit_y = 2 - frame_mbs_only_flag;\n        } else {\n            let sub_wc = (chroma_format_idc === 3) ? 1 : 2;\n            let sub_hc = (chroma_format_idc === 1) ? 2 : 1;\n            crop_unit_x = sub_wc;\n            crop_unit_y = sub_hc * (2 - frame_mbs_only_flag);\n        }\n\n        let codec_width = (pic_width_in_mbs_minus1 + 1) * 16;\n        let codec_height = (2 - frame_mbs_only_flag) * ((pic_height_in_map_units_minus1 + 1) * 16);\n\n        codec_width -= (frame_crop_left_offset + frame_crop_right_offset) * crop_unit_x;\n        codec_height -= (frame_crop_top_offset + frame_crop_bottom_offset) * crop_unit_y;\n\n        let present_width = Math.ceil(codec_width * sarScale);\n\n        gb.destroy();\n        gb = null;\n\n        return {\n            profile_string: profile_string,  // baseline, high, high10, ...\n            level_string: level_string,  // 3, 3.1, 4, 4.1, 5, 5.1, ...\n            bit_depth: bit_depth,  // 8bit, 10bit, ...\n            ref_frames: ref_frames,\n            chroma_format: chroma_format,  // 4:2:0, 4:2:2, ...\n            chroma_format_string: SPSParser.getChromaFormatString(chroma_format),\n\n            frame_rate: {\n                fixed: fps_fixed,\n                fps: fps,\n                fps_den: fps_den,\n                fps_num: fps_num\n            },\n\n            sar_ratio: {\n                width: sar_width,\n                height: sar_height\n            },\n\n            codec_size: {\n                width: codec_width,\n                height: codec_height\n            },\n\n            present_size: {\n                width: present_width,\n                height: codec_height\n            }\n        };\n    }\n\n    static _skipScalingList(gb, count) {\n        let last_scale = 8, next_scale = 8;\n        let delta_scale = 0;\n        for (let i = 0; i < count; i++) {\n            if (next_scale !== 0) {\n                delta_scale = gb.readSEG();\n                next_scale = (last_scale + delta_scale + 256) % 256;\n            }\n            last_scale = (next_scale === 0) ? last_scale : next_scale;\n        }\n    }\n\n    static getProfileString(profile_idc) {\n        switch (profile_idc) {\n            case 66:\n                return 'Baseline';\n            case 77:\n                return 'Main';\n            case 88:\n                return 'Extended';\n            case 100:\n                return 'High';\n            case 110:\n                return 'High10';\n            case 122:\n                return 'High422';\n            case 244:\n                return 'High444';\n            default:\n                return 'Unknown';\n        }\n    }\n\n    static getLevelString(level_idc) {\n        return (level_idc / 10).toFixed(1);\n    }\n\n    static getChromaFormatString(chroma) {\n        switch (chroma) {\n            case 420:\n                return '4:2:0';\n            case 422:\n                return '4:2:2';\n            case 444:\n                return '4:4:4';\n            default:\n                return 'Unknown';\n        }\n    }\n\n}\n\nexport default SPSParser;\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Exponential-Golomb buffer decoder\nimport {IllegalStateException, InvalidArgumentException} from \"../utils/exception\";\n\nclass ExpGolomb {\n\n    constructor(uint8array) {\n        this.TAG = 'ExpGolomb';\n\n        this._buffer = uint8array;\n        this._buffer_index = 0;\n        this._total_bytes = uint8array.byteLength;\n        this._total_bits = uint8array.byteLength * 8;\n        this._current_word = 0;\n        this._current_word_bits_left = 0;\n    }\n\n    destroy() {\n        this._buffer = null;\n    }\n\n    _fillCurrentWord() {\n        let buffer_bytes_left = this._total_bytes - this._buffer_index;\n        if (buffer_bytes_left <= 0)\n            throw new IllegalStateException('ExpGolomb: _fillCurrentWord() but no bytes available');\n\n        let bytes_read = Math.min(4, buffer_bytes_left);\n        let word = new Uint8Array(4);\n        word.set(this._buffer.subarray(this._buffer_index, this._buffer_index + bytes_read));\n        this._current_word = new DataView(word.buffer).getUint32(0, false);\n\n        this._buffer_index += bytes_read;\n        this._current_word_bits_left = bytes_read * 8;\n    }\n\n    readBits(bits) {\n        if (bits > 32)\n            throw new InvalidArgumentException('ExpGolomb: readBits() bits exceeded max 32bits!');\n\n        if (bits <= this._current_word_bits_left) {\n            let result = this._current_word >>> (32 - bits);\n            this._current_word <<= bits;\n            this._current_word_bits_left -= bits;\n            return result;\n        }\n\n        let result = this._current_word_bits_left ? this._current_word : 0;\n        result = result >>> (32 - this._current_word_bits_left);\n        let bits_need_left = bits - this._current_word_bits_left;\n\n        this._fillCurrentWord();\n        let bits_read_next = Math.min(bits_need_left, this._current_word_bits_left);\n\n        let result2 = this._current_word >>> (32 - bits_read_next);\n        this._current_word <<= bits_read_next;\n        this._current_word_bits_left -= bits_read_next;\n\n        result = (result << bits_read_next) | result2;\n        return result;\n    }\n\n    readBool() {\n        return this.readBits(1) === 1;\n    }\n\n    readByte() {\n        return this.readBits(8);\n    }\n\n    _skipLeadingZero() {\n        let zero_count;\n        for (zero_count = 0; zero_count < this._current_word_bits_left; zero_count++) {\n            if (0 !== (this._current_word & (0x80000000 >>> zero_count))) {\n                this._current_word <<= zero_count;\n                this._current_word_bits_left -= zero_count;\n                return zero_count;\n            }\n        }\n        this._fillCurrentWord();\n        return zero_count + this._skipLeadingZero();\n    }\n\n    readUEG() {  // unsigned exponential golomb\n        let leading_zeros = this._skipLeadingZero();\n        return this.readBits(leading_zeros + 1) - 1;\n    }\n\n    readSEG() {  // signed exponential golomb\n        let value = this.readUEG();\n        if (value & 0x01) {\n            return (value + 1) >>> 1;\n        } else {\n            return -1 * (value >>> 1);\n        }\n    }\n\n}\n\nexport default ExpGolomb;\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * This file is derived from dailymotion's hls.js library (hls.js/src/remux/mp4-generator.js)\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n//  MP4 boxes generator for ISO BMFF (ISO Base Media File Format, defined in ISO/IEC 14496-12)\nclass MP4 {\n    static init() {\n        MP4.types = {\n            avc1: [], avcC: [], btrt: [], dinf: [],\n            dref: [], esds: [], ftyp: [], hdlr: [],\n            mdat: [], mdhd: [], mdia: [], mfhd: [],\n            minf: [], moof: [], moov: [], mp4a: [],\n            mvex: [], mvhd: [], sdtp: [], stbl: [],\n            stco: [], stsc: [], stsd: [], stsz: [],\n            stts: [], tfdt: [], tfhd: [], traf: [],\n            trak: [], trun: [], trex: [], tkhd: [],\n            vmhd: [], smhd: [], '.mp3': []\n        };\n\n        for (let name in MP4.types) {\n            if (MP4.types.hasOwnProperty(name)) {\n                MP4.types[name] = [\n                    name.charCodeAt(0),\n                    name.charCodeAt(1),\n                    name.charCodeAt(2),\n                    name.charCodeAt(3)\n                ];\n            }\n        }\n\n        let constants = MP4.constants = {};\n\n        constants.FTYP = new Uint8Array([\n            0x69, 0x73, 0x6F, 0x6D,  // major_brand: isom\n            0x0,  0x0,  0x0,  0x1,   // minor_version: 0x01\n            0x69, 0x73, 0x6F, 0x6D,  // isom\n            0x61, 0x76, 0x63, 0x31   // avc1\n        ]);\n\n        constants.STSD_PREFIX = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x01   // entry_count\n        ]);\n\n        constants.STTS = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00   // entry_count\n        ]);\n\n        constants.STSC = constants.STCO = constants.STTS;\n\n        constants.STSZ = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // sample_size\n            0x00, 0x00, 0x00, 0x00   // sample_count\n        ]);\n\n        constants.HDLR_VIDEO = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // pre_defined\n            0x76, 0x69, 0x64, 0x65,  // handler_type: 'vide'\n            0x00, 0x00, 0x00, 0x00,  // reserved: 3 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x56, 0x69, 0x64, 0x65,\n            0x6F, 0x48, 0x61, 0x6E,\n            0x64, 0x6C, 0x65, 0x72, 0x00  // name: VideoHandler\n        ]);\n\n        constants.HDLR_AUDIO = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // pre_defined\n            0x73, 0x6F, 0x75, 0x6E,  // handler_type: 'soun'\n            0x00, 0x00, 0x00, 0x00,  // reserved: 3 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x53, 0x6F, 0x75, 0x6E,\n            0x64, 0x48, 0x61, 0x6E,\n            0x64, 0x6C, 0x65, 0x72, 0x00  // name: SoundHandler\n        ]);\n\n        constants.DREF = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x01,  // entry_count\n            0x00, 0x00, 0x00, 0x0C,  // entry_size\n            0x75, 0x72, 0x6C, 0x20,  // type 'url '\n            0x00, 0x00, 0x00, 0x01   // version(0) + flags\n        ]);\n\n        // Sound media header\n        constants.SMHD = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00   // balance(2) + reserved(2)\n        ]);\n\n        // video media header\n        constants.VMHD = new Uint8Array([\n            0x00, 0x00, 0x00, 0x01,  // version(0) + flags\n            0x00, 0x00,              // graphicsmode: 2 bytes\n            0x00, 0x00, 0x00, 0x00,  // opcolor: 3 * 2 bytes\n            0x00, 0x00\n        ]);\n    }\n\n    // Generate a box\n    static box(type) {\n        let size = 8;\n        let result;\n        let datas = Array.prototype.slice.call(arguments, 1);\n        let arrayCount = datas.length;\n\n        for (let i = 0; i < arrayCount; i++) {\n            size += datas[i].byteLength;\n        }\n\n        result = new Uint8Array(size);\n        result[0] = (size >>> 24) & 0xFF;  // size\n        result[1] = (size >>> 16) & 0xFF;\n        result[2] = (size >>>  8) & 0xFF;\n        result[3] = (size) & 0xFF;\n\n        result.set(type, 4);  // type\n\n        let offset = 8;\n        for (let i = 0; i < arrayCount; i++) {  // data body\n            result.set(datas[i], offset);\n            offset += datas[i].byteLength;\n        }\n\n        return result;\n    }\n\n    // emit ftyp & moov\n    static generateInitSegment(meta) {\n        let ftyp = MP4.box(MP4.types.ftyp, MP4.constants.FTYP);\n        let moov = MP4.moov(meta);\n\n        let result = new Uint8Array(ftyp.byteLength + moov.byteLength);\n        result.set(ftyp, 0);\n        result.set(moov, ftyp.byteLength);\n        return result;\n    }\n\n    // Movie metadata box\n    static moov(meta) {\n        let mvhd = MP4.mvhd(meta.timescale, meta.duration);\n        let trak = MP4.trak(meta);\n        let mvex = MP4.mvex(meta);\n        return MP4.box(MP4.types.moov, mvhd, trak, mvex);\n    }\n\n    // Movie header box\n    static mvhd(timescale, duration) {\n        return MP4.box(MP4.types.mvhd, new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // creation_time\n            0x00, 0x00, 0x00, 0x00,  // modification_time\n            (timescale >>> 24) & 0xFF,  // timescale: 4 bytes\n            (timescale >>> 16) & 0xFF,\n            (timescale >>>  8) & 0xFF,\n            (timescale) & 0xFF,\n            (duration >>> 24) & 0xFF,   // duration: 4 bytes\n            (duration >>> 16) & 0xFF,\n            (duration >>>  8) & 0xFF,\n            (duration) & 0xFF,\n            0x00, 0x01, 0x00, 0x00,  // Preferred rate: 1.0\n            0x01, 0x00, 0x00, 0x00,  // PreferredVolume(1.0, 2bytes) + reserved(2bytes)\n            0x00, 0x00, 0x00, 0x00,  // reserved: 4 + 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x01, 0x00, 0x00,  // ----begin composition matrix----\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x01, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x40, 0x00, 0x00, 0x00,  // ----end composition matrix----\n            0x00, 0x00, 0x00, 0x00,  // ----begin pre_defined 6 * 4 bytes----\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,  // ----end pre_defined 6 * 4 bytes----\n            0xFF, 0xFF, 0xFF, 0xFF   // next_track_ID\n        ]));\n    }\n\n    // Track box\n    static trak(meta) {\n        return MP4.box(MP4.types.trak, MP4.tkhd(meta), MP4.mdia(meta));\n    }\n\n    // Track header box\n    static tkhd(meta) {\n        let trackId = meta.id, duration = meta.duration;\n        let width = meta.presentWidth, height = meta.presentHeight;\n\n        return MP4.box(MP4.types.tkhd, new Uint8Array([\n            0x00, 0x00, 0x00, 0x07,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // creation_time\n            0x00, 0x00, 0x00, 0x00,  // modification_time\n            (trackId >>> 24) & 0xFF,  // track_ID: 4 bytes\n            (trackId >>> 16) & 0xFF,\n            (trackId >>>  8) & 0xFF,\n            (trackId) & 0xFF,\n            0x00, 0x00, 0x00, 0x00,  // reserved: 4 bytes\n            (duration >>> 24) & 0xFF, // duration: 4 bytes\n            (duration >>> 16) & 0xFF,\n            (duration >>>  8) & 0xFF,\n            (duration) & 0xFF,\n            0x00, 0x00, 0x00, 0x00,  // reserved: 2 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,  // layer(2bytes) + alternate_group(2bytes)\n            0x00, 0x00, 0x00, 0x00,  // volume(2bytes) + reserved(2bytes)\n            0x00, 0x01, 0x00, 0x00,  // ----begin composition matrix----\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x01, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x40, 0x00, 0x00, 0x00,  // ----end composition matrix----\n            (width >>> 8) & 0xFF,    // width and height\n            (width) & 0xFF,\n            0x00, 0x00,\n            (height >>> 8) & 0xFF,\n            (height) & 0xFF,\n            0x00, 0x00\n        ]));\n    }\n\n    // Media Box\n    static mdia(meta) {\n        return MP4.box(MP4.types.mdia, MP4.mdhd(meta), MP4.hdlr(meta), MP4.minf(meta));\n    }\n\n    // Media header box\n    static mdhd(meta) {\n        let timescale = meta.timescale;\n        let duration = meta.duration;\n        return MP4.box(MP4.types.mdhd, new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // creation_time\n            0x00, 0x00, 0x00, 0x00,  // modification_time\n            (timescale >>> 24) & 0xFF,  // timescale: 4 bytes\n            (timescale >>> 16) & 0xFF,\n            (timescale >>>  8) & 0xFF,\n            (timescale) & 0xFF,\n            (duration >>> 24) & 0xFF,   // duration: 4 bytes\n            (duration >>> 16) & 0xFF,\n            (duration >>>  8) & 0xFF,\n            (duration) & 0xFF,\n            0x55, 0xC4,             // language: und (undetermined)\n            0x00, 0x00              // pre_defined = 0\n        ]));\n    }\n\n    // Media handler reference box\n    static hdlr(meta) {\n        let data;\n        if (meta.type === 'audio') {\n            data = MP4.constants.HDLR_AUDIO;\n        } else {\n            data = MP4.constants.HDLR_VIDEO;\n        }\n        return MP4.box(MP4.types.hdlr, data);\n    }\n\n    // Media infomation box\n    static minf(meta) {\n        let xmhd;\n        if (meta.type === 'audio') {\n            xmhd = MP4.box(MP4.types.smhd, MP4.constants.SMHD);\n        } else {\n            xmhd = MP4.box(MP4.types.vmhd, MP4.constants.VMHD);\n        }\n        return MP4.box(MP4.types.minf, xmhd, MP4.dinf(), MP4.stbl(meta));\n    }\n\n    // Data infomation box\n    static dinf() {\n        return MP4.box(MP4.types.dinf,\n            MP4.box(MP4.types.dref, MP4.constants.DREF)\n        );\n    }\n\n    // Sample table box\n    static stbl(meta) {\n        return MP4.box(MP4.types.stbl,  // type: stbl\n            MP4.stsd(meta),  // Sample Description Table\n            MP4.box(MP4.types.stts, MP4.constants.STTS),  // Time-To-Sample\n            MP4.box(MP4.types.stsc, MP4.constants.STSC),  // Sample-To-Chunk\n            MP4.box(MP4.types.stsz, MP4.constants.STSZ),  // Sample size\n            MP4.box(MP4.types.stco, MP4.constants.STCO)   // Chunk offset\n        );\n    }\n\n    // Sample description box\n    static stsd(meta) {\n        if (meta.type === 'audio') {\n            if (meta.codec === 'mp3') {\n                return MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.mp3(meta));\n            }\n            // else: aac -> mp4a\n            return MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.mp4a(meta));\n        } else {\n            return MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.avc1(meta));\n        }\n    }\n\n    static mp3(meta) {\n        let channelCount = meta.channelCount;\n        let sampleRate = meta.audioSampleRate;\n\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // reserved(4)\n            0x00, 0x00, 0x00, 0x01,  // reserved(2) + data_reference_index(2)\n            0x00, 0x00, 0x00, 0x00,  // reserved: 2 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, channelCount,      // channelCount(2)\n            0x00, 0x10,              // sampleSize(2)\n            0x00, 0x00, 0x00, 0x00,  // reserved(4)\n            (sampleRate >>> 8) & 0xFF,  // Audio sample rate\n            (sampleRate) & 0xFF,\n            0x00, 0x00\n        ]);\n\n        return MP4.box(MP4.types['.mp3'], data);\n    }\n\n    static mp4a(meta) {\n        let channelCount = meta.channelCount;\n        let sampleRate = meta.audioSampleRate;\n\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // reserved(4)\n            0x00, 0x00, 0x00, 0x01,  // reserved(2) + data_reference_index(2)\n            0x00, 0x00, 0x00, 0x00,  // reserved: 2 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, channelCount,      // channelCount(2)\n            0x00, 0x10,              // sampleSize(2)\n            0x00, 0x00, 0x00, 0x00,  // reserved(4)\n            (sampleRate >>> 8) & 0xFF,  // Audio sample rate\n            (sampleRate) & 0xFF,\n            0x00, 0x00\n        ]);\n\n        return MP4.box(MP4.types.mp4a, data, MP4.esds(meta));\n    }\n\n    static esds(meta) {\n        let config = meta.config || [];\n        let configSize = config.length;\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version 0 + flags\n\n            0x03,                    // descriptor_type\n            0x17 + configSize,       // length3\n            0x00, 0x01,              // es_id\n            0x00,                    // stream_priority\n\n            0x04,                    // descriptor_type\n            0x0F + configSize,       // length\n            0x40,                    // codec: mpeg4_audio\n            0x15,                    // stream_type: Audio\n            0x00, 0x00, 0x00,        // buffer_size\n            0x00, 0x00, 0x00, 0x00,  // maxBitrate\n            0x00, 0x00, 0x00, 0x00,  // avgBitrate\n\n            0x05                     // descriptor_type\n        ].concat([\n            configSize\n        ]).concat(\n            config\n        ).concat([\n            0x06, 0x01, 0x02         // GASpecificConfig\n        ]));\n        return MP4.box(MP4.types.esds, data);\n    }\n\n    static avc1(meta) {\n        let avcc = meta.avcc;\n        let width = meta.codecWidth, height = meta.codecHeight;\n\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // reserved(4)\n            0x00, 0x00, 0x00, 0x01,  // reserved(2) + data_reference_index(2)\n            0x00, 0x00, 0x00, 0x00,  // pre_defined(2) + reserved(2)\n            0x00, 0x00, 0x00, 0x00,  // pre_defined: 3 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            (width >>> 8) & 0xFF,    // width: 2 bytes\n            (width) & 0xFF,\n            (height >>> 8) & 0xFF,   // height: 2 bytes\n            (height) & 0xFF,\n            0x00, 0x48, 0x00, 0x00,  // horizresolution: 4 bytes\n            0x00, 0x48, 0x00, 0x00,  // vertresolution: 4 bytes\n            0x00, 0x00, 0x00, 0x00,  // reserved: 4 bytes\n            0x00, 0x01,              // frame_count\n            0x0A,                    // strlen\n            0x78, 0x71, 0x71, 0x2F,  // compressorname: 32 bytes\n            0x66, 0x6C, 0x76, 0x2E,\n            0x6A, 0x73, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00,\n            0x00, 0x18,              // depth\n            0xFF, 0xFF               // pre_defined = -1\n        ]);\n        return MP4.box(MP4.types.avc1, data, MP4.box(MP4.types.avcC, avcc));\n    }\n\n    // Movie Extends box\n    static mvex(meta) {\n        return MP4.box(MP4.types.mvex, MP4.trex(meta));\n    }\n\n    // Track Extends box\n    static trex(meta) {\n        let trackId = meta.id;\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            (trackId >>> 24) & 0xFF, // track_ID\n            (trackId >>> 16) & 0xFF,\n            (trackId >>>  8) & 0xFF,\n            (trackId) & 0xFF,\n            0x00, 0x00, 0x00, 0x01,  // default_sample_description_index\n            0x00, 0x00, 0x00, 0x00,  // default_sample_duration\n            0x00, 0x00, 0x00, 0x00,  // default_sample_size\n            0x00, 0x01, 0x00, 0x01   // default_sample_flags\n        ]);\n        return MP4.box(MP4.types.trex, data);\n    }\n\n    // Movie fragment box\n    static moof(track, baseMediaDecodeTime) {\n        return MP4.box(MP4.types.moof, MP4.mfhd(track.sequenceNumber), MP4.traf(track, baseMediaDecodeTime));\n    }\n\n    static mfhd(sequenceNumber) {\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,\n            (sequenceNumber >>> 24) & 0xFF,  // sequence_number: int32\n            (sequenceNumber >>> 16) & 0xFF,\n            (sequenceNumber >>>  8) & 0xFF,\n            (sequenceNumber) & 0xFF\n        ]);\n        return MP4.box(MP4.types.mfhd, data);\n    }\n\n    // Track fragment box\n    static traf(track, baseMediaDecodeTime) {\n        let trackId = track.id;\n\n        // Track fragment header box\n        let tfhd = MP4.box(MP4.types.tfhd, new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) & flags\n            (trackId >>> 24) & 0xFF, // track_ID\n            (trackId >>> 16) & 0xFF,\n            (trackId >>>  8) & 0xFF,\n            (trackId) & 0xFF\n        ]));\n        // Track Fragment Decode Time\n        let tfdt = MP4.box(MP4.types.tfdt, new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) & flags\n            (baseMediaDecodeTime >>> 24) & 0xFF,  // baseMediaDecodeTime: int32\n            (baseMediaDecodeTime >>> 16) & 0xFF,\n            (baseMediaDecodeTime >>>  8) & 0xFF,\n            (baseMediaDecodeTime) & 0xFF\n        ]));\n        let sdtp = MP4.sdtp(track);\n        let trun = MP4.trun(track, sdtp.byteLength + 16 + 16 + 8 + 16 + 8 + 8);\n\n        return MP4.box(MP4.types.traf, tfhd, tfdt, trun, sdtp);\n    }\n\n    // Sample Dependency Type box\n    static sdtp(track) {\n        let samples = track.samples || [];\n        let sampleCount = samples.length;\n        let data = new Uint8Array(4 + sampleCount);\n        // 0~4 bytes: version(0) & flags\n        for (let i = 0; i < sampleCount; i++) {\n            let flags = samples[i].flags;\n            data[i + 4] = (flags.isLeading << 6)    // is_leading: 2 (bit)\n                | (flags.dependsOn << 4)    // sample_depends_on\n                | (flags.isDependedOn << 2) // sample_is_depended_on\n                | (flags.hasRedundancy);    // sample_has_redundancy\n        }\n        return MP4.box(MP4.types.sdtp, data);\n    }\n\n    // Track fragment run box\n    static trun(track, offset) {\n        let samples = track.samples || [];\n        let sampleCount = samples.length;\n        let dataSize = 12 + 16 * sampleCount;\n        let data = new Uint8Array(dataSize);\n        offset += 8 + dataSize;\n\n        data.set([\n            0x00, 0x00, 0x0F, 0x01,      // version(0) & flags\n            (sampleCount >>> 24) & 0xFF, // sample_count\n            (sampleCount >>> 16) & 0xFF,\n            (sampleCount >>>  8) & 0xFF,\n            (sampleCount) & 0xFF,\n            (offset >>> 24) & 0xFF,      // data_offset\n            (offset >>> 16) & 0xFF,\n            (offset >>>  8) & 0xFF,\n            (offset) & 0xFF\n        ], 0);\n\n        for (let i = 0; i < sampleCount; i++) {\n            let duration = samples[i].duration;\n            let size = samples[i].size;\n            let flags = samples[i].flags;\n            let cts = samples[i].cts;\n            data.set([\n                (duration >>> 24) & 0xFF,  // sample_duration\n                (duration >>> 16) & 0xFF,\n                (duration >>>  8) & 0xFF,\n                (duration) & 0xFF,\n                (size >>> 24) & 0xFF,      // sample_size\n                (size >>> 16) & 0xFF,\n                (size >>>  8) & 0xFF,\n                (size) & 0xFF,\n                (flags.isLeading << 2) | flags.dependsOn,  // sample_flags\n                (flags.isDependedOn << 6) | (flags.hasRedundancy << 4) | flags.isNonSync,\n                0x00, 0x00,                // sample_degradation_priority\n                (cts >>> 24) & 0xFF,       // sample_composition_time_offset\n                (cts >>> 16) & 0xFF,\n                (cts >>>  8) & 0xFF,\n                (cts) & 0xFF\n            ], 12 + 16 * i);\n        }\n        return MP4.box(MP4.types.trun, data);\n    }\n\n    static mdat(data) {\n        return MP4.box(MP4.types.mdat, data);\n    }\n\n}\n\nMP4.init();\n\nexport default MP4;\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Represents an media sample (audio / video)\nexport class SampleInfo {\n\n\tconstructor(dts, pts, duration, originalDts, isSync) {\n\t\tthis.dts = dts;\n\t\tthis.pts = pts;\n\t\tthis.duration = duration;\n\t\tthis.originalDts = originalDts;\n\t\tthis.isSyncPoint = isSync;\n\t\tthis.fileposition = null;\n\t}\n\n}\n\n// Media Segment concept is defined in Media Source Extensions spec.\n// Particularly in ISO BMFF format, an Media Segment contains a moof box followed by a mdat box.\nexport class MediaSegmentInfo {\n\n\tconstructor() {\n\t\tthis.beginDts = 0;\n\t\tthis.endDts = 0;\n\t\tthis.beginPts = 0;\n\t\tthis.endPts = 0;\n\t\tthis.originalBeginDts = 0;\n\t\tthis.originalEndDts = 0;\n\t\tthis.syncPoints = [];     // SampleInfo[n], for video IDR frames only\n\t\tthis.firstSample = null;  // SampleInfo\n\t\tthis.lastSample = null;   // SampleInfo\n\t}\n\n\tappendSyncPoint(sampleInfo) {  // also called Random Access Point\n\t\tsampleInfo.isSyncPoint = true;\n\t\tthis.syncPoints.push(sampleInfo);\n\t}\n\n}\n\n// Ordered list for recording video IDR frames, sorted by originalDts\nexport class IDRSampleList {\n\n\tconstructor() {\n\t\tthis._list = [];\n\t}\n\n\tclear() {\n\t\tthis._list = [];\n\t}\n\n\tappendArray(syncPoints) {\n\t\tlet list = this._list;\n\n\t\tif (syncPoints.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (list.length > 0 && syncPoints[0].originalDts < list[list.length - 1].originalDts) {\n\t\t\tthis.clear();\n\t\t}\n\n\t\tArray.prototype.push.apply(list, syncPoints);\n\t}\n\n\tgetLastSyncPointBeforeDts(dts) {\n\t\tif (this._list.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet list = this._list;\n\t\tlet idx = 0;\n\t\tlet last = list.length - 1;\n\t\tlet mid = 0;\n\t\tlet lbound = 0;\n\t\tlet ubound = last;\n\n\t\tif (dts < list[0].dts) {\n\t\t\tidx = 0;\n\t\t\tlbound = ubound + 1;\n\t\t}\n\n\t\twhile (lbound <= ubound) {\n\t\t\tmid = lbound + Math.floor((ubound - lbound) / 2);\n\t\t\tif (mid === last || (dts >= list[mid].dts && dts < list[mid + 1].dts)) {\n\t\t\t\tidx = mid;\n\t\t\t\tbreak;\n\t\t\t} else if (list[mid].dts < dts) {\n\t\t\t\tlbound = mid + 1;\n\t\t\t} else {\n\t\t\t\tubound = mid - 1;\n\t\t\t}\n\t\t}\n\t\treturn this._list[idx];\n\t}\n\n}\n\n// Data structure for recording information of media segments in single track.\nexport class MediaSegmentInfoList {\n\n\tconstructor(type) {\n\t\tthis._type = type;\n\t\tthis._list = [];\n\t\tthis._lastAppendLocation = -1;  // cached last insert location\n\t}\n\n\tget type() {\n\t\treturn this._type;\n\t}\n\n\tget length() {\n\t\treturn this._list.length;\n\t}\n\n\tisEmpty() {\n\t\treturn this._list.length === 0;\n\t}\n\n\tclear() {\n\t\tthis._list = [];\n\t\tthis._lastAppendLocation = -1;\n\t}\n\n\t_searchNearestSegmentBefore(originalBeginDts) {\n\t\tlet list = this._list;\n\t\tif (list.length === 0) {\n\t\t\treturn -2;\n\t\t}\n\t\tlet last = list.length - 1;\n\t\tlet mid = 0;\n\t\tlet lbound = 0;\n\t\tlet ubound = last;\n\n\t\tlet idx = 0;\n\n\t\tif (originalBeginDts < list[0].originalBeginDts) {\n\t\t\tidx = -1;\n\t\t\treturn idx;\n\t\t}\n\n\t\twhile (lbound <= ubound) {\n\t\t\tmid = lbound + Math.floor((ubound - lbound) / 2);\n\t\t\tif (mid === last || (originalBeginDts > list[mid].lastSample.originalDts &&\n\t\t\t\t(originalBeginDts < list[mid + 1].originalBeginDts))) {\n\t\t\t\tidx = mid;\n\t\t\t\tbreak;\n\t\t\t} else if (list[mid].originalBeginDts < originalBeginDts) {\n\t\t\t\tlbound = mid + 1;\n\t\t\t} else {\n\t\t\t\tubound = mid - 1;\n\t\t\t}\n\t\t}\n\t\treturn idx;\n\t}\n\n\t_searchNearestSegmentAfter(originalBeginDts) {\n\t\treturn this._searchNearestSegmentBefore(originalBeginDts) + 1;\n\t}\n\n\tappend(mediaSegmentInfo) {\n\t\tlet list = this._list;\n\t\tlet msi = mediaSegmentInfo;\n\t\tlet lastAppendIdx = this._lastAppendLocation;\n\t\tlet insertIdx = 0;\n\n\t\tif (lastAppendIdx !== -1 && lastAppendIdx < list.length &&\n\t\t\tmsi.originalBeginDts >= list[lastAppendIdx].lastSample.originalDts &&\n\t\t\t((lastAppendIdx === list.length - 1) ||\n\t\t\t\t(lastAppendIdx < list.length - 1 &&\n\t\t\t\t\tmsi.originalBeginDts < list[lastAppendIdx + 1].originalBeginDts))) {\n\t\t\tinsertIdx = lastAppendIdx + 1;  // use cached location idx\n\t\t} else {\n\t\t\tif (list.length > 0) {\n\t\t\t\tinsertIdx = this._searchNearestSegmentBefore(msi.originalBeginDts) + 1;\n\t\t\t}\n\t\t}\n\n\t\tthis._lastAppendLocation = insertIdx;\n\t\tthis._list.splice(insertIdx, 0, msi);\n\t}\n\n\tgetLastSegmentBefore(originalBeginDts) {\n\t\tlet idx = this._searchNearestSegmentBefore(originalBeginDts);\n\t\tif (idx >= 0) {\n\t\t\treturn this._list[idx];\n\t\t} else {  // -1\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tgetLastSampleBefore(originalBeginDts) {\n\t\tlet segment = this.getLastSegmentBefore(originalBeginDts);\n\t\tif (segment != null) {\n\t\t\treturn segment.lastSample;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tgetLastSyncPointBefore(originalBeginDts) {\n\t\tlet segmentIdx = this._searchNearestSegmentBefore(originalBeginDts);\n\t\tlet syncPoints = this._list[segmentIdx].syncPoints;\n\t\twhile (syncPoints.length === 0 && segmentIdx > 0) {\n\t\t\tsegmentIdx--;\n\t\t\tsyncPoints = this._list[segmentIdx].syncPoints;\n\t\t}\n\t\tif (syncPoints.length > 0) {\n\t\t\treturn syncPoints[syncPoints.length - 1];\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * This file is modified from dailymotion's hls.js library (hls.js/src/helper/aac.js)\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass AAC {\n\tstatic getSilentFrame(codec, channelCount) {\n\t\tif (codec === 'mp4a.40.2') {\n\t\t\t// handle LC-AAC\n\t\t\tif (channelCount === 1) {\n\t\t\t\treturn new Uint8Array([0x00, 0xc8, 0x00, 0x80, 0x23, 0x80]);\n\t\t\t} else if (channelCount === 2) {\n\t\t\t\treturn new Uint8Array([0x21, 0x00, 0x49, 0x90, 0x02, 0x19, 0x00, 0x23, 0x80]);\n\t\t\t} else if (channelCount === 3) {\n\t\t\t\treturn new Uint8Array([0x00, 0xc8, 0x00, 0x80, 0x20, 0x84, 0x01, 0x26, 0x40, 0x08, 0x64, 0x00, 0x8e]);\n\t\t\t} else if (channelCount === 4) {\n\t\t\t\treturn new Uint8Array([0x00, 0xc8, 0x00, 0x80, 0x20, 0x84, 0x01, 0x26, 0x40, 0x08, 0x64, 0x00, 0x80, 0x2c, 0x80, 0x08, 0x02, 0x38]);\n\t\t\t} else if (channelCount === 5) {\n\t\t\t\treturn new Uint8Array([0x00, 0xc8, 0x00, 0x80, 0x20, 0x84, 0x01, 0x26, 0x40, 0x08, 0x64, 0x00, 0x82, 0x30, 0x04, 0x99, 0x00, 0x21, 0x90, 0x02, 0x38]);\n\t\t\t} else if (channelCount === 6) {\n\t\t\t\treturn new Uint8Array([0x00, 0xc8, 0x00, 0x80, 0x20, 0x84, 0x01, 0x26, 0x40, 0x08, 0x64, 0x00, 0x82, 0x30, 0x04, 0x99, 0x00, 0x21, 0x90, 0x02, 0x00, 0xb2, 0x00, 0x20, 0x08, 0xe0]);\n\t\t\t}\n\t\t} else {\n\t\t\t// handle HE-AAC (mp4a.40.5 / mp4a.40.29)\n\t\t\tif (channelCount === 1) {\n\t\t\t\t// ffmpeg -y -f lavfi -i \"aevalsrc=0:d=0.05\" -c:a libfdk_aac -profile:a aac_he -b:a 4k output.aac && hexdump -v -e '16/1 \"0x%x,\" \"\\n\"' -v output.aac\n\t\t\t\treturn new Uint8Array([0x1, 0x40, 0x22, 0x80, 0xa3, 0x4e, 0xe6, 0x80, 0xba, 0x8, 0x0, 0x0, 0x0, 0x1c, 0x6, 0xf1, 0xc1, 0xa, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5e]);\n\t\t\t} else if (channelCount === 2) {\n\t\t\t\t// ffmpeg -y -f lavfi -i \"aevalsrc=0|0:d=0.05\" -c:a libfdk_aac -profile:a aac_he_v2 -b:a 4k output.aac && hexdump -v -e '16/1 \"0x%x,\" \"\\n\"' -v output.aac\n\t\t\t\treturn new Uint8Array([0x1, 0x40, 0x22, 0x80, 0xa3, 0x5e, 0xe6, 0x80, 0xba, 0x8, 0x0, 0x0, 0x0, 0x0, 0x95, 0x0, 0x6, 0xf1, 0xa1, 0xa, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5e]);\n\t\t\t} else if (channelCount === 3) {\n\t\t\t\t// ffmpeg -y -f lavfi -i \"aevalsrc=0|0|0:d=0.05\" -c:a libfdk_aac -profile:a aac_he_v2 -b:a 4k output.aac && hexdump -v -e '16/1 \"0x%x,\" \"\\n\"' -v output.aac\n\t\t\t\treturn new Uint8Array([0x1, 0x40, 0x22, 0x80, 0xa3, 0x5e, 0xe6, 0x80, 0xba, 0x8, 0x0, 0x0, 0x0, 0x0, 0x95, 0x0, 0x6, 0xf1, 0xa1, 0xa, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5e]);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n}\n\nexport default AAC;\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nlet Browser = {};\n\nfunction detect() {\n\t// modified from jquery-browser-plugin\n\n\tlet ua = self.navigator.userAgent.toLowerCase();\n\n\tlet match = /(edge)\\/([\\w.]+)/.exec(ua) ||\n\t\t/(opr)[\\/]([\\w.]+)/.exec(ua) ||\n\t\t/(chrome)[ \\/]([\\w.]+)/.exec(ua) ||\n\t\t/(iemobile)[\\/]([\\w.]+)/.exec(ua) ||\n\t\t/(version)(applewebkit)[ \\/]([\\w.]+).*(safari)[ \\/]([\\w.]+)/.exec(ua) ||\n\t\t/(webkit)[ \\/]([\\w.]+).*(version)[ \\/]([\\w.]+).*(safari)[ \\/]([\\w.]+)/.exec(ua) ||\n\t\t/(webkit)[ \\/]([\\w.]+)/.exec(ua) ||\n\t\t/(opera)(?:.*version|)[ \\/]([\\w.]+)/.exec(ua) ||\n\t\t/(msie) ([\\w.]+)/.exec(ua) ||\n\t\tua.indexOf('trident') >= 0 && /(rv)(?::| )([\\w.]+)/.exec(ua) ||\n\t\tua.indexOf('compatible') < 0 && /(firefox)[ \\/]([\\w.]+)/.exec(ua) ||\n\t\t[];\n\n\tlet platform_match = /(ipad)/.exec(ua) ||\n\t\t/(ipod)/.exec(ua) ||\n\t\t/(windows phone)/.exec(ua) ||\n\t\t/(iphone)/.exec(ua) ||\n\t\t/(kindle)/.exec(ua) ||\n\t\t/(android)/.exec(ua) ||\n\t\t/(windows)/.exec(ua) ||\n\t\t/(mac)/.exec(ua) ||\n\t\t/(linux)/.exec(ua) ||\n\t\t/(cros)/.exec(ua) ||\n\t\t[];\n\n\tlet matched = {\n\t\tbrowser: match[5] || match[3] || match[1] || '',\n\t\tversion: match[2] || match[4] || '0',\n\t\tmajorVersion: match[4] || match[2] || '0',\n\t\tplatform: platform_match[0] || ''\n\t};\n\n\tlet browser = {};\n\tif (matched.browser) {\n\t\tbrowser[matched.browser] = true;\n\n\t\tlet versionArray = matched.majorVersion.split('.');\n\t\tbrowser.version = {\n\t\t\tmajor: parseInt(matched.majorVersion, 10),\n\t\t\tstring: matched.version\n\t\t};\n\t\tif (versionArray.length > 1) {\n\t\t\tbrowser.version.minor = parseInt(versionArray[1], 10);\n\t\t}\n\t\tif (versionArray.length > 2) {\n\t\t\tbrowser.version.build = parseInt(versionArray[2], 10);\n\t\t}\n\t}\n\n\tif (matched.platform) {\n\t\tbrowser[matched.platform] = true;\n\t}\n\n\tif (browser.chrome || browser.opr || browser.safari) {\n\t\tbrowser.webkit = true;\n\t}\n\n\t// MSIE. IE11 has 'rv' identifer\n\tif (browser.rv || browser.iemobile) {\n\t\tif (browser.rv) {\n\t\t\tdelete browser.rv;\n\t\t}\n\t\tlet msie = 'msie';\n\t\tmatched.browser = msie;\n\t\tbrowser[msie] = true;\n\t}\n\n\t// Microsoft Edge\n\tif (browser.edge) {\n\t\tdelete browser.edge;\n\t\tlet msedge = 'msedge';\n\t\tmatched.browser = msedge;\n\t\tbrowser[msedge] = true;\n\t}\n\n\t// Opera 15+\n\tif (browser.opr) {\n\t\tlet opera = 'opera';\n\t\tmatched.browser = opera;\n\t\tbrowser[opera] = true;\n\t}\n\n\t// Stock android browsers are marked as Safari\n\tif (browser.safari && browser.android) {\n\t\tlet android = 'android';\n\t\tmatched.browser = android;\n\t\tbrowser[android] = true;\n\t}\n\n\tbrowser.name = matched.browser;\n\tbrowser.platform = matched.platform;\n\n\tfor (let key in Browser) {\n\t\tif (Browser.hasOwnProperty(key)) {\n\t\t\tdelete Browser[key];\n\t\t}\n\t}\n\tObject.assign(Browser, browser);\n}\n\ndetect();\n\nexport default Browser;\n","import {_byteArrayToNumber, _byteArrayToString, _numberToByteArray, _stringToByteArray} from \"../utils/utils\";\nimport Log from \"../utils/logger\";\n\nclass AMF0Object {\n\tTAG = \"AMF0Object\";\n\n\tcommand;\n\ttransaction_id;\n\tcommand_object;\n    additionalInfo;\n\n\tdata;\n\n    params;\n\n\t/**\n\t *\n\t * @param {Object} params\n\t */\n\tconstructor(params) {\n\t\tif(params) {\n            this.params = params;\n\t\t\tLog.d(this.TAG, \"cmd: \" + this.params[0]);\n\t\t}\n\t}\n\n    /**\n     *\n     * @param {Uint8Array} data\n     * @returns {*[]}\n     */\n\tparseAMF0(data) {\n\t\tthis.data = Array.from(data);\n\t\tlet obj = [];\n\n\t\twhile (this.data.length > 0) {\n\t\t\tconst var_type = this.data.shift();\n\n\t\t\tswitch(var_type) {\n\t\t\tcase 0x00: // Number\n\t\t\t\tobj.push(_byteArrayToNumber(this.data.slice(0, 8)));\n\t\t\t\tthis.data = this.data.slice(8);\n\t\t\t\tbreak;\n\n\t\t\tcase 0x01: // boolean\n\t\t\t\tif (this.data.shift() === 0) {\n\t\t\t\t\tobj.push(false);\n\t\t\t\t} else {\n\t\t\t\t\tobj.push(true);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 0x02: // String\n\t\t\t\tlet len = (this.data[0] << 8) | (this.data[1]);\n\t\t\t\tthis.data = this.data.slice(2);\n\n\t\t\t\tobj.push(_byteArrayToString(this.data.slice(0, len)));\n\t\t\t\tthis.data = this.data.slice(len);\n\t\t\t\tbreak;\n\n\t\t\tcase 0x03: // AMF encoded object\n\t\t\t\tobj.push(this._parseAMF0Object());\n\t\t\t\tbreak;\n\n\t\t\tcase 0x05: // NUll\n                obj.push(null);\n\t\t\t\tbreak;\n\n            default:\n                Log.w(this.TAG, \"var_type: \" + var_type + \" not yet implemented\");\n                break;\n\t\t\t}\n\t\t}\n        this.params = obj;\n\t\treturn obj;\n\t}\n\n\t_parseAMF0Object() {\n\t\tlet o2 = {};\n\n\t\twhile (this.data.length > 0) {\n\t\t\tlet keylen = (this.data[0] << 8) | (this.data[1]); this.data = this.data.slice(2);\n\n\t\t\t// Object end marker\n\t\t\tif (keylen === 0 && this.data[0] === 9) {\n\t\t\t\tthis.data = this.data.slice(1);\n\t\t\t\treturn o2;\n\t\t\t}\n\n\t\t\tlet keyName = _byteArrayToString(this.data.slice(0, keylen)); this.data = this.data.slice(keylen);\n\n\t\t\tconst var_type = this.data.shift();\n\n\t\t\tswitch(var_type) {\n            case 0x00: // Number\n                o2[keyName] = _byteArrayToNumber(this.data.slice(0, 8));\n                this.data = this.data.slice(8);\n                break;\n\n            case 0x01: // boolean\n                if (this.data.shift() === 0) {\n                    o2[keyName] = false;\n                } else {\n                    o2[keyName] = true;\n                }\n\n                break;\n\n            case 0x02: // String\n                let len = (this.data[0] << 8) | (this.data[1]);\n                this.data = this.data.slice(2);\n\n                o2[keyName] = _byteArrayToString(this.data.slice(0, len));\n                this.data = this.data.slice(len);\n                break;\n\n            case 0x05:\n                o2[keyName] = null;\n                break;\n\n            default:\n\t\t\t\tLog.w(this.TAG, \"var_type: \" + var_type + \" not yet implemented\");\n                break;\n\t\t\t}\n\t\t}\n\n\t\treturn o2;\n\t}\n\n    /**\n     *\n     * @returns {Uint8Array}\n     */\n\tgetBytes() {\n\t\tlet bytes = [];\n\n        for(let i = 0; i < this.params.length; i++) {\n            const param = this.params[i];\n\n            switch(typeof param){\n            case \"string\":\n                // Command\n                bytes.push(0x02); // String\n                bytes.push(param.length >>> 8);\n                bytes.push(param.length);\n                bytes = bytes.concat(_stringToByteArray(param));\n                break;\n\n            case \"number\":\n                // TransactionID\n                bytes.push(0x00); // Number\n                bytes = bytes.concat(_numberToByteArray(param));\n                break;\n\n            case \"object\":\n                // Command Object\n                bytes.push(0x03); // Object\n\n                for (let key in param) {\n                    let value = param[key];\n                    let keylength = key.length;\n\n                    bytes.push(keylength >>> 8);\n                    bytes.push(keylength);\n                    bytes = bytes.concat(_stringToByteArray(key));\n\n                    switch(typeof value) {\n                    case \"object\":\n                        if (value == null) {\n                            bytes.push(0x05); // Null\n                        }\n\n                        break;\n\n                    case \"string\":\n                        const length = value.length;\n                        bytes.push(0x02);\n                        bytes.push(length >>> 8);\n                        bytes.push(length);\n                        bytes = bytes.concat(_stringToByteArray(value))\n                        break;\n\n                    case \"number\":\n                        bytes.push(0x00);\n                        bytes = bytes.concat(_numberToByteArray(value))\n                        break;\n\n                    case \"boolean\":\n                        bytes.push(0x01);\n                        if (value) bytes.push(0x01);\n                        else bytes.push(0x00);\n                        break;\n\n                    default:\n\t\t\t\t\t\tLog.w(this.TAG, typeof value, \" not yet implementd\");\n                        break;\n                    }\n                }\n\n                bytes.push(0x00); // End Marker\n                bytes.push(0x00);\n                bytes.push(0x09);\n                break;\n\n            case \"boolean\":\n                bytes.push(0x01);\n                if(param) bytes.push(0x01);\n                else bytes.push(0x00);\n                break;\n\n            default:\n\t\t\t\tLog.w(this.TAG, typeof param, \" not yet implementd\");\n                break;\n            }\n        }\n\n\t\treturn new Uint8Array(bytes);\n\t}\n\n    getCommand(){\n        return this.command;\n    }\n\n    getTransactionId(){\n        return this.transaction_id;\n    }\n\n    getCommandObject(){\n        return this.command_object;\n    }\n\n    getAdditionalInfo(){\n        return this.additionalInfo;\n    }\n}\n\nexport default AMF0Object;\n\nconst test = [\n\t0x02, 0x00, 0x07,  0x63, 0x6f, 0x6e, 0x6e, 0x65, 0x63, 0x74, // 7 connect\n\t0x00, 0x3f, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, \t\t// Tid 1\n\t0x03, \t\t// object start\n\t0x00, 0x03,  0x61, 0x70, 0x70,  // key app 3\n\t0x02, 0x00, 0x08, 0x62, 0x75, 0x6e, 0x6b, 0x65, 0x72, 0x74, 0x76, // string bunkertv\n\t0x00, 0x08, 0x66, 0x6c, 0x61, 0x73, 0x68, 0x56, 0x65, 0x72,  // flashVer\n\t0x02, 0x00, 0x0d,  0x4c, 0x4e, 0x58, 0x20, 0x39, 0x2c, 0x30, 0x2c, 0x31, 0x32, 0x34, 0x2c, 0x32, //LNX\n\t0x00, 0x05, 0x74, 0x63, 0x55, 0x72, 0x6c,  // tcUrl...\n\n\t0x02, 0x00, 0x21,  0x72, 0x74, 0x6d, 0x70, 0x3a, 0x2f, 0x2f, 0x62, 0x75, 0x6e, 0x6b, 0x65,\n\t0x72, 0x74, 0x76, 0x2e, 0x6f, 0x72, 0x67, 0x3a, 0x31, 0x39, 0x33, 0x35, 0x2f, 0x62, 0x75, 0x6e,\n\t0x6b, 0x65, 0x72, 0x74, 0x76,\n\n\t0x00, 0x04, 0x66, 0x70, 0x61, 0x64, \t\t//fpad\n\t0x01, 0x00, \t\t\t\t\t// bool false\n\t0x00, 0x0c, 0x63, 0x61, 0x70, 0x61, 0x62, 0x69, 0x6c, 0x69, 0x74, 0x69, 0x65, 0x73,  //capabilities\n\t0x00, 0x40, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x0b, 0x61, 0x75, 0x64, 0x69, 0x6f, 0x43, 0x6f, 0x64, 0x65, 0x63, 0x73, // audio..\n\t0x00, 0x40, 0xaf, 0xce, 0x00, 0x00, 0x00, 0x00, 0x00,\n\n\t0x00, 0x0b, 0x76, 0x69, 0x64, 0x65, 0x6f, 0x43, 0x6f, 0x64, 0x65, 0x63, 0x73, //videocodecs\n\t0x00, 0x40, 0x6f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x0d, 0x76, 0x69, 0x64, 0x65, 0x6f, 0x46, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, //videoFunction\n\t0x00, 0x3f, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x09];","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport WSSConnectionManager from \"./WSSConnectionManager\";\nimport RTMPHandshake from \"../rtmp/RTMPHandshake\";\nimport RTMPMessageHandler from \"../rtmp/RTMPMessageHandler\";\nimport Log from \"../utils/logger\";\n\nconst TAG = \"WebRTMP Worker\";\n\nlet port;\nlet host;\nlet message_handler;\nLog.LEVEL = Log.DEBUG;\n\nconst wss_manager = new WSSConnectionManager();\n\nself.addEventListener('message', function(e) {\n\tlet data = e.data;\n\n\tLog.d(TAG, \"CMD: \" + data.cmd);\n\n\tswitch(data.cmd) {\n\t\tcase \"open\":    // connect WebSocket\n\t\t\thost = data.host;\n\t\t\tport = data.port;\n\n\t\t\twss_manager.open(host, port, (success)=>{\n\t\t\t\tLog.v(TAG, \"open: \" + host + \":\" +port);\n\t\t\t\tif(success){\n\t\t\t\t\tLog.v(TAG, \"WSSConnected\");\n\t\t\t\t\tpostMessage([\"WSSConnected\"]);\n\n\t\t\t\t\tconst handshake = new RTMPHandshake(wss_manager.getSocket());\n\n\t\t\t\t\thandshake.onHandshakeDone = (success)=>{\n\t\t\t\t\t\tif(success){\n\t\t\t\t\t\t\tmessage_handler = new RTMPMessageHandler(wss_manager.getSocket());\n\n\t\t\t\t\t\t\tLog.d(TAG, \"connect to RTMPManager\");\n\n\t\t\t\t\t\t\twss_manager.registerMessageHandler((e)=> {\n\t\t\t\t\t\t\t\tmessage_handler.parseChunk(new Uint8Array(e.data));\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tpostMessage([\"RTMPHandshakeDone\"]);\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tLog.e(TAG, \"Handshake failed\");\n\t\t\t\t\t\t\tpostMessage([\"RTMPHandshakeFailed\"]);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\thandshake.do();\n\n\t\t\t\t} else {\n\t\t\t\t\tLog.v(this.TAG, \"WSSConnectFailed\");\n\t\t\t\t\tpostMessage([\"WSSConnectFailed\"]);\n\t\t\t\t}\n\t\t\t});\n\t\t\tbreak;\n\n\t\tcase \"connect\":             // RTMP Connect Application\n\t\t\tmessage_handler.connect(makeDefaultConnectionParams(data.appName), ()=>{\n\t\t\t\tLog.v(TAG, \"connected\");\n\t\t\t\tpostMessage([\"RTMPConnected\"]);\n\t\t\t});\n\t\t\tbreak;\n\n\t\tcase \"play\":\n\t\t\tmessage_handler.play(data.streamName);\n\t\t\tbreak;\n\n        case \"pause\":\n\t\t\tmessage_handler.pause(data.enable);\n            break;\n\n        case \"disconnect\":\n\t\t\twss_manager.close();\n\t\t\tbreak;\n\n\t\tcase \"loglevels\":\n\t\t\tLog.d(TAG, \"setting loglevels\", data.loglevels);\n\t\t\tLog.loglevels = data.loglevels;\n            break;\n\n\t\tdefault:\n\t\t\tLog.w(TAG, \"Unknown CMD: \" + data.cmd);\n\t\t\tbreak;\n\t}\n\n}, false);\n\nfunction makeDefaultConnectionParams(application){\n\treturn {\n\t\t\"app\": application,\n\t\t\"flashVer\": \"WebRTMP 0,0,1\",\n\t\t\"tcUrl\": \"rtmp://\" + host + \":1935/\" + application,\n\t\t\"fpad\": false,\n\t\t\"capabilities\": 15,\n\t\t\"audioCodecs\": 0x0400,\t// AAC\n\t\t\"videoCodecs\": 0x0080,\t// H264\n\t\t\"videoFunction\": 0\t\t// Seek false\n\t};\n}\n\npostMessage([\"Started\"]);\n\n","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport Log from \"../utils/logger\";\n\nclass WSSConnectionManager{\n    TAG = \"WSSConnectionManager\";\n    host;\n    port;\n    wss;\n\n    /**\n     *\n     * @param {String} host\n     * @param {Number} port\n     * @param callback\n     */\n    open(host, port, callback){\n        this.host = host;\n        Log.v(this.TAG, \"connecting to: \" + host + \":\" + port);\n        this.wss = new WebSocket(\"wss://\" + host + \":\" + port + \"/\");\n\n        this.wss.binaryType = \"arraybuffer\";\n\n        this.wss.onopen = (e)=>{\n            Log.v(this.TAG, e);\n            callback(true);\n        }\n\n        this.wss.onclose = (e)=>{\n            Log.w(this.TAG, e);\n            postMessage([\"ConnectionLost\"]);\n        }\n\n        this.wss.onerror = (e)=>{\n            Log.e(this.TAG, e);\n            callback(false);\n        }\n    }\n\n    registerMessageHandler(cb){\n        this.wss.onmessage = cb;\n    }\n\n    getSocket(){\n        return this.wss;\n    }\n\n    getHost(){\n        return this.host;\n    }\n\n    close(){\n        this.wss.close();\n    }\n}\n\nexport default WSSConnectionManager;\n","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport Log from \"../utils/logger\";\n\nclass RTMPHandshake{\n    TAG = \"RTMPHandshake\";\n    state = 0;\n    onHandshakeDone = null;\n    c1;\n    c2;\n\n    /**\n     *\n     * @param {WebSocket} socket\n     */\n    constructor(socket) {\n        this.socket = socket;\n\n        this.socket.onmessage = (e)=>{\n            Log.v(this.TAG, e.data);\n            this.processServerInput(new Uint8Array(e.data));\n        }\n    }\n\n    /**\n     * Do RTMP Handshake\n     */\n    do(){\n        if(!this.onHandshakeDone) {\n            Log.e(this.TAG, \"onHandshakeDone not defined\");\n            return;\n        }\n\n        Log.v(this.TAG, \"send C0\");\n        this.socket.send(new Uint8Array([0x03]));\n        this.state = 1;\n\n        Log.v(this.TAG, \"send C1\");\n        this.socket.send(this._generateC1());\n        this.state = 2;\n    }\n\n    _generateC1(){\n        const c1 = new Uint8Array(1536);\n\n        for(let i = 0; i < c1.length; i++) {\n            c1[i] = Math.floor(Math.random() * 256);\n        }\n\n        let time = Math.round(Date.now() / 1000);\n\n        c1[0] = (time >>> 24);\n        c1[1] = (time >>> 16);\n        c1[2] = (time >>> 8);\n        c1[3] = (time);\n\n        c1[4] = 0;\n        c1[5] = 0;\n        c1[6] = 0;\n        c1[7] = 0;\n\n        this.c1 = c1;\n        return c1;\n    }\n\n    _generateC2(s1){\n        this.c2 = s1;\n        return this.c2;\n    }\n\n    /**\n     *\n     * @param {Uint8Array} data\n     * @private\n     */\n    _parseS0(data){\n        Log.v(this.TAG, \"S0: \", data);\n\n        if(data[0] !== 0x03) {\n            Log.e(this.TAG, \"S0 response not 0x03\");\n\n        } else {\n            Log.v(this.TAG, \"1st Byte OK\");\n        }\n\n        this.state = 3;\n\n        if(data.length > 1) {\n            Log.v(this.TAG, \"S1 included\");\n            this._parseS1(data.slice(1));\n        }\n    }\n\n    /**\n     *\n     * @param {Uint8Array} data\n     * @private\n     */\n    _parseS1(data){\n        Log.v(this.TAG, \"parse S1: \", data);\n        this.state = 4;\n\n        let s1 = data.slice(0, 1536);\n\n        Log.v(this.TAG, \"send C2\");\n        this.socket.send(this._generateC2(s1));\n\n        this.state = 5;\n\n        if(data.length > 1536) {\n            Log.v(this.TAG, \"S2 included: \" + data.length);\n            this._parseS2(data.slice(1536));\n        }\n    }\n\n    /**\n     *\n     * @param {Uint8Array} data\n     * @private\n     */\n    _parseS2(data) {\n        Log.v(this.TAG, \"parse S2: \", data);\n\n        if(!this._compare(this.c1, data)) {\n            Log.e(this.TAG, \"C1 S1 not equal\");\n            this.onHandshakeDone(false);\n            return;\n        }\n\n        this.state = 6;\n\n        Log.v(this.TAG, \"RTMP Connection established\");\n\n        this.onHandshakeDone(true);\n    }\n\n    _compare(ar1, ar2){\n        for(let i = 0; i < ar1.length; i++){\n            if(ar1[i] !== ar2[i]) return false;\n        }\n\n        return true;\n    }\n\n\n    /**\n     *\n     * @param {Uint8Array} data\n     */\n    processServerInput(data){\n        switch(this.state){\n            case 2:\t\t//\n                this._parseS0(data);\n                break;\n\n            case 3:\n                this._parseS1(data);\n                break;\n\n            case 5:\n                this._parseS2(data);\n                break;\n        }\n    }\n}\n\nexport default RTMPHandshake;\n","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport RTMPMessage from \"./RTMPMessage\";\nimport Chunk from \"./Chunk\";\nimport UserControlMessage from \"./UserControlMessage\";\nimport NetConnection from \"./NetConnection\";\nimport ChunkParser from \"./ChunkParser\";\nimport RTMPMediaMessageHandler from \"./RTMPMediaMessageHandler\";\nimport AMF0Object from \"./AMF0Object\";\nimport Log from \"../utils/logger\";\n\nclass RTMPMessageHandler {\n    TAG = \"RTMPMessageHandler\";\n\n    netconnections = {};\n    chunk_stream_id = 2;\n    trackedCommand = \"\";\n    socket;\n\n    /**\n     *\n     * @param {WebSocket} socket\n     */\n    constructor(socket) {\n        this.socket = socket;\n        this.chunk_parser = new ChunkParser(this);\n        this.media_handler = new RTMPMediaMessageHandler();\n\n        this.media_handler.onError = (type, info)=>{\n            Log.d(this.TAG, type, info);\n            postMessage([\"onError\", type, info]);\n        }\n\n        this.media_handler.onMediaInfo = (mediainfo)=>{\n            Log.d(this.TAG, mediainfo);\n            postMessage([\"onMediaInfo\", mediainfo]);\n        }\n\n        this.media_handler.onMetaDataArrived = (metadata)=>{\n            postMessage([\"onMetaDataArrived\", metadata]);\n        }\n\n        this.media_handler.onScriptDataArrived= (data)=>{\n            postMessage([\"onScriptDataArrived\", data]);\n        }\n\n        this.media_handler.onScriptDataArrived= (data)=>{\n            postMessage([\"onMetaDataArrived\", data]);\n        }\n\n        this.media_handler.onScriptDataArrived= (data)=>{\n            postMessage([\"onMetaDataArrived\", data]);\n        }\n    }\n\n    /**\n     *\n     * @param {Uint8Array} data\n     */\n    parseChunk(data){\n        Log.d(this.TAG, \"parseChunk: \" + data.length);\n        this.chunk_parser.parseChunk(data);\n    }\n\n    /**\n     *\n     * @param {RTMPMessage} msg\n     */\n    onMessage(msg){\n        Log.d(this.TAG, \" onMessage: \" + msg.getMessageType() + \" StreamID:\" + msg.getMessageStreamID());\n\n        switch(msg.getMessageType()){\n        case 1:         // PCM Set Chunk Size\n        case 2:         // PCM Abort Message\n        case 3:         // PCM Acknowledgement\n        case 5:         // PCM Window Acknowledgement Size\n        case 6:         // PCM Set Peer Bandwidth\n            this.netconnections[msg.getMessageStreamID()].parseMessage(msg);\n            break;\n\n        case 4:          // User Control Messages\n            this._handleUserControlMessage(msg);\n            break;\n\n        case 8:         // Audio Message\n            Log.d(this.TAG, \"AUDIOFRAME: \", msg.getPayload());\n            this.media_handler.handleMediaMessage(msg);\n            break;\n\n        case 9:         // Video Message\n            Log.d(this.TAG, \"VIDEOFRAME: \", msg.getPayload());\n            this.media_handler.handleMediaMessage(msg);\n            break;\n\n        case 18:        // Data Message AMF0\n            Log.d(this.TAG, \"DATAFRAME: \", msg.getPayload());\n            this.media_handler.handleMediaMessage(msg);\n            break;\n\n        case 19:        // Shared Object Message AMF0\n            //new SharedObjectMessage(msg.getPayload());\n            break;\n\n        case 20:        // Command Message AMF0\n            const command = new AMF0Object();\n            let cmd = command.parseAMF0(msg.getPayload());\n\n            Log.d(this.TAG, \"AMF0\", cmd);\n\n            switch(cmd[0]) {\n            case \"_result\":\n                switch(this.trackedCommand){\n                case \"connect\":\n                    if(cmd[3].code == \"NetConnection.Connect.Success\") {\n                        Log.d(this.TAG,\"got _result: \" + cmd[3].code);\n                        postMessage([cmd[3].code]);\n                        this.createStream();\n                    }\n                    break;\n\n                case \"createStream\":\n                    Log.d(this.TAG,\"got _result: \" + cmd[3]);\n                    if(cmd[3]) {\n                        postMessage([\"RTMPStreamCreated\"]);\n                    }\n                    break;\n\n                case \"play\":\n                    break;\n                }\n\n                break;\n\n            case \"onStatus\":\n                Log.d(this.TAG,\"onStatus: \" + cmd[3].code);\n                postMessage([cmd[3].code]);\n                break;\n\n            default:\n                Log.w(this.TAG,\"CommandMessage \" + cmd[0] + \" not yet implemented\");\n                break;\n            }\n\n            break;\n\n        case 22:        // Aggregate Message\n            break;\n\n        case 15:        // Data Message AMF3\n        case 16:        // Shared Object Message AMF3\n        case 17:        // Command Message AMF3\n            Log.e(this.TAG,\"AMF3 is not yet implemented\");\n            break;\n\n        default:\n            Log.d(this.TAG,\"[MessageType: \" + RTMPMessage.MessageTypes[msg.getMessageType()] + \"(\" + msg.getMessageType() + \")\");\n            break;\n\n        }\n    }\n\n    /**\n     *\n     * @param {Object} connectionParams\n     * @param {callback} callback\n     */\n    connect(connectionParams, callback){\n        this.callback = callback;\n        const command = new AMF0Object([\n            \"connect\", 1, connectionParams\n        ]);\n\n        //const message_stream_id = this._getNextMessageStreamID();\n\n        let msg = new RTMPMessage(command.getBytes());\n        msg.setMessageType(0x14);\t\t// AMF0 Command\n        msg.setMessageStreamID(0);\n\n        const chunk = new Chunk(msg);\n        chunk.setChunkStreamID(this._getNextChunkStreamID());\n\n        let buf = chunk.getBytes();\n\n        this.netconnections[0] = new NetConnection(0, this);\n\n        this.trackedCommand = \"connect\";\n        this.socket.send(buf);\n    }\n\n    /**\n     *\n     * @param {Object} options\n     */\n    createStream(options){\n        this.trackedCommand = \"createStream\";\n\n        const command = new AMF0Object([\n            \"createStream\", 1, options\n        ]);\n\n        let msg = new RTMPMessage(command.getBytes());\n        msg.setMessageType(0x14);\t\t// AMF0 Command\n        msg.setMessageStreamID(0);\n\n        const chunk = new Chunk(msg);\n        chunk.setChunkStreamID(3);\n\n        let buf = chunk.getBytes();\n\n        this.netconnections[0] = new NetConnection(0, this);\n\n        this.socket.send(buf);\n    }\n\n    /**\n     *\n     * @param {String} streamName\n     */\n    play(streamName){\n        this.trackedCommand = \"play\";\n\n        const command = new AMF0Object([\n            \"play\", 1, null, streamName\n        ]);\n\n        let msg = new RTMPMessage(command.getBytes());\n        msg.setMessageType(0x14);\t\t// AMF0 Command\n        msg.setMessageStreamID(0);\n\n        const chunk = new Chunk(msg);\n        chunk.setChunkStreamID(3);\n\n        let buf = chunk.getBytes();\n\n        this.netconnections[0] = new NetConnection(0, this);\n\n        this.socket.send(buf);\n    }\n\n    /**\n     *\n     * @param {boolean} enable\n     */\n    pause(enable){\n        this.trackedCommand = \"pause\";\n\n        const command = new AMF0Object([\n            \"pause\", 0, null, enable,0\n        ]);\n\n        let msg = new RTMPMessage(command.getBytes());\n        msg.setMessageType(0x14);\t\t// AMF0 Command\n        msg.setMessageStreamID(0);\n\n        const chunk = new Chunk(msg);\n        chunk.setChunkStreamID(3);\n\n        let buf = chunk.getBytes();\n\n        this.netconnections[0] = new NetConnection(0, this);\n\n        this.socket.send(buf);\n    }\n\n    receiveVideo(enable){\n        this.trackedCommand = \"receiveVideo\";\n\n        const command = new AMF0Object([\n            \"receiveVideo\", 0, null, enable\n        ]);\n\n        let msg = new RTMPMessage(command.getBytes());\n        msg.setMessageType(0x14);\t\t// AMF0 Command\n        msg.setMessageStreamID(0);\n\n        const chunk = new Chunk(msg);\n        chunk.setChunkStreamID(3);\n\n        let buf = chunk.getBytes();\n\n        this.netconnections[0] = new NetConnection(0, this);\n\n        this.socket.send(buf);\n    }\n\n    receiveAudio(enable){\n        this.trackedCommand = \"receiveAudio\";\n\n        const command = new AMF0Object([\n            \"receiveAudio\", 0, null, enable\n        ]);\n\n        let msg = new RTMPMessage(command.getBytes());\n        msg.setMessageType(0x14);\t\t// AMF0 Command\n        msg.setMessageStreamID(0);\n\n        const chunk = new Chunk(msg);\n        chunk.setChunkStreamID(3);\n\n        let buf = chunk.getBytes();\n\n        this.netconnections[0] = new NetConnection(0, this);\n\n        this.socket.send(buf);\n    }\n\n    /**\n     *\n     * @param {Number} size\n     */\n    setChunkSize(size){\n        this.chunk_parser.setChunkSize(size);\n    }\n\n    _getNextMessageStreamID(){\n        return this.netconnections.length;\n    }\n\n    _getNextChunkStreamID(){\n        return ++this.chunk_stream_id;      // increase chunk stream id\n    }\n\n    /**\n     *\n     * @param {RTMPMessage} msg\n     * @private\n     */\n    _handleUserControlMessage(msg) {\n        let data = msg.getPayload()\n\n        this.event_type = (data[0] <<8) | data[1];\n        data = data.slice(2);\n\n        switch (this.event_type){\n            case 0x00:      // StreamBegin\n            case 0x01:      // Stream EOF\n            case 0x02:      // StreamDry\n            case 0x04:      // StreamIsRecorded\n                this.event_data1 = (data[0] << 24) | (data[1] << 16) | (data[2] << 8) | (data[3]);\n                break;\n\n\n            case 0x03:      // SetBuffer\n                this.event_data1 = (data[0] << 24) | (data[1] << 16) | (data[2] << 8) | (data[3]);\n                this.event_data2 = (data[4] << 24) | (data[5] << 16) | (data[6] << 8) | (data[7]);\n                break;\n\n            case 0x06:      // PingRequest\n            case 0x07:      // PingResponse\n                this.event_data1 = (data[0] << 24) | (data[1] << 16) | (data[2] << 8) | (data[3]);\n                break;\n        }\n\n        // Handle Ping internal\n        if(this.event_type === 0x06) {  // Ping Request\n            postMessage([\"UserControlMessage\", [\"ping\", this.event_data1]]);\n\n            const msg = new UserControlMessage();\n            msg.setType(0x07);          // Ping Response\n            msg.setEventData(this.event_data1);\n\n\n            let m2 = new RTMPMessage(msg.getBytes());\n            m2.setMessageType(0x04)     // UserControlMessage\n\n            const chunk = new Chunk(m2);\n            chunk.setChunkStreamID(2);  // Control Channel\n\n            Log.i(this.TAG,\"send Pong\");\n            this.socket.send(chunk.getBytes());\n        }\n    }\n}\n\nexport default RTMPMessageHandler;\n\n","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport RTMPMessage from \"./RTMPMessage\";\nimport {_concatArrayBuffers} from \"../utils/utils\";\nimport Log from \"../utils/logger\";\n\nclass ChunkParser {\n    TAG = \"ChunkParser\";\n\n    /**\n     *\n     * @type {number}\n     */\n\tstatic CHUNK_SIZE = 128;\n    chunkstreams = [];\n\n    /**\n     * @type {Uint8Array}\n     */\n    buffer = new Uint8Array(0);\n\n    /**\n     *\n     * @param {RTMPMessageHandler} conn_worker\n     */\n\tconstructor(conn_worker) {\n        this.conn_worker = conn_worker;\n    }\n\n    /**\n     * @param {Uint8Array} newdata\n     */\n    parseChunk(newdata){\n        let msg;\n        let timestamp;\n        let fmt;\n\n        this.buffer = _concatArrayBuffers(this.buffer, newdata);      // Neues Packet an Buffer anfgen\n\n        do {\n            Log.d(this.TAG, \"buffer length: \" + this.buffer.length);\n\n            if(this.buffer.length < 100) Log.d(this.TAG, this.buffer);\n\n            /**\n             *\n             * @type {Uint8Array}\n             */\n            let data = this.buffer;\n            let header_length = 0;\n            let message_length = 0;\n            let payload_length = 0;\n\n            // Message Header Type\n            fmt = ((data[0] & 0xC0) >>> 6);  // upper 2 bit\n\n            // Basic Header ChunkID\n            let csid = data[header_length++] & 0x3f;\t// lower 6 bits\n\n            if(csid === 0) {\t\t\t\t\t// csid is 14bit\n                csid = data[header_length++] + 64;\n\n            } else if (csid === 1) {\t\t\t// csid is 22bit\n                csid = data[header_length++] * 256 + data[header_length++] + 64;\n            }\n\n            Log.d(this.TAG, \"chunk type: \", fmt, \" StreamID: \" + csid);\n\n            let payload;\n\n            // Message\n            switch(fmt) {\n                case 0:\t\t// 11 byte\n                timestamp = (data[header_length++] << 16) | (data[header_length++] << 8) | (data[header_length++]);\t// 3 byte timestamp\n                message_length = (data[header_length++] << 16) | (data[header_length++] << 8) | (data[header_length++]);\t// 3 byte Message length\n\n                msg = new RTMPMessage();\n                msg.setMessageType(data[header_length++]);                // 1 byte msg type\n                msg.setMessageStreamID((data[header_length++] << 24) | (data[header_length++] << 16) | (data[header_length++] << 8) | (data[header_length++]));\t// 4 byte Message stream id\n                msg.setMessageLength(message_length);\n\n                if (timestamp === 0xFFFFFF) {\t// extended Timestamp\n                    timestamp = (data[header_length++] << 24) | (data[header_length++] << 16) | (data[header_length++] << 8) | (data[header_length++]);\n                    msg.setExtendedTimestamp(true);\n                }\n\n                msg.setMessageTimestamp(timestamp);\n\n                Log.d(this.TAG, \"message_length: \" + message_length);\n\n                this.chunkstreams[csid] = msg;\n                break;\n\n            case 1:\t\t// 7 byte\n                timestamp = (data[header_length++] << 16) | (data[header_length++] << 8) | (data[header_length++]);\t// 3 byte timestamp\n                message_length = (data[header_length++] << 16) | (data[header_length++] << 8) | (data[header_length++]);\t// 3 byte Message length\n\n                msg = this.chunkstreams[csid];\n                msg.setMessageType(data[header_length++]);\n                msg.setMessageLength(message_length);\n\n                if (timestamp === 0xFFFFFF) {\t// extended Timestamp\n                    timestamp = (data[header_length++] << 24) | (data[header_length++] << 16) | (data[header_length++] << 8) | (data[header_length++]);\n                    msg.setExtendedTimestamp(true);\n                } else {\n                    msg.setExtendedTimestamp(false);\n                }\n\n                msg.setTimestampDelta(timestamp);\n\n                Log.d(this.TAG, \"message_length: \" + message_length);\n\n                this.chunkstreams[csid] = msg;\n                break;\n\n            case 2:\t\t// 3 byte\n                timestamp = (data[header_length++] << 16) | (data[header_length++] << 8) | (data[header_length++]);\t// 3 byte timestamp delta\n\n                msg = this.chunkstreams[csid];\n\n                if (timestamp === 0xFFFFFF) {\t// extended Timestamp\n                    timestamp = (data[header_length++] << 24) | (data[header_length++] << 16) | (data[header_length++] << 8) | (data[header_length++]);\n                    msg.setExtendedTimestamp(true);\n\n                } else {\n                    msg.setExtendedTimestamp(false);\n                }\n\n                msg.setTimestampDelta(timestamp);\n\n                break;\n\n            case 3:\t\t// 0 byte\n                msg = this.chunkstreams[csid];\n\n                // extended timestamp is present when setted in the chunk stream\n                if(msg.getExtendedTimestamp()) {\n                    timestamp = (data[header_length++] << 24) | (data[header_length++] << 16) | (data[header_length++] << 8) | (data[header_length++]);\n                    msg.setTimestampDelta(timestamp);\n                }\n\n                break;\n            }\n\n            if(!msg) {\n                Log.e(this.TAG, \"No suitable RTMPMessage found\");\n            }\n\n\n\n            payload_length = this.chunkstreams[csid].bytesMissing();\n\n            if(payload_length > this.CHUNK_SIZE) payload_length = this.CHUNK_SIZE;      // Max. CHUNK_SIZE erwarten\n\n            payload = data.slice(header_length, header_length +payload_length);\n\n            // sind genug bytes fr das chunk da?\n            if(payload.length < payload_length){\n                Log.d(this.TAG, \"packet(\" + payload.length + \"/\" + payload_length + \") too small, wait for next\");\n                return;\n            }\n\n            this.chunkstreams[csid].addPayload(payload);\n\n            if(this.chunkstreams[csid].isComplete()) {     // Message complete\n                Log.d(this.TAG, \"RTMP: \", msg.getMessageType(), RTMPMessage.MessageTypes[msg.getMessageType()], msg.getPayloadlength(), msg.getMessageStreamID());\n                this.conn_worker.onMessage(this.chunkstreams[csid]);\n                this.chunkstreams[csid].clearPayload();\n            }\n\n            let consumed = (header_length + payload_length);\n\n            if(consumed > this.buffer.length) {\n                Log.w(this.TAG, \"mehr abschneiden als da\");\n            }\n\n            this.buffer = this.buffer.slice(consumed);\n            Log.d(this.TAG, \"consumed: \" + consumed + \" bytes, rest: \" + this.buffer.length);\n\n        } while(this.buffer.length > 11);   // minimum size\n\n        Log.d(this.TAG, \"parseChunk complete\");\n    }\n\n\n\n    /**\n     *\n     * @param {Number} size\n     */\n    setChunkSize(size){\n        Log.d(this.TAG, \"SetChunkSize: \" + size);\n        this.CHUNK_SIZE = size;\n    }\n}\n\nexport default ChunkParser;\n","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * This was heavily inspired by bilibi FLVPlayer (flv.js/src/demux/flv-demuxer.js)\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport {IllegalStateException} from \"../utils/exception\";\nimport MediaInfo from \"../formats/media-info\";\nimport AMF from \"../flv/amf-parser\";\nimport Log from \"../utils/logger\";\nimport {defaultConfig, DemuxErrors, TransmuxingEvents} from \"../utils/utils\";\nimport SPSParser from \"../flv/sps-parser\";\nimport Transmuxer from \"../flv/transmuxer\";\n\nclass RTMPMediaMessageHandler{\n    TAG = \"RTMPMediaMessageHandler\";\n\n    constructor(config) {\n        this._config = config;\n\n        this._onError = null;\n        this._onMediaInfo = null;\n        this._onMetaDataArrived = null;\n        this._onScriptDataArrived = null;\n        this._onDataAvailable = null;\n        this._onTrackMetadata = null;\n\n        this._dispatch = false;\n\n        this._hasAudio = true;\n        this._hasVideo = true;\n\n        this._hasAudioFlagOverrided = false;\n        this._hasVideoFlagOverrided = false;\n\n        this._audioInitialMetadataDispatched = false;\n        this._videoInitialMetadataDispatched = false;\n\n        this._mediaInfo = new MediaInfo();\n        this._mediaInfo.hasAudio = this._hasAudio;\n        this._mediaInfo.hasVideo = this._hasVideo;\n        this._metadata = null;\n        this._audioMetadata = null;\n        this._videoMetadata = null;\n\n        this._naluLengthSize = 4;\n        this._timestampBase = 0;  // int32, in milliseconds\n        this._timescale = 1000;\n        this._duration = 0;  // int32, in milliseconds\n        this._durationOverrided = false;\n        this._referenceFrameRate = {\n            fixed: true,\n            fps: 23.976,\n            fps_num: 23976,\n            fps_den: 1000\n        };\n\n        this._flvSoundRateTable = [5500, 11025, 22050, 44100, 48000];\n\n        this._mpegSamplingRates = [\n            96000, 88200, 64000, 48000, 44100, 32000,\n            24000, 22050, 16000, 12000, 11025, 8000, 7350\n        ];\n\n        this._mpegAudioV10SampleRateTable = [44100, 48000, 32000, 0];\n        this._mpegAudioV20SampleRateTable = [22050, 24000, 16000, 0];\n        this._mpegAudioV25SampleRateTable = [11025, 12000, 8000,  0];\n\n        this._mpegAudioL1BitRateTable = [0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, -1];\n        this._mpegAudioL2BitRateTable = [0, 32, 48, 56,  64,  80,  96, 112, 128, 160, 192, 224, 256, 320, 384, -1];\n        this._mpegAudioL3BitRateTable = [0, 32, 40, 48,  56,  64,  80,  96, 112, 128, 160, 192, 224, 256, 320, -1];\n\n        this._videoTrack = {type: 'video', id: 1, sequenceNumber: 0, samples: [], length: 0};\n        this._audioTrack = {type: 'audio', id: 2, sequenceNumber: 0, samples: [], length: 0};\n\n        this._littleEndian = (function () {\n            let buf = new ArrayBuffer(2);\n            (new DataView(buf)).setInt16(0, 256, true);  // little-endian write\n            return (new Int16Array(buf))[0] === 256;  // platform-spec read, if equal then LE\n        })();\n\n\n        this.bytePos = 0;\n\n        this._config = defaultConfig;\n        this._transmuxer = new Transmuxer(this._config);\n\n        this._transmuxer.on(TransmuxingEvents.INIT_SEGMENT, (type, is) => {\n            postMessage([TransmuxingEvents.INIT_SEGMENT, type, is]);\n        });\n\n        this._transmuxer.on(TransmuxingEvents.MEDIA_SEGMENT, (type, ms) => {\n            postMessage([TransmuxingEvents.MEDIA_SEGMENT, type, ms]);\n        });\n\n        this._transmuxer.on(TransmuxingEvents.MEDIA_INFO, (mediaInfo) => {\n            this._mediaInfo = mediaInfo;\n            postMessage([TransmuxingEvents.MEDIA_INFO, mediaInfo]);\n        });\n\n        this._transmuxer.on(TransmuxingEvents.METADATA_ARRIVED, (metadata) => {\n            postMessage([TransmuxingEvents.METADATA_ARRIVED, metadata]);\n        });\n\n        this._transmuxer.on(TransmuxingEvents.SCRIPTDATA_ARRIVED, (data) => {\n            postMessage([TransmuxingEvents.SCRIPTDATA_ARRIVED, data]);\n        });\n\n        this._onDataAvailable = (audioTrack, videoTrack) =>{\n            Log.d(this.TAG, \"_onDataAvailable\");\n            this._transmuxer.remux(audioTrack, videoTrack);\n        }\n\n        this._onTrackMetadata = (type, metadata)=>{\n            Log.d(this.TAG, \"_onTrackMetadata\");\n            this._transmuxer._onTrackMetadataReceived(type, metadata);\n        }\n    }\n\n    destroy() {\n        this._mediaInfo = null;\n        this._metadata = null;\n        this._audioMetadata = null;\n        this._videoMetadata = null;\n        this._videoTrack = null;\n        this._audioTrack = null;\n\n        this._onError = null;\n        this._onMediaInfo = null;\n        this._onMetaDataArrived = null;\n        this._onScriptDataArrived = null;\n        this._onTrackMetadata = null;\n        this._onDataAvailable = null;\n    }\n\n    // prototype: function(type: string, metadata: any): void\n    get onTrackMetadata() {\n        return this._onTrackMetadata;\n    }\n\n    set onTrackMetadata(callback) {\n        this._onTrackMetadata = callback;\n    }\n\n    // prototype: function(mediaInfo: MediaInfo): void\n    get onMediaInfo() {\n        return this._onMediaInfo;\n    }\n\n    set onMediaInfo(callback) {\n        this._onMediaInfo = callback;\n    }\n\n    get onMetaDataArrived() {\n        return this._onMetaDataArrived;\n    }\n\n    set onMetaDataArrived(callback) {\n        this._onMetaDataArrived = callback;\n    }\n\n    get onScriptDataArrived() {\n        return this._onScriptDataArrived;\n    }\n\n    set onScriptDataArrived(callback) {\n        this._onScriptDataArrived = callback;\n    }\n\n    // prototype: function(type: number, info: string): void\n    get onError() {\n        return this._onError;\n    }\n\n    set onError(callback) {\n        this._onError = callback;\n    }\n\n    // prototype: function(videoTrack: any, audioTrack: any): void\n    get onDataAvailable() {\n        return this._onDataAvailable;\n    }\n\n    set onDataAvailable(callback) {\n        this._onDataAvailable = callback;\n    }\n\n    // timestamp base for output samples, must be in milliseconds\n    get timestampBase() {\n        return this._timestampBase;\n    }\n\n    set timestampBase(base) {\n        this._timestampBase = base;\n    }\n\n    get overridedDuration() {\n        return this._duration;\n    }\n\n    // Force-override media duration. Must be in milliseconds, int32\n    set overridedDuration(duration) {\n        this._durationOverrided = true;\n        this._duration = duration;\n        this._mediaInfo.duration = duration;\n    }\n\n    // Force-override audio track present flag, boolean\n    set overridedHasAudio(hasAudio) {\n        this._hasAudioFlagOverrided = true;\n        this._hasAudio = hasAudio;\n        this._mediaInfo.hasAudio = hasAudio;\n    }\n\n    // Force-override video track present flag, boolean\n    set overridedHasVideo(hasVideo) {\n        this._hasVideoFlagOverrided = true;\n        this._hasVideo = hasVideo;\n        this._mediaInfo.hasVideo = hasVideo;\n    }\n\n    resetMediaInfo() {\n        this._mediaInfo = new MediaInfo();\n    }\n\n    _isInitialMetadataDispatched() {\n        if (this._hasAudio && this._hasVideo) {  // both audio & video\n            return this._audioInitialMetadataDispatched && this._videoInitialMetadataDispatched;\n        }\n        if (this._hasAudio && !this._hasVideo) {  // audio only\n            return this._audioInitialMetadataDispatched;\n        }\n        if (!this._hasAudio && this._hasVideo) {  // video only\n            return this._videoInitialMetadataDispatched;\n        }\n        return false;\n    }\n\n    /**\n     *\n     * @param {RTMPMessage} msg\n     */\n    handleMediaMessage(msg) {\n        Log.d(this.TAG, \"handleMediaMessage\", msg.getMessageType());\n        if (!this._onError || !this._onMediaInfo || !this._onTrackMetadata || !this._onDataAvailable) {\n            throw new IllegalStateException('Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified');\n        }\n\n        this._dispatch = true;\n\n        let tagType = msg.getMessageType();\n        let timestamp = msg.getTimestamp();\n        let streamId = msg.getMessageStreamID()\n        if (streamId !== 0) {\n            Log.w(this.TAG, 'Meet tag which has StreamID != 0!');\n        }\n\n        Log.d(this.TAG, msg);\n\n        switch (tagType) {\n            case 8:  // Audio\n                this._parseAudioData(msg.getPayload(), timestamp);\n                break;\n            case 9:  // Video\n                this._parseVideoData(msg.getPayload(), timestamp, this.bytePos);\n                break;\n            case 18:  // ScriptDataObject\n                this._parseScriptData(msg.getPayload());\n                break;\n        }\n\n        this.bytePos += msg.getMessageLength() + 11 +1;\n\n        // dispatch parsed frames to consumer (typically, the remuxer)\n        if (this._isInitialMetadataDispatched()) {\n            if (this._dispatch && (this._audioTrack.length || this._videoTrack.length)) {\n                Log.i(this.TAG, \"sedn2\");\n                this._onDataAvailable(this._audioTrack, this._videoTrack);\n            }\n        }\n\n        return;\n    }\n\n    /**\n     *\n     * @param {Uint8Array} payload\n     * @private\n     */\n    _parseScriptData(payload) {\n        let scriptData = AMF.parseScriptData(payload);\n\n        if (scriptData.hasOwnProperty('onMetaData')) {\n            if (scriptData.onMetaData == null || typeof scriptData.onMetaData !== 'object') {\n                Log.w(this.TAG, 'Invalid onMetaData structure!');\n                return;\n            }\n            if (this._metadata) {\n                Log.w(this.TAG, 'Found another onMetaData tag!');\n            }\n            this._metadata = scriptData;\n            let onMetaData = this._metadata.onMetaData;\n\n            if (this._onMetaDataArrived) {\n                this._onMetaDataArrived(Object.assign({}, onMetaData));\n            }\n\n            if (typeof onMetaData.hasAudio === 'boolean') {  // hasAudio\n                if (this._hasAudioFlagOverrided === false) {\n                    this._hasAudio = onMetaData.hasAudio;\n                    this._mediaInfo.hasAudio = this._hasAudio;\n                }\n            }\n            if (typeof onMetaData.hasVideo === 'boolean') {  // hasVideo\n                if (this._hasVideoFlagOverrided === false) {\n                    this._hasVideo = onMetaData.hasVideo;\n                    this._mediaInfo.hasVideo = this._hasVideo;\n                }\n            }\n            if (typeof onMetaData.audiodatarate === 'number') {  // audiodatarate\n                this._mediaInfo.audioDataRate = onMetaData.audiodatarate;\n            }\n            if (typeof onMetaData.videodatarate === 'number') {  // videodatarate\n                this._mediaInfo.videoDataRate = onMetaData.videodatarate;\n            }\n            if (typeof onMetaData.width === 'number') {  // width\n                this._mediaInfo.width = onMetaData.width;\n            }\n            if (typeof onMetaData.height === 'number') {  // height\n                this._mediaInfo.height = onMetaData.height;\n            }\n            if (typeof onMetaData.duration === 'number') {  // duration\n                if (!this._durationOverrided) {\n                    let duration = Math.floor(onMetaData.duration * this._timescale);\n                    this._duration = duration;\n                    this._mediaInfo.duration = duration;\n                }\n            } else {\n                this._mediaInfo.duration = 0;\n            }\n            if (typeof onMetaData.framerate === 'number') {  // framerate\n                let fps_num = Math.floor(onMetaData.framerate * 1000);\n                if (fps_num > 0) {\n                    let fps = fps_num / 1000;\n                    this._referenceFrameRate.fixed = true;\n                    this._referenceFrameRate.fps = fps;\n                    this._referenceFrameRate.fps_num = fps_num;\n                    this._referenceFrameRate.fps_den = 1000;\n                    this._mediaInfo.fps = fps;\n                }\n            }\n            if (typeof onMetaData.keyframes === 'object') {  // keyframes\n                this._mediaInfo.hasKeyframesIndex = true;\n                let keyframes = onMetaData.keyframes;\n                this._mediaInfo.keyframesIndex = this._parseKeyframesIndex(keyframes);\n                onMetaData.keyframes = null;  // keyframes has been extracted, remove it\n            } else {\n                this._mediaInfo.hasKeyframesIndex = false;\n            }\n            this._dispatch = false;\n            this._mediaInfo.metadata = onMetaData;\n            Log.v(this.TAG, 'Parsed onMetaData');\n            if (this._mediaInfo.isComplete()) {\n                this._onMediaInfo(this._mediaInfo);\n            }\n        }\n\n        if (Object.keys(scriptData).length > 0) {\n            if (this._onScriptDataArrived) {\n                this._onScriptDataArrived(Object.assign({}, scriptData));\n            }\n        }\n    }\n\n    _parseKeyframesIndex(keyframes) {\n        let times = [];\n        let filepositions = [];\n\n        // ignore first keyframe which is actually AVC Sequence Header (AVCDecoderConfigurationRecord)\n        for (let i = 1; i < keyframes.times.length; i++) {\n            let time = this._timestampBase + Math.floor(keyframes.times[i] * 1000);\n            times.push(time);\n            filepositions.push(keyframes.filepositions[i]);\n        }\n\n        return {\n            times: times,\n            filepositions: filepositions\n        };\n    }\n\n    /**\n     *\n     * @param {Uint8Array} payload\n     * @param tagTimestamp\n     * @private\n     */\n    _parseAudioData(payload, tagTimestamp) {\n        Log.d(this.TAG, \"_parseAudioData\", tagTimestamp);\n        if (payload.length <= 1) {\n            Log.w(this.TAG, 'Flv: Invalid audio packet, missing SoundData payload!');\n            return;\n        }\n\n        if (this._hasAudioFlagOverrided === true && this._hasAudio === false) {\n            // If hasAudio: false indicated explicitly in MediaDataSource,\n            // Ignore all the audio packets\n            return;\n        }\n\n        let le = this._littleEndian;\n        let v = new DataView(payload.buffer);\n\n        let soundSpec = v.getUint8(0);\n\n        let soundFormat = soundSpec >>> 4;\n        if (soundFormat !== 2 && soundFormat !== 10) {  // MP3 or AAC\n            this._onError(DemuxErrors.CODEC_UNSUPPORTED, 'Flv: Unsupported audio codec idx: ' + soundFormat);\n            return;\n        }\n\n        let soundRate = 0;\n        let soundRateIndex = (soundSpec & 12) >>> 2;\n        if (soundRateIndex >= 0 && soundRateIndex <= 4) {\n            soundRate = this._flvSoundRateTable[soundRateIndex];\n        } else {\n            this._onError(DemuxErrors.FORMAT_ERROR, 'Flv: Invalid audio sample rate idx: ' + soundRateIndex);\n            return;\n        }\n\n        let soundSize = (soundSpec & 2) >>> 1;  // unused\n        let soundType = (soundSpec & 1);\n\n\n        let meta = this._audioMetadata;\n        let track = this._audioTrack;\n\n        if (!meta) {\n            if (this._hasAudio === false && this._hasAudioFlagOverrided === false) {\n                this._hasAudio = true;\n                this._mediaInfo.hasAudio = true;\n            }\n\n            // initial metadata\n            meta = this._audioMetadata = {};\n            meta.type = 'audio';\n            meta.id = track.id;\n            meta.timescale = this._timescale;\n            meta.duration = this._duration;\n            meta.audioSampleRate = soundRate;\n            meta.channelCount = (soundType === 0 ? 1 : 2);\n        }\n\n        if (soundFormat === 10) {  // AAC\n            let aacData = this._parseAACAudioData(payload.slice(1));\n            if (aacData == undefined) {\n                return;\n            }\n\n            if (aacData.packetType === 0) {  // AAC sequence header (AudioSpecificConfig)\n                if (meta.config) {\n                    Log.w(this.TAG, 'Found another AudioSpecificConfig!');\n                }\n                let misc = aacData.data;\n                meta.audioSampleRate = misc.samplingRate;\n                meta.channelCount = misc.channelCount;\n                meta.codec = misc.codec;\n                meta.originalCodec = misc.originalCodec;\n                meta.config = misc.config;\n                // The decode result of an aac sample is 1024 PCM samples\n                meta.refSampleDuration = 1024 / meta.audioSampleRate * meta.timescale;\n                Log.v(this.TAG, 'Parsed AudioSpecificConfig');\n\n                if (this._isInitialMetadataDispatched()) {\n                    // Non-initial metadata, force dispatch (or flush) parsed frames to remuxer\n                    if (this._dispatch && (this._audioTrack.length || this._videoTrack.length)) {\n                        this._onDataAvailable(this._audioTrack, this._videoTrack);\n                    }\n                } else {\n                    this._audioInitialMetadataDispatched = true;\n                }\n                // then notify new metadata\n                this._dispatch = false;\n                Log.i(this.TAG, \"ON!\");\n                this._onTrackMetadata('audio', meta);\n\n                let mi = this._mediaInfo;\n                mi.audioCodec = meta.originalCodec;\n                mi.audioSampleRate = meta.audioSampleRate;\n                mi.audioChannelCount = meta.channelCount;\n                if (mi.hasVideo) {\n                    if (mi.videoCodec != null) {\n                        mi.mimeType = 'video/x-flv; codecs=\"' + mi.videoCodec + ',' + mi.audioCodec + '\"';\n                    }\n                } else {\n                    mi.mimeType = 'video/x-flv; codecs=\"' + mi.audioCodec + '\"';\n                }\n                if (mi.isComplete()) {\n                    this._onMediaInfo(mi);\n                }\n            } else if (aacData.packetType === 1) {  // AAC raw frame data\n                let dts = this._timestampBase + tagTimestamp;\n                let aacSample = {unit: aacData.data, length: aacData.data.byteLength, dts: dts, pts: dts};\n                track.samples.push(aacSample);\n                track.length += aacData.data.length;\n            } else {\n                Log.e(this.TAG, `Flv: Unsupported AAC data type ${aacData.packetType}`);\n            }\n        } else if (soundFormat === 2) {  // MP3\n            if (!meta.codec) {\n                // We need metadata for mp3 audio track, extract info from frame header\n                let misc = this._parseMP3AudioData(payload.slice(1), true);\n                if (misc == undefined) {\n                    return;\n                }\n                meta.audioSampleRate = misc.samplingRate;\n                meta.channelCount = misc.channelCount;\n                meta.codec = misc.codec;\n                meta.originalCodec = misc.originalCodec;\n                // The decode result of an mp3 sample is 1152 PCM samples\n                meta.refSampleDuration = 1152 / meta.audioSampleRate * meta.timescale;\n                Log.v(this.TAG, 'Parsed MPEG Audio Frame Header');\n\n                this._audioInitialMetadataDispatched = true;\n                this._onTrackMetadata('audio', meta);\n\n                let mi = this._mediaInfo;\n                mi.audioCodec = meta.codec;\n                mi.audioSampleRate = meta.audioSampleRate;\n                mi.audioChannelCount = meta.channelCount;\n                mi.audioDataRate = misc.bitRate;\n                if (mi.hasVideo) {\n                    if (mi.videoCodec != null) {\n                        mi.mimeType = 'video/x-flv; codecs=\"' + mi.videoCodec + ',' + mi.audioCodec + '\"';\n                    }\n                } else {\n                    mi.mimeType = 'video/x-flv; codecs=\"' + mi.audioCodec + '\"';\n                }\n                if (mi.isComplete()) {\n                    this._onMediaInfo(mi);\n                }\n            }\n\n            // This packet is always a valid audio packet, extract it\n            let data = this._parseMP3AudioData(payload.slice(1), false);\n            if (data == undefined) {\n                return;\n            }\n            let dts = this._timestampBase + tagTimestamp;\n            let mp3Sample = {unit: data, length: data.byteLength, dts: dts, pts: dts};\n            track.samples.push(mp3Sample);\n            track.length += data.length;\n        }\n    }\n\n    /**\n     *\n     * @param {Uint8Array} payload\n     * @returns {{}}\n     * @private\n     */\n    _parseAACAudioData(payload) {\n        if (payload.length <= 1) {\n            Log.w(this.TAG, 'Flv: Invalid AAC packet, missing AACPacketType or/and Data!');\n            return;\n        }\n\n        let result = {};\n\n        result.packetType = payload[0];\n\n        if (payload[0] === 0) {\n            result.data = this._parseAACAudioSpecificConfig(payload.slice(1));\n        } else {\n            result.data = payload.subarray(1);\n        }\n\n        return result;\n    }\n\n    /**\n     *\n     * @param {Uint8Array} array\n     * @returns {{channelCount: number, codec: string, originalCodec: string, samplingRate: *, config: any[]}}\n     * @private\n     */\n    _parseAACAudioSpecificConfig(array) {\n        let config = null;\n\n        /* Audio Object Type:\n           0: Null\n           1: AAC Main\n           2: AAC LC\n           3: AAC SSR (Scalable Sample Rate)\n           4: AAC LTP (Long Term Prediction)\n           5: HE-AAC / SBR (Spectral Band Replication)\n           6: AAC Scalable\n        */\n\n        let audioObjectType = 0;\n        let originalAudioObjectType = 0;\n        let audioExtensionObjectType = null;\n        let samplingIndex = 0;\n        let extensionSamplingIndex = null;\n\n        // 5 bits\n        audioObjectType = originalAudioObjectType = array[0] >>> 3;\n        // 4 bits\n        samplingIndex = ((array[0] & 0x07) << 1) | (array[1] >>> 7);\n        if (samplingIndex < 0 || samplingIndex >= this._mpegSamplingRates.length) {\n            this._onError(DemuxErrors.FORMAT_ERROR, 'Flv: AAC invalid sampling frequency index!');\n            return;\n        }\n\n        let samplingFrequence = this._mpegSamplingRates[samplingIndex];\n\n        // 4 bits\n        let channelConfig = (array[1] & 0x78) >>> 3;\n        if (channelConfig < 0 || channelConfig >= 8) {\n            this._onError(DemuxErrors.FORMAT_ERROR, 'Flv: AAC invalid channel configuration');\n            return;\n        }\n\n        if (audioObjectType === 5) {  // HE-AAC?\n            // 4 bits\n            extensionSamplingIndex = ((array[1] & 0x07) << 1) | (array[2] >>> 7);\n            // 5 bits\n            audioExtensionObjectType = (array[2] & 0x7C) >>> 2;\n        }\n\n        // workarounds for various browsers\n        let userAgent = self.navigator.userAgent.toLowerCase();\n\n        if (userAgent.indexOf('firefox') !== -1) {\n            // firefox: use SBR (HE-AAC) if freq less than 24kHz\n            if (samplingIndex >= 6) {\n                audioObjectType = 5;\n                config = new Array(4);\n                extensionSamplingIndex = samplingIndex - 3;\n            } else {  // use LC-AAC\n                audioObjectType = 2;\n                config = new Array(2);\n                extensionSamplingIndex = samplingIndex;\n            }\n        } else if (userAgent.indexOf('android') !== -1) {\n            // android: always use LC-AAC\n            audioObjectType = 2;\n            config = new Array(2);\n            extensionSamplingIndex = samplingIndex;\n        } else {\n            // for other browsers, e.g. chrome...\n            // Always use HE-AAC to make it easier to switch aac codec profile\n            audioObjectType = 5;\n            extensionSamplingIndex = samplingIndex;\n            config = new Array(4);\n\n            if (samplingIndex >= 6) {\n                extensionSamplingIndex = samplingIndex - 3;\n            } else if (channelConfig === 1) {  // Mono channel\n                audioObjectType = 2;\n                config = new Array(2);\n                extensionSamplingIndex = samplingIndex;\n            }\n        }\n\n        config[0]  = audioObjectType << 3;\n        config[0] |= (samplingIndex & 0x0F) >>> 1;\n        config[1]  = (samplingIndex & 0x0F) << 7;\n        config[1] |= (channelConfig & 0x0F) << 3;\n        if (audioObjectType === 5) {\n            config[1] |= ((extensionSamplingIndex & 0x0F) >>> 1);\n            config[2]  = (extensionSamplingIndex & 0x01) << 7;\n            // extended audio object type: force to 2 (LC-AAC)\n            config[2] |= (2 << 2);\n            config[3]  = 0;\n        }\n\n        return {\n            config: config,\n            samplingRate: samplingFrequence,\n            channelCount: channelConfig,\n            codec: 'mp4a.40.' + audioObjectType,\n            originalCodec: 'mp4a.40.' + originalAudioObjectType\n        };\n    }\n\n    /**\n     *\n     * @param {Uint8Array} array\n     * @param requestHeader\n     * @returns {*}\n     * @private\n     */\n    _parseMP3AudioData(array, requestHeader) {\n        if (array.length < 4) {\n            Log.w(this.TAG, 'Flv: Invalid MP3 packet, header missing!');\n            return;\n        }\n\n        let result = null;\n\n        if (requestHeader) {\n            if (array[0] !== 0xFF) {\n                return;\n            }\n            let ver = (array[1] >>> 3) & 0x03;\n            let layer = (array[1] & 0x06) >> 1;\n\n            let bitrate_index = (array[2] & 0xF0) >>> 4;\n            let sampling_freq_index = (array[2] & 0x0C) >>> 2;\n\n            let channel_mode = (array[3] >>> 6) & 0x03;\n            let channel_count = channel_mode !== 3 ? 2 : 1;\n\n            let sample_rate = 0;\n            let bit_rate = 0;\n            let object_type = 34;  // Layer-3, listed in MPEG-4 Audio Object Types\n\n            let codec = 'mp3';\n\n            switch (ver) {\n                case 0:  // MPEG 2.5\n                    sample_rate = this._mpegAudioV25SampleRateTable[sampling_freq_index];\n                    break;\n                case 2:  // MPEG 2\n                    sample_rate = this._mpegAudioV20SampleRateTable[sampling_freq_index];\n                    break;\n                case 3:  // MPEG 1\n                    sample_rate = this._mpegAudioV10SampleRateTable[sampling_freq_index];\n                    break;\n            }\n\n            switch (layer) {\n                case 1:  // Layer 3\n                    object_type = 34;\n                    if (bitrate_index < this._mpegAudioL3BitRateTable.length) {\n                        bit_rate = this._mpegAudioL3BitRateTable[bitrate_index];\n                    }\n                    break;\n                case 2:  // Layer 2\n                    object_type = 33;\n                    if (bitrate_index < this._mpegAudioL2BitRateTable.length) {\n                        bit_rate = this._mpegAudioL2BitRateTable[bitrate_index];\n                    }\n                    break;\n                case 3:  // Layer 1\n                    object_type = 32;\n                    if (bitrate_index < this._mpegAudioL1BitRateTable.length) {\n                        bit_rate = this._mpegAudioL1BitRateTable[bitrate_index];\n                    }\n                    break;\n            }\n\n            result = {\n                bitRate: bit_rate,\n                samplingRate: sample_rate,\n                channelCount: channel_count,\n                codec: codec,\n                originalCodec: codec\n            };\n        } else {\n            result = array;\n        }\n\n        return result;\n    }\n\n    /**\n     *\n     * @param {Uint8Array} payload\n     * @param tagTimestamp\n     * @param tagPosition\n     * @private\n     */\n    _parseVideoData(payload, tagTimestamp, tagPosition) {\n        if (payload.length <= 1) {\n            Log.w(this.TAG, 'Flv: Invalid video packet, missing VideoData payload!');\n            return;\n        }\n\n        if (this._hasVideoFlagOverrided === true && this._hasVideo === false) {\n            // If hasVideo: false indicated explicitly in MediaDataSource,\n            // Ignore all the video packets\n            return;\n        }\n\n        let spec = payload[0];\n\n        let frameType = (spec & 240) >>> 4;\n        let codecId = spec & 15;\n\n        if (codecId !== 7) {\n            this._onError(DemuxErrors.CODEC_UNSUPPORTED, `Flv: Unsupported codec in video frame: ${codecId}`);\n            return;\n        }\n\n        this._parseAVCVideoPacket(payload.slice(1), tagTimestamp, tagPosition, frameType);\n    }\n\n    /**\n     *\n     * @param {Uint8Array} payload\n     * @param tagTimestamp\n     * @param tagPosition\n     * @param frameType\n     * @private\n     */\n    _parseAVCVideoPacket(payload, tagTimestamp, tagPosition, frameType) {\n        if (payload.length < 4) {\n            Log.w(this.TAG, 'Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime');\n            return;\n        }\n\n        let le = this._littleEndian;\n        let v = new DataView(payload.buffer);\n\n        let packetType = v.getUint8(0);\n        let cts_unsigned = v.getUint32(0, !le) & 0x00FFFFFF;\n        let cts = (cts_unsigned << 8) >> 8;  // convert to 24-bit signed int\n\n        if (packetType === 0) {  // AVCDecoderConfigurationRecord\n            this._parseAVCDecoderConfigurationRecord(payload.slice(4));\n        } else if (packetType === 1) {  // One or more Nalus\n            this._parseAVCVideoData(payload.slice(4), tagTimestamp, tagPosition, frameType, cts);\n        } else if (packetType === 2) {\n            // empty, AVC end of sequence\n        } else {\n            this._onError(DemuxErrors.FORMAT_ERROR, `Flv: Invalid video packet type ${packetType}`);\n            return;\n        }\n    }\n\n    /**\n     *\n     * @param {Uint8Array} payload\n     * @private\n     */\n    _parseAVCDecoderConfigurationRecord(payload) {\n        if (payload.length < 7) {\n            Log.w(this.TAG, 'Flv: Invalid AVCDecoderConfigurationRecord, lack of data!');\n            return;\n        }\n\n        let meta = this._videoMetadata;\n        let track = this._videoTrack;\n        let le = this._littleEndian;\n        let v = new DataView(payload.buffer);\n\n        if (!meta) {\n            if (this._hasVideo === false && this._hasVideoFlagOverrided === false) {\n                this._hasVideo = true;\n                this._mediaInfo.hasVideo = true;\n            }\n\n            meta = this._videoMetadata = {};\n            meta.type = 'video';\n            meta.id = track.id;\n            meta.timescale = this._timescale;\n            meta.duration = this._duration;\n\n        } else {\n            if (typeof meta.avcc !== 'undefined') {\n                Log.w(this.TAG, 'Found another AVCDecoderConfigurationRecord!');\n            }\n        }\n\n        let version = v.getUint8(0);  // configurationVersion\n        let avcProfile = v.getUint8(1);  // avcProfileIndication\n        let profileCompatibility = v.getUint8(2);  // profile_compatibility\n        let avcLevel = v.getUint8(3);  // AVCLevelIndication\n\n        if (version !== 1 || avcProfile === 0) {\n            this._onError(DemuxErrors.FORMAT_ERROR, 'Flv: Invalid AVCDecoderConfigurationRecord');\n            return;\n        }\n\n        this._naluLengthSize = (v.getUint8(4) & 3) + 1;  // lengthSizeMinusOne\n        if (this._naluLengthSize !== 3 && this._naluLengthSize !== 4) {  // holy shit!!!\n            this._onError(DemuxErrors.FORMAT_ERROR, `Flv: Strange NaluLengthSizeMinusOne: ${this._naluLengthSize - 1}`);\n            return;\n        }\n\n        let spsCount = v.getUint8(5) & 31;  // numOfSequenceParameterSets\n        if (spsCount === 0) {\n            this._onError(DemuxErrors.FORMAT_ERROR, 'Flv: Invalid AVCDecoderConfigurationRecord: No SPS');\n            return;\n        } else if (spsCount > 1) {\n            Log.w(this.TAG, `Flv: Strange AVCDecoderConfigurationRecord: SPS Count = ${spsCount}`);\n        }\n\n        let offset = 6;\n\n        for (let i = 0; i < spsCount; i++) {\n            let len = v.getUint16(offset, !le);  // sequenceParameterSetLength\n            offset += 2;\n\n            if (len === 0) {\n                continue;\n            }\n\n            // Notice: Nalu without startcode header (00 00 00 01)\n            let sps = new Uint8Array(payload.slice(offset, offset + len));\n            offset += len;\n\n            let config = SPSParser.parseSPS(sps);\n            if (i !== 0) {\n                // ignore other sps's config\n                continue;\n            }\n\n            meta.codecWidth = config.codec_size.width;\n            meta.codecHeight = config.codec_size.height;\n            meta.presentWidth = config.present_size.width;\n            meta.presentHeight = config.present_size.height;\n\n            meta.profile = config.profile_string;\n            meta.level = config.level_string;\n            meta.bitDepth = config.bit_depth;\n            meta.chromaFormat = config.chroma_format;\n            meta.sarRatio = config.sar_ratio;\n            meta.frameRate = config.frame_rate;\n\n            if (config.frame_rate.fixed === false ||\n                config.frame_rate.fps_num === 0 ||\n                config.frame_rate.fps_den === 0) {\n                meta.frameRate = this._referenceFrameRate;\n            }\n\n            let fps_den = meta.frameRate.fps_den;\n            let fps_num = meta.frameRate.fps_num;\n            meta.refSampleDuration = meta.timescale * (fps_den / fps_num);\n\n            let codecArray = sps.subarray(1, 4);\n            let codecString = 'avc1.';\n            for (let j = 0; j < 3; j++) {\n                let h = codecArray[j].toString(16);\n                if (h.length < 2) {\n                    h = '0' + h;\n                }\n                codecString += h;\n            }\n            meta.codec = codecString;\n\n            let mi = this._mediaInfo;\n            mi.width = meta.codecWidth;\n            mi.height = meta.codecHeight;\n            mi.fps = meta.frameRate.fps;\n            mi.profile = meta.profile;\n            mi.level = meta.level;\n            mi.refFrames = config.ref_frames;\n            mi.chromaFormat = config.chroma_format_string;\n            mi.sarNum = meta.sarRatio.width;\n            mi.sarDen = meta.sarRatio.height;\n            mi.videoCodec = codecString;\n\n            if (mi.hasAudio) {\n                if (mi.audioCodec != null) {\n                    mi.mimeType = 'video/x-flv; codecs=\"' + mi.videoCodec + ',' + mi.audioCodec + '\"';\n                }\n            } else {\n                mi.mimeType = 'video/x-flv; codecs=\"' + mi.videoCodec + '\"';\n            }\n            if (mi.isComplete()) {\n                this._onMediaInfo(mi);\n            }\n        }\n\n        let ppsCount = v.getUint8(offset);  // numOfPictureParameterSets\n        if (ppsCount === 0) {\n            this._onError(DemuxErrors.FORMAT_ERROR, 'Flv: Invalid AVCDecoderConfigurationRecord: No PPS');\n            return;\n        } else if (ppsCount > 1) {\n            Log.w(this.TAG, `Flv: Strange AVCDecoderConfigurationRecord: PPS Count = ${ppsCount}`);\n        }\n\n        offset++;\n\n        for (let i = 0; i < ppsCount; i++) {\n            let len = v.getUint16(offset, !le);  // pictureParameterSetLength\n            offset += 2;\n\n            if (len === 0) {\n                continue;\n            }\n\n            // pps is useless for extracting video information\n            offset += len;\n        }\n\n        meta.avcc = new Uint8Array(payload.length);\n        meta.avcc.set(new Uint8Array(payload), 0);\n        Log.v(this.TAG, 'Parsed AVCDecoderConfigurationRecord');\n\n        if (this._isInitialMetadataDispatched()) {\n            // flush parsed frames\n            if (this._dispatch && (this._audioTrack.length || this._videoTrack.length)) {\n                this._onDataAvailable(this._audioTrack, this._videoTrack);\n            }\n        } else {\n            this._videoInitialMetadataDispatched = true;\n        }\n        // notify new metadata\n        this._dispatch = false;\n        this._onTrackMetadata('video', meta);\n    }\n\n    _parseAVCVideoData(payload, tagTimestamp, tagPosition, frameType, cts) {\n        Log.v(this.TAG, tagTimestamp, tagPosition, this._timestampBase);\n\n        let le = this._littleEndian;\n        let v = new DataView(payload.buffer);\n\n        let units = [], length = 0;\n\n        let dataSize = payload.length;\n\n        let offset = 0;\n        const lengthSize = this._naluLengthSize;\n        let dts = this._timestampBase + tagTimestamp;\n        let keyframe = (frameType === 1);  // from FLV Frame Type constants\n\n        while (offset < dataSize) {\n            if (offset + 4 >= dataSize) {\n                Log.w(this.TAG, `Malformed Nalu near timestamp ${dts}, offset = ${offset}, dataSize = ${dataSize}`);\n                break;  // data not enough for next Nalu\n            }\n            // Nalu with length-header (AVC1)\n            let naluSize = v.getUint32(offset, !le);  // Big-Endian read\n            if (lengthSize === 3) {\n                naluSize >>>= 8;\n            }\n            if (naluSize > dataSize - lengthSize) {\n                Log.w(this.TAG, `Malformed Nalus near timestamp ${dts}, NaluSize > DataSize!`);\n                return;\n            }\n\n            let unitType = v.getUint8(offset + lengthSize) & 0x1F;\n\n            if (unitType === 5) {  // IDR\n                keyframe = true;\n            }\n\n            let data = new Uint8Array(payload.slice(offset, offset + lengthSize + naluSize));\n            let unit = {type: unitType, data: data};\n            units.push(unit);\n            length += data.byteLength;\n\n            offset += lengthSize + naluSize;\n        }\n\n        if (units.length) {\n            let track = this._videoTrack;\n            let avcSample = {\n                units: units,\n                length: length,\n                isKeyframe: keyframe,\n                dts: dts,\n                cts: cts,\n                pts: (dts + cts)\n            };\n            if (keyframe) {\n                avcSample.fileposition = tagPosition;\n            }\n            track.samples.push(avcSample);\n            track.length += length;\n        }\n    }\n}\n\nexport default RTMPMediaMessageHandler;\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {TransmuxingEvents} from \"../utils/utils\";\nimport EventEmitter from \"../utils/event_emitter\";\nimport MP4Remuxer from \"../formats/mp4-remuxer\";\nimport MediaInfo from \"../formats/media-info\";\nimport Browser from \"../utils/browser\";\nimport Log from \"../utils/logger\";\n\nclass Transmuxer {\n    TAG = 'Transmuxer';\n\n    constructor(config) {\n        this._emitter = new EventEmitter();\n\n        this._config = config;\n\n        this._currentSegmentIndex = 0;\n\n        this._mediaInfo = null;\n        this._ioctl = null;\n\n        this._pendingSeekTime = null;\n        this._pendingResolveSeekPoint = null;\n\n        this._statisticsReporter = null;\n\n        this._remuxer = new MP4Remuxer(this._config);\n        this._remuxer.onInitSegment = this._onRemuxerInitSegmentArrival.bind(this);\n        this._remuxer.onMediaSegment = this._onRemuxerMediaSegmentArrival.bind(this);\n    }\n\n    destroy() {\n        this._mediaInfo = null;\n        this._mediaDataSource = null;\n\n        if (this._statisticsReporter) {\n            this._disableStatisticsReporter();\n        }\n        if (this._ioctl) {\n            this._ioctl.destroy();\n            this._ioctl = null;\n        }\n\n        if (this._remuxer) {\n            this._remuxer.destroy();\n            this._remuxer = null;\n        }\n\n        this._emitter.removeAllListeners();\n        this._emitter = null;\n    }\n\n    on(event, listener) {\n        this._emitter.addListener(event, listener);\n    }\n\n    off(event, listener) {\n        this._emitter.removeListener(event, listener);\n    }\n\n    remux(audioTrack, videoTrack){\n        this._remuxer.remux(audioTrack, videoTrack);\n    }\n\n    _onTrackMetadataReceived(type, metadata) {\n        this._remuxer._onTrackMetadataReceived(type, metadata);\n    }\n\n    stop() {\n        this._internalAbort();\n    }\n\n    _internalAbort() {\n        if (this._ioctl) {\n            this._ioctl.destroy();\n            this._ioctl = null;\n        }\n    }\n\n    _searchSegmentIndexContains(milliseconds) {\n        let segments = this._mediaDataSource.segments;\n        let idx = segments.length - 1;\n\n        for (let i = 0; i < segments.length; i++) {\n            if (milliseconds < segments[i].timestampBase) {\n                idx = i - 1;\n                break;\n            }\n        }\n        return idx;\n    }\n\n    _onMediaInfo(mediaInfo) {\n        if (this._mediaInfo == null) {\n            // Store first segment's mediainfo as global mediaInfo\n            this._mediaInfo = Object.assign({}, mediaInfo);\n            this._mediaInfo.keyframesIndex = null;\n            this._mediaInfo.segments = [];\n            //this._mediaInfo.segmentCount = this._mediaDataSource.segments.length;\n            Object.setPrototypeOf(this._mediaInfo, MediaInfo.prototype);\n        }\n\n        let segmentInfo = Object.assign({}, mediaInfo);\n        Object.setPrototypeOf(segmentInfo, MediaInfo.prototype);\n        this._mediaInfo.segments[this._currentSegmentIndex] = segmentInfo;\n\n        // notify mediaInfo update\n        this._reportSegmentMediaInfo(this._currentSegmentIndex);\n\n        /*\n        if (this._pendingSeekTime != null) {\n            Promise.resolve().then(() => {\n                let target = this._pendingSeekTime;\n                this._pendingSeekTime = null;\n                this.seek(target);\n            });\n        }*/\n    }\n\n    _onMetaDataArrived(metadata) {\n        this._emitter.emit(TransmuxingEvents.METADATA_ARRIVED, metadata);\n    }\n\n    _onScriptDataArrived(data) {\n        this._emitter.emit(TransmuxingEvents.SCRIPTDATA_ARRIVED, data);\n    }\n\n    _onRemuxerInitSegmentArrival(type, initSegment) {\n        this._emitter.emit(TransmuxingEvents.INIT_SEGMENT, type, initSegment);\n    }\n\n    _onRemuxerMediaSegmentArrival(type, mediaSegment) {\n        Log.d(this.TAG, \"_onRemuxerMediaSegmentArrival\");\n        if (this._pendingSeekTime != null) {\n            // Media segments after new-segment cross-seeking should be dropped.\n            return;\n        }\n        this._emitter.emit(TransmuxingEvents.MEDIA_SEGMENT, type, mediaSegment);\n\n        // Resolve pending seekPoint\n        if (this._pendingResolveSeekPoint != null && type === 'video') {\n            let syncPoints = mediaSegment.info.syncPoints;\n            let seekpoint = this._pendingResolveSeekPoint;\n            this._pendingResolveSeekPoint = null;\n\n            // Safari: Pass PTS for recommend_seekpoint\n            if (Browser.safari && syncPoints.length > 0 && syncPoints[0].originalDts === seekpoint) {\n                seekpoint = syncPoints[0].pts;\n            }\n            // else: use original DTS (keyframe.milliseconds)\n\n            this._emitter.emit(TransmuxingEvents.RECOMMEND_SEEKPOINT, seekpoint);\n        }\n    }\n}\n\nexport default Transmuxer;\n","/*\n *\n * Copyright (C) 2023 itNOX. All Rights Reserved.\n *\n * @author Michael Balen <mb@itnox.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport Log from \"../utils/logger\";\n\nclass EventEmitter{\n\tListenerList = [];\n\tTAG = \"EventEmitter\";\n\n\tconstructor() {\n\t}\n\n\t/**\n\t *\n\t * @param {String} event\n\t * @param {Function} listener\n\t */\n\taddEventListener(event, listener){\n\t\tthis.ListenerList.push([event, listener]);\n\t}\n\n\t/**\n\t *\n\t * @param {String} event\n\t * @param {Function} listener\n\t */\n\taddListener(event, listener){\n\t\tthis.ListenerList.push([event, listener]);\n\t}\n\n\n\t/**\n\t *\n\t * @param {String} event\n\t * @param {Function} listener\n\t */\n\tremoveListener(event, listener){\n\t\tfor(let i = 0; i < this.ListenerList.length;i++){\n\t\t\tlet entry = this.ListenerList[i];\n\t\t\tif(entry[0] == event && entry[1] == listener){\n\t\t\t\tthis.ListenerList.splice(i,1);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Remove all listener\n\t */\n\tremoveAllListeners(){\n\t\tthis.ListenerList = [];\n\t}\n\n\t/**\n\t *\n\t * @param {String} event\n\t * @param data\n\t */\n\temit(event, ...data){\n\t\tLog.t(this.TAG, \"emit EVENT: \" + event, ...data);\n\t\tfor(let i = 0; i < this.ListenerList.length;i++){\n\t\t\tlet entry = this.ListenerList[i];\n\t\t\tif(entry[0] === event){\n\t\t\t\tentry[1].call(this, ...data);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport default EventEmitter;\n\n","/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n// Fragmented mp4 remuxer\nimport MP4 from \"./mp4\";\nimport {MediaSegmentInfo, MediaSegmentInfoList, SampleInfo} from \"./media-segment-info\";\nimport AAC from \"./aac-silent\";\nimport {IllegalStateException} from \"../utils/exception\";\nimport Browser from \"../utils/browser\";\nimport Log from \"../utils/logger\";\n\nclass MP4Remuxer {\n\tTAG = 'MP4Remuxer'\n\n\tconstructor(config) {\n\t\tthis._config = config;\n\t\tthis._isLive = (config.isLive === true);\n\n\t\tthis._dtsBase = -1;\n\t\tthis._dtsBaseInited = false;\n\t\tthis._audioDtsBase = Infinity;\n\t\tthis._videoDtsBase = Infinity;\n\t\tthis._audioNextDts = undefined;\n\t\tthis._videoNextDts = undefined;\n\t\tthis._audioStashedLastSample = null;\n\t\tthis._videoStashedLastSample = null;\n\n\t\tthis._audioMeta = null;\n\t\tthis._videoMeta = null;\n\n\t\tthis._audioSegmentInfoList = new MediaSegmentInfoList('audio');\n\t\tthis._videoSegmentInfoList = new MediaSegmentInfoList('video');\n\n\t\tthis._onInitSegment = null;\n\t\tthis._onMediaSegment = null;\n\n\t\t// Workaround for chrome < 50: Always force first sample as a Random Access Point in media segment\n\t\t// see https://bugs.chromium.org/p/chromium/issues/detail?id=229412\n\t\tthis._forceFirstIDR = (Browser.chrome &&\n\t\t\t(Browser.version.major < 50 ||\n\t\t\t\t(Browser.version.major === 50 && Browser.version.build < 2661))) ? true : false;\n\n\t\t// Workaround for IE11/Edge: Fill silent aac frame after keyframe-seeking\n\t\t// Make audio beginDts equals with video beginDts, in order to fix seek freeze\n\t\tthis._fillSilentAfterSeek = (Browser.msedge || Browser.msie);\n\n\t\t// While only FireFox supports 'audio/mp4, codecs=\"mp3\"', use 'audio/mpeg' for chrome, safari, ...\n\t\tthis._mp3UseMpegAudio = !Browser.firefox;\n\n\t\tthis._fillAudioTimestampGap = this._config.fixAudioTimestampGap;\n\t}\n\n\tdestroy() {\n\t\tthis._dtsBase = -1;\n\t\tthis._dtsBaseInited = false;\n\t\tthis._audioMeta = null;\n\t\tthis._videoMeta = null;\n\t\tthis._audioSegmentInfoList.clear();\n\t\tthis._audioSegmentInfoList = null;\n\t\tthis._videoSegmentInfoList.clear();\n\t\tthis._videoSegmentInfoList = null;\n\t\tthis._onInitSegment = null;\n\t\tthis._onMediaSegment = null;\n\t}\n\n\tget onInitSegment() {\n\t\treturn this._onInitSegment;\n\t}\n\n\tset onInitSegment(callback) {\n\t\tthis._onInitSegment = callback;\n\t}\n\n\tget onMediaSegment() {\n\t\treturn this._onMediaSegment;\n\t}\n\n\tset onMediaSegment(callback) {\n\t\tthis._onMediaSegment = callback;\n\t}\n\n\tinsertDiscontinuity() {\n\t\tthis._audioNextDts = this._videoNextDts = undefined;\n\t}\n\n\tseek(originalDts) {\n\t\tthis._audioStashedLastSample = null;\n\t\tthis._videoStashedLastSample = null;\n\t\tthis._videoSegmentInfoList.clear();\n\t\tthis._audioSegmentInfoList.clear();\n\t}\n\n\tremux(audioTrack, videoTrack) {\n\t\tif (!this._onMediaSegment) {\n\t\t\tthrow new IllegalStateException('MP4Remuxer: onMediaSegment callback must be specificed!');\n\t\t}\n\t\tif (!this._dtsBaseInited) {\n\t\t\tthis._calculateDtsBase(audioTrack, videoTrack);\n\t\t}\n\t\tthis._remuxVideo(videoTrack);\n\t\tthis._remuxAudio(audioTrack);\n\t}\n\n\t_onTrackMetadataReceived(type, metadata) {\n\t\tLog.i(this.TAG, \"_onTrackMetadataReceived\");\n\t\tlet metabox = null;\n\n\t\tlet container = 'mp4';\n\t\tlet codec = metadata.codec;\n\n\t\tif (type === 'audio') {\n\t\t\tthis._audioMeta = metadata;\n\t\t\tif (metadata.codec === 'mp3' && this._mp3UseMpegAudio) {\n\t\t\t\t// 'audio/mpeg' for MP3 audio track\n\t\t\t\tcontainer = 'mpeg';\n\t\t\t\tcodec = '';\n\t\t\t\tmetabox = new Uint8Array(0);\n\t\t\t} else {\n\t\t\t\t// 'audio/mp4, codecs=\"codec\"'\n\t\t\t\tmetabox = MP4.generateInitSegment(metadata);\n\t\t\t}\n\t\t} else if (type === 'video') {\n\t\t\tthis._videoMeta = metadata;\n\t\t\tmetabox = MP4.generateInitSegment(metadata);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\t// dispatch metabox (Initialization Segment)\n\t\tif (!this._onInitSegment) {\n\t\t\tthrow new IllegalStateException('MP4Remuxer: onInitSegment callback must be specified!');\n\t\t}\n\t\tthis._onInitSegment(type, {\n\t\t\ttype: type,\n\t\t\tdata: metabox.buffer,\n\t\t\tcodec: codec,\n\t\t\tcontainer: `${type}/${container}`,\n\t\t\tmediaDuration: metadata.duration  // in timescale 1000 (milliseconds)\n\t\t});\n\t}\n\n\t_calculateDtsBase(audioTrack, videoTrack) {\n\t\tif (this._dtsBaseInited) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (audioTrack.samples && audioTrack.samples.length) {\n\t\t\tthis._audioDtsBase = audioTrack.samples[0].dts;\n\t\t}\n\t\tif (videoTrack.samples && videoTrack.samples.length) {\n\t\t\tthis._videoDtsBase = videoTrack.samples[0].dts;\n\t\t}\n\n\t\tthis._dtsBase = Math.min(this._audioDtsBase, this._videoDtsBase);\n\t\tthis._dtsBaseInited = true;\n\t}\n\n\tflushStashedSamples() {\n\t\tlet videoSample = this._videoStashedLastSample;\n\t\tlet audioSample = this._audioStashedLastSample;\n\n\t\tlet videoTrack = {\n\t\t\ttype: 'video',\n\t\t\tid: 1,\n\t\t\tsequenceNumber: 0,\n\t\t\tsamples: [],\n\t\t\tlength: 0\n\t\t};\n\n\t\tif (videoSample != null) {\n\t\t\tvideoTrack.samples.push(videoSample);\n\t\t\tvideoTrack.length = videoSample.length;\n\t\t}\n\n\t\tlet audioTrack = {\n\t\t\ttype: 'audio',\n\t\t\tid: 2,\n\t\t\tsequenceNumber: 0,\n\t\t\tsamples: [],\n\t\t\tlength: 0\n\t\t};\n\n\t\tif (audioSample != null) {\n\t\t\taudioTrack.samples.push(audioSample);\n\t\t\taudioTrack.length = audioSample.length;\n\t\t}\n\n\t\tthis._videoStashedLastSample = null;\n\t\tthis._audioStashedLastSample = null;\n\n\t\tthis._remuxVideo(videoTrack, true);\n\t\tthis._remuxAudio(audioTrack, true);\n\t}\n\n\t_remuxAudio(audioTrack, force) {\n\t\tLog.i(this.TAG, \"_remuxAudio\");\n\t\tif (this._audioMeta == null) {\n\t\t\tLog.w(this.TAG, \"no audioMeta\");\n\t\t\treturn;\n\t\t}\n\n\t\tlet track = audioTrack;\n\t\tlet samples = track.samples;\n\t\tlet dtsCorrection = undefined;\n\t\tlet firstDts = -1, lastDts = -1, lastPts = -1;\n\t\tlet refSampleDuration = this._audioMeta.refSampleDuration;\n\n\t\tlet mpegRawTrack = this._audioMeta.codec === 'mp3' && this._mp3UseMpegAudio;\n\t\tlet firstSegmentAfterSeek = this._dtsBaseInited && this._audioNextDts === undefined;\n\n\t\tlet insertPrefixSilentFrame = false;\n\n\t\tif (!samples || samples.length === 0) {\n\t\t\tLog.w(this.TAG, \"no samples\");\n\t\t\treturn;\n\t\t}\n\t\tif (samples.length === 1 && !force) {\n\t\t\t// If [sample count in current batch] === 1 && (force != true)\n\t\t\t// Ignore and keep in demuxer's queue\n\t\t\tLog.w(this.TAG, \"1 sample\");\n\t\t\treturn;\n\t\t}  // else if (force === true) do remux\n\n\t\tlet offset = 0;\n\t\tlet mdatbox = null;\n\t\tlet mdatBytes = 0;\n\n\t\t// calculate initial mdat size\n\t\tif (mpegRawTrack) {\n\t\t\t// for raw mpeg buffer\n\t\t\toffset = 0;\n\t\t\tmdatBytes = track.length;\n\t\t} else {\n\t\t\t// for fmp4 mdat box\n\t\t\toffset = 8;  // size + type\n\t\t\tmdatBytes = 8 + track.length;\n\t\t}\n\n\n\t\tlet lastSample = null;\n\n\t\t// Pop the lastSample and waiting for stash\n\t\tif (samples.length > 1) {\n\t\t\tlastSample = samples.pop();\n\t\t\tmdatBytes -= lastSample.length;\n\t\t}\n\n\t\t// Insert [stashed lastSample in the previous batch] to the front\n\t\tif (this._audioStashedLastSample != null) {\n\t\t\tlet sample = this._audioStashedLastSample;\n\t\t\tthis._audioStashedLastSample = null;\n\t\t\tsamples.unshift(sample);\n\t\t\tmdatBytes += sample.length;\n\t\t}\n\n\t\t// Stash the lastSample of current batch, waiting for next batch\n\t\tif (lastSample != null) {\n\t\t\tthis._audioStashedLastSample = lastSample;\n\t\t}\n\n\n\t\tlet firstSampleOriginalDts = samples[0].dts - this._dtsBase;\n\n\t\t// calculate dtsCorrection\n\t\tif (this._audioNextDts) {\n\t\t\tdtsCorrection = firstSampleOriginalDts - this._audioNextDts;\n\t\t} else {  // this._audioNextDts == undefined\n\t\t\tif (this._audioSegmentInfoList.isEmpty()) {\n\t\t\t\tdtsCorrection = 0;\n\t\t\t\tif (this._fillSilentAfterSeek && !this._videoSegmentInfoList.isEmpty()) {\n\t\t\t\t\tif (this._audioMeta.originalCodec !== 'mp3') {\n\t\t\t\t\t\tinsertPrefixSilentFrame = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet lastSample = this._audioSegmentInfoList.getLastSampleBefore(firstSampleOriginalDts);\n\t\t\t\tif (lastSample != null) {\n\t\t\t\t\tlet distance = (firstSampleOriginalDts - (lastSample.originalDts + lastSample.duration));\n\t\t\t\t\tif (distance <= 3) {\n\t\t\t\t\t\tdistance = 0;\n\t\t\t\t\t}\n\t\t\t\t\tlet expectedDts = lastSample.dts + lastSample.duration + distance;\n\t\t\t\t\tdtsCorrection = firstSampleOriginalDts - expectedDts;\n\t\t\t\t} else { // lastSample == null, cannot found\n\t\t\t\t\tdtsCorrection = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (insertPrefixSilentFrame) {\n\t\t\t// align audio segment beginDts to match with current video segment's beginDts\n\t\t\tlet firstSampleDts = firstSampleOriginalDts - dtsCorrection;\n\t\t\tlet videoSegment = this._videoSegmentInfoList.getLastSegmentBefore(firstSampleOriginalDts);\n\t\t\tif (videoSegment != null && videoSegment.beginDts < firstSampleDts) {\n\t\t\t\tlet silentUnit = AAC.getSilentFrame(this._audioMeta.originalCodec, this._audioMeta.channelCount);\n\t\t\t\tif (silentUnit) {\n\t\t\t\t\tlet dts = videoSegment.beginDts;\n\t\t\t\t\tlet silentFrameDuration = firstSampleDts - videoSegment.beginDts;\n\t\t\t\t\tLog.v(this.TAG, `InsertPrefixSilentAudio: dts: ${dts}, duration: ${silentFrameDuration}`);\n\t\t\t\t\tsamples.unshift({ unit: silentUnit, dts: dts, pts: dts });\n\t\t\t\t\tmdatBytes += silentUnit.byteLength;\n\t\t\t\t}  // silentUnit == null: Cannot generate, skip\n\t\t\t} else {\n\t\t\t\tinsertPrefixSilentFrame = false;\n\t\t\t}\n\t\t}\n\n\t\tlet mp4Samples = [];\n\n\t\t// Correct dts for each sample, and calculate sample duration. Then output to mp4Samples\n\t\tfor (let i = 0; i < samples.length; i++) {\n\t\t\tlet sample = samples[i];\n\t\t\tlet unit = sample.unit;\n\t\t\tlet originalDts = sample.dts - this._dtsBase;\n\t\t\tlet dts = originalDts;\n\t\t\tlet needFillSilentFrames = false;\n\t\t\tlet silentFrames = null;\n\t\t\tlet sampleDuration = 0;\n\n\t\t\tif (originalDts < -0.001) {\n\t\t\t\tcontinue; //pass the first sample with the invalid dts\n\t\t\t}\n\n\t\t\tif (this._audioMeta.codec !== 'mp3') {\n\t\t\t\t// for AAC codec, we need to keep dts increase based on refSampleDuration\n\t\t\t\tlet curRefDts = originalDts;\n\t\t\t\tconst maxAudioFramesDrift = 3;\n\t\t\t\tif (this._audioNextDts) {\n\t\t\t\t\tcurRefDts = this._audioNextDts;\n\t\t\t\t}\n\n\t\t\t\tdtsCorrection = originalDts - curRefDts;\n\t\t\t\tif (dtsCorrection <= -maxAudioFramesDrift * refSampleDuration) {\n\t\t\t\t\t// If we're overlapping by more than maxAudioFramesDrift number of frame, drop this sample\n\t\t\t\t\tLog.w(this.TAG, `Dropping 1 audio frame (originalDts: ${originalDts} ms ,curRefDts: ${curRefDts} ms)  due to dtsCorrection: ${dtsCorrection} ms overlap.`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\telse if (dtsCorrection >= maxAudioFramesDrift * refSampleDuration && this._fillAudioTimestampGap && !Browser.safari) {\n\t\t\t\t\t// Silent frame generation, if large timestamp gap detected && config.fixAudioTimestampGap\n\t\t\t\t\tneedFillSilentFrames = true;\n\t\t\t\t\t// We need to insert silent frames to fill timestamp gap\n\t\t\t\t\tlet frameCount = Math.floor(dtsCorrection / refSampleDuration);\n\t\t\t\t\tLog.w(this.TAG, 'Large audio timestamp gap detected, may cause AV sync to drift. ' +\n\t\t\t\t\t\t'Silent frames will be generated to avoid unsync.\\n' +\n\t\t\t\t\t\t`originalDts: ${originalDts} ms, curRefDts: ${curRefDts} ms, ` +\n\t\t\t\t\t\t`dtsCorrection: ${Math.round(dtsCorrection)} ms, generate: ${frameCount} frames`);\n\n\n\t\t\t\t\tdts = Math.floor(curRefDts);\n\t\t\t\t\tsampleDuration = Math.floor(curRefDts + refSampleDuration) - dts;\n\n\t\t\t\t\tlet silentUnit = AAC.getSilentFrame(this._audioMeta.originalCodec, this._audioMeta.channelCount);\n\t\t\t\t\tif (silentUnit == null) {\n\t\t\t\t\t\tLog.w(this.TAG, 'Unable to generate silent frame for ' +\n\t\t\t\t\t\t\t`${this._audioMeta.originalCodec} with ${this._audioMeta.channelCount} channels, repeat last frame`);\n\t\t\t\t\t\t// Repeat last frame\n\t\t\t\t\t\tsilentUnit = unit;\n\t\t\t\t\t}\n\t\t\t\t\tsilentFrames = [];\n\n\t\t\t\t\tfor (let j = 0; j < frameCount; j++) {\n\t\t\t\t\t\tcurRefDts = curRefDts + refSampleDuration;\n\t\t\t\t\t\tlet intDts = Math.floor(curRefDts);  // change to integer\n\t\t\t\t\t\tlet intDuration = Math.floor(curRefDts + refSampleDuration) - intDts;\n\t\t\t\t\t\tlet frame = {\n\t\t\t\t\t\t\tdts: intDts,\n\t\t\t\t\t\t\tpts: intDts,\n\t\t\t\t\t\t\tcts: 0,\n\t\t\t\t\t\t\tunit: silentUnit,\n\t\t\t\t\t\t\tsize: silentUnit.byteLength,\n\t\t\t\t\t\t\tduration: intDuration,  // wait for next sample\n\t\t\t\t\t\t\toriginalDts: originalDts,\n\t\t\t\t\t\t\tflags: {\n\t\t\t\t\t\t\t\tisLeading: 0,\n\t\t\t\t\t\t\t\tdependsOn: 1,\n\t\t\t\t\t\t\t\tisDependedOn: 0,\n\t\t\t\t\t\t\t\thasRedundancy: 0\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tsilentFrames.push(frame);\n\t\t\t\t\t\tmdatBytes += frame.size;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._audioNextDts = curRefDts + refSampleDuration;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tdts = Math.floor(curRefDts);\n\t\t\t\t\tsampleDuration = Math.floor(curRefDts + refSampleDuration) - dts;\n\t\t\t\t\tthis._audioNextDts = curRefDts + refSampleDuration;\n\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// keep the original dts calculate algorithm for mp3\n\t\t\t\tdts = originalDts - dtsCorrection;\n\n\n\t\t\t\tif (i !== samples.length - 1) {\n\t\t\t\t\tlet nextDts = samples[i + 1].dts - this._dtsBase - dtsCorrection;\n\t\t\t\t\tsampleDuration = nextDts - dts;\n\t\t\t\t} else {  // the last sample\n\t\t\t\t\tif (lastSample != null) {  // use stashed sample's dts to calculate sample duration\n\t\t\t\t\t\tlet nextDts = lastSample.dts - this._dtsBase - dtsCorrection;\n\t\t\t\t\t\tsampleDuration = nextDts - dts;\n\t\t\t\t\t} else if (mp4Samples.length >= 1) {  // use second last sample duration\n\t\t\t\t\t\tsampleDuration = mp4Samples[mp4Samples.length - 1].duration;\n\t\t\t\t\t} else {  // the only one sample, use reference sample duration\n\t\t\t\t\t\tsampleDuration = Math.floor(refSampleDuration);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._audioNextDts = dts + sampleDuration;\n\t\t\t}\n\n\t\t\tif (firstDts === -1) {\n\t\t\t\tfirstDts = dts;\n\t\t\t}\n\t\t\tmp4Samples.push({\n\t\t\t\tdts: dts,\n\t\t\t\tpts: dts,\n\t\t\t\tcts: 0,\n\t\t\t\tunit: sample.unit,\n\t\t\t\tsize: sample.unit.byteLength,\n\t\t\t\tduration: sampleDuration,\n\t\t\t\toriginalDts: originalDts,\n\t\t\t\tflags: {\n\t\t\t\t\tisLeading: 0,\n\t\t\t\t\tdependsOn: 1,\n\t\t\t\t\tisDependedOn: 0,\n\t\t\t\t\thasRedundancy: 0\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (needFillSilentFrames) {\n\t\t\t\t// Silent frames should be inserted after wrong-duration frame\n\t\t\t\tmp4Samples.push.apply(mp4Samples, silentFrames);\n\t\t\t}\n\t\t}\n\n\t\tif (mp4Samples.length === 0) {\n\t\t\t//no samples need to remux\n\t\t\ttrack.samples = [];\n\t\t\ttrack.length = 0;\n\t\t\tLog.w(this.TAG, \"no mp4Samples = 0\");\n\t\t\treturn;\n\t\t}\n\n\t\t// allocate mdatbox\n\t\tif (mpegRawTrack) {\n\t\t\t// allocate for raw mpeg buffer\n\t\t\tmdatbox = new Uint8Array(mdatBytes);\n\t\t} else {\n\t\t\t// allocate for fmp4 mdat box\n\t\t\tmdatbox = new Uint8Array(mdatBytes);\n\t\t\t// size field\n\t\t\tmdatbox[0] = (mdatBytes >>> 24) & 0xFF;\n\t\t\tmdatbox[1] = (mdatBytes >>> 16) & 0xFF;\n\t\t\tmdatbox[2] = (mdatBytes >>> 8) & 0xFF;\n\t\t\tmdatbox[3] = (mdatBytes) & 0xFF;\n\t\t\t// type field (fourCC)\n\t\t\tmdatbox.set(MP4.types.mdat, 4);\n\t\t}\n\n\t\t// Write samples into mdatbox\n\t\tfor (let i = 0; i < mp4Samples.length; i++) {\n\t\t\tlet unit = mp4Samples[i].unit;\n\t\t\tmdatbox.set(unit, offset);\n\t\t\toffset += unit.byteLength;\n\t\t}\n\n\t\tlet latest = mp4Samples[mp4Samples.length - 1];\n\t\tlastDts = latest.dts + latest.duration;\n\t\t//this._audioNextDts = lastDts;\n\n\t\t// fill media segment info & add to info list\n\t\tlet info = new MediaSegmentInfo();\n\t\tinfo.beginDts = firstDts;\n\t\tinfo.endDts = lastDts;\n\t\tinfo.beginPts = firstDts;\n\t\tinfo.endPts = lastDts;\n\t\tinfo.originalBeginDts = mp4Samples[0].originalDts;\n\t\tinfo.originalEndDts = latest.originalDts + latest.duration;\n\t\tinfo.firstSample = new SampleInfo(mp4Samples[0].dts,\n\t\t\tmp4Samples[0].pts,\n\t\t\tmp4Samples[0].duration,\n\t\t\tmp4Samples[0].originalDts,\n\t\t\tfalse);\n\t\tinfo.lastSample = new SampleInfo(latest.dts,\n\t\t\tlatest.pts,\n\t\t\tlatest.duration,\n\t\t\tlatest.originalDts,\n\t\t\tfalse);\n\t\tif (!this._isLive) {\n\t\t\tthis._audioSegmentInfoList.append(info);\n\t\t}\n\n\t\ttrack.samples = mp4Samples;\n\t\ttrack.sequenceNumber++;\n\n\t\tlet moofbox;\n\n\t\tif (mpegRawTrack) {\n\t\t\t// Generate empty buffer, because useless for raw mpeg\n\t\t\tmoofbox = new Uint8Array(0);\n\t\t} else {\n\t\t\t// Generate moof for fmp4 segment\n\t\t\tmoofbox = MP4.moof(track, firstDts);\n\t\t}\n\n\t\ttrack.samples = [];\n\t\ttrack.length = 0;\n\n\t\tlet segment = {\n\t\t\ttype: 'audio',\n\t\t\tdata: this._mergeBoxes(moofbox, mdatbox).buffer,\n\t\t\tsampleCount: mp4Samples.length,\n\t\t\tinfo: info\n\t\t};\n\n\t\tif (mpegRawTrack && firstSegmentAfterSeek) {\n\t\t\t// For MPEG audio stream in MSE, if seeking occurred, before appending new buffer\n\t\t\t// We need explicitly set timestampOffset to the desired point in timeline for mpeg SourceBuffer.\n\t\t\tsegment.timestampOffset = firstDts;\n\t\t}\n\n\t\tLog.i(this.TAG, \"send onMediaSegment audio\");\n\t\tthis._onMediaSegment('audio', segment);\n\t}\n\n\t_remuxVideo(videoTrack, force) {\n\t\tLog.i(this.TAG, \"_remuxVideo\");\n\t\tif (this._videoMeta == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet track = videoTrack;\n\t\tlet samples = track.samples;\n\t\tlet dtsCorrection = undefined;\n\t\tlet firstDts = -1, lastDts = -1;\n\t\tlet firstPts = -1, lastPts = -1;\n\n\t\tif (!samples || samples.length === 0) {\n\t\t\tLog.w(this.TAG, \"no samples\");\n\t\t\treturn;\n\t\t}\n\t\tif (samples.length === 1 && !force) {\n\t\t\t// If [sample count in current batch] === 1 && (force != true)\n\t\t\t// Ignore and keep in demuxer's queue\n\t\t\tLog.w(this.TAG, \"no sampes = 1\");\n\t\t\treturn;\n\t\t}  // else if (force === true) do remux\n\n\t\tlet offset = 8;\n\t\tlet mdatbox = null;\n\t\tlet mdatBytes = 8 + videoTrack.length;\n\n\n\t\tlet lastSample = null;\n\n\t\t// Pop the lastSample and waiting for stash\n\t\tif (samples.length > 1) {\n\t\t\tlastSample = samples.pop();\n\t\t\tmdatBytes -= lastSample.length;\n\t\t}\n\n\t\t// Insert [stashed lastSample in the previous batch] to the front\n\t\tif (this._videoStashedLastSample != null) {\n\t\t\tlet sample = this._videoStashedLastSample;\n\t\t\tthis._videoStashedLastSample = null;\n\t\t\tsamples.unshift(sample);\n\t\t\tmdatBytes += sample.length;\n\t\t}\n\n\t\t// Stash the lastSample of current batch, waiting for next batch\n\t\tif (lastSample != null) {\n\t\t\tthis._videoStashedLastSample = lastSample;\n\t\t}\n\n\n\t\tlet firstSampleOriginalDts = samples[0].dts - this._dtsBase;\n\n\t\t// calculate dtsCorrection\n\t\tif (this._videoNextDts) {\n\t\t\tdtsCorrection = firstSampleOriginalDts - this._videoNextDts;\n\t\t} else {  // this._videoNextDts == undefined\n\t\t\tif (this._videoSegmentInfoList.isEmpty()) {\n\t\t\t\tdtsCorrection = 0;\n\t\t\t} else {\n\t\t\t\tlet lastSample = this._videoSegmentInfoList.getLastSampleBefore(firstSampleOriginalDts);\n\t\t\t\tif (lastSample != null) {\n\t\t\t\t\tlet distance = (firstSampleOriginalDts - (lastSample.originalDts + lastSample.duration));\n\t\t\t\t\tif (distance <= 3) {\n\t\t\t\t\t\tdistance = 0;\n\t\t\t\t\t}\n\t\t\t\t\tlet expectedDts = lastSample.dts + lastSample.duration + distance;\n\t\t\t\t\tdtsCorrection = firstSampleOriginalDts - expectedDts;\n\t\t\t\t} else { // lastSample == null, cannot found\n\t\t\t\t\tdtsCorrection = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet info = new MediaSegmentInfo();\n\t\tlet mp4Samples = [];\n\n\t\t// Correct dts for each sample, and calculate sample duration. Then output to mp4Samples\n\t\tfor (let i = 0; i < samples.length; i++) {\n\t\t\tlet sample = samples[i];\n\t\t\tlet originalDts = sample.dts - this._dtsBase;\n\t\t\tlet isKeyframe = sample.isKeyframe;\n\t\t\tlet dts = originalDts - dtsCorrection;\n\t\t\tlet cts = sample.cts;\n\t\t\tlet pts = dts + cts;\n\n\t\t\tif (firstDts === -1) {\n\t\t\t\tfirstDts = dts;\n\t\t\t\tfirstPts = pts;\n\t\t\t}\n\n\t\t\tlet sampleDuration = 0;\n\n\t\t\tif (i !== samples.length - 1) {\n\t\t\t\tlet nextDts = samples[i + 1].dts - this._dtsBase - dtsCorrection;\n\t\t\t\tsampleDuration = nextDts - dts;\n\t\t\t} else {  // the last sample\n\t\t\t\tif (lastSample != null) {  // use stashed sample's dts to calculate sample duration\n\t\t\t\t\tlet nextDts = lastSample.dts - this._dtsBase - dtsCorrection;\n\t\t\t\t\tsampleDuration = nextDts - dts;\n\t\t\t\t} else if (mp4Samples.length >= 1) {  // use second last sample duration\n\t\t\t\t\tsampleDuration = mp4Samples[mp4Samples.length - 1].duration;\n\t\t\t\t} else {  // the only one sample, use reference sample duration\n\t\t\t\t\tsampleDuration = Math.floor(this._videoMeta.refSampleDuration);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isKeyframe) {\n\t\t\t\tlet syncPoint = new SampleInfo(dts, pts, sampleDuration, sample.dts, true);\n\t\t\t\tsyncPoint.fileposition = sample.fileposition;\n\t\t\t\tinfo.appendSyncPoint(syncPoint);\n\t\t\t}\n\n\t\t\tmp4Samples.push({\n\t\t\t\tdts: dts,\n\t\t\t\tpts: pts,\n\t\t\t\tcts: cts,\n\t\t\t\tunits: sample.units,\n\t\t\t\tsize: sample.length,\n\t\t\t\tisKeyframe: isKeyframe,\n\t\t\t\tduration: sampleDuration,\n\t\t\t\toriginalDts: originalDts,\n\t\t\t\tflags: {\n\t\t\t\t\tisLeading: 0,\n\t\t\t\t\tdependsOn: isKeyframe ? 2 : 1,\n\t\t\t\t\tisDependedOn: isKeyframe ? 1 : 0,\n\t\t\t\t\thasRedundancy: 0,\n\t\t\t\t\tisNonSync: isKeyframe ? 0 : 1\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// allocate mdatbox\n\t\tmdatbox = new Uint8Array(mdatBytes);\n\t\tmdatbox[0] = (mdatBytes >>> 24) & 0xFF;\n\t\tmdatbox[1] = (mdatBytes >>> 16) & 0xFF;\n\t\tmdatbox[2] = (mdatBytes >>> 8) & 0xFF;\n\t\tmdatbox[3] = (mdatBytes) & 0xFF;\n\t\tmdatbox.set(MP4.types.mdat, 4);\n\n\t\t// Write samples into mdatbox\n\t\tfor (let i = 0; i < mp4Samples.length; i++) {\n\t\t\tlet units = mp4Samples[i].units;\n\t\t\twhile (units.length) {\n\t\t\t\tlet unit = units.shift();\n\t\t\t\tlet data = unit.data;\n\t\t\t\tmdatbox.set(data, offset);\n\t\t\t\toffset += data.byteLength;\n\t\t\t}\n\t\t}\n\n\t\tlet latest = mp4Samples[mp4Samples.length - 1];\n\t\tlastDts = latest.dts + latest.duration;\n\t\tlastPts = latest.pts + latest.duration;\n\t\tthis._videoNextDts = lastDts;\n\n\t\t// fill media segment info & add to info list\n\t\tinfo.beginDts = firstDts;\n\t\tinfo.endDts = lastDts;\n\t\tinfo.beginPts = firstPts;\n\t\tinfo.endPts = lastPts;\n\t\tinfo.originalBeginDts = mp4Samples[0].originalDts;\n\t\tinfo.originalEndDts = latest.originalDts + latest.duration;\n\t\tinfo.firstSample = new SampleInfo(mp4Samples[0].dts,\n\t\t\tmp4Samples[0].pts,\n\t\t\tmp4Samples[0].duration,\n\t\t\tmp4Samples[0].originalDts,\n\t\t\tmp4Samples[0].isKeyframe);\n\t\tinfo.lastSample = new SampleInfo(latest.dts,\n\t\t\tlatest.pts,\n\t\t\tlatest.duration,\n\t\t\tlatest.originalDts,\n\t\t\tlatest.isKeyframe);\n\t\tif (!this._isLive) {\n\t\t\tthis._videoSegmentInfoList.append(info);\n\t\t}\n\n\t\ttrack.samples = mp4Samples;\n\t\ttrack.sequenceNumber++;\n\n\t\t// workaround for chrome < 50: force first sample as a random access point\n\t\t// see https://bugs.chromium.org/p/chromium/issues/detail?id=229412\n\t\tif (this._forceFirstIDR) {\n\t\t\tlet flags = mp4Samples[0].flags;\n\t\t\tflags.dependsOn = 2;\n\t\t\tflags.isNonSync = 0;\n\t\t}\n\n\t\tlet moofbox = MP4.moof(track, firstDts);\n\t\ttrack.samples = [];\n\t\ttrack.length = 0;\n\n\t\tLog.i(this.TAG, \"send onMediaSegment video\");\n\t\tthis._onMediaSegment('video', {\n\t\t\ttype: 'video',\n\t\t\tdata: this._mergeBoxes(moofbox, mdatbox).buffer,\n\t\t\tsampleCount: mp4Samples.length,\n\t\t\tinfo: info\n\t\t});\n\t}\n\n\t_mergeBoxes(moof, mdat) {\n\t\tlet result = new Uint8Array(moof.byteLength + mdat.byteLength);\n\t\tresult.set(moof, 0);\n\t\tresult.set(mdat, moof.byteLength);\n\t\treturn result;\n\t}\n\n}\n\nexport default MP4Remuxer;\n"],"names":["Log","static","INFO","level","tag","txt","tmpLevel","LEVEL","loglevels","OFF","callstack","_getStackTrace","shift","color","TRACE","DEBUG","WARN","ERROR","CRITICAL","_print","WITH_STACKTRACE","console","group","groupCollapsed","i","length","log","groupEnd","dont","exist","e","stack","lines","split","push","msg","_output","_concatArrayBuffers","bufs","result","Uint8Array","reduce","totalSize","buf","byteLength","offset","set","_stringToByteArray","str","bytes","char","charCodeAt","_numberToByteArray","num","buffer","ArrayBuffer","DataView","setFloat64","slice","call","_byteArrayToNumber","ba","view","forEach","b","setUint8","getFloat64","_byteArrayToString","ret","String","fromCharCode","defaultConfig","enableWorker","enableStashBuffer","stashInitialSize","undefined","isLive","lazyLoad","lazyLoadMaxDuration","lazyLoadRecoverDuration","deferLoadAfterSourceOpen","autoCleanupSourceBuffer","autoCleanupMaxBackwardDuration","autoCleanupMinBackwardDuration","statisticsInfoReportInterval","fixAudioTimestampGap","accurateSeek","seekType","seekParamStart","seekParamEnd","rangeLoadZeroStart","customSeekHandler","reuseRedirectedURL","headers","customLoader","TransmuxingEvents","DemuxErrors","TAG","messageType","messageLength","timestamp","extendedTimestamp","message_stream_id","payload","constructor","this","setMessageLength","addPayload","clearPayload","getBytes","header","setMessageType","message_type","getMessageType","getMessageStreamID","setMessageStreamID","messageStreamID","getPayloadlength","getTimestamp","setMessageTimestamp","setExtendedTimestamp","yes","getExtendedTimestamp","setTimestampDelta","timestamp_delta","data","bytesMissing","getPayload","message_length","getMessageLength","isComplete","chunk_stream_id","CHUNK_SIZE","message","p","fmt","_getHeaderBytes","basic_header","setChunkSize","size","setChunkStreamID","setTimestamp","UserControlMessage","event_type","event_data1","event_data2","getEventMessage","o","events","setType","setEventData","event_data","ProtocolControlMessage","pcm_type","setPayload","pcm_types","WindowAcknowledgementSize","MessageStreamID","BandWidth","socket","netstreams","handler","parseMessage","m2","chunk","send","createStream","RuntimeException","_message","name","toString","IllegalStateException","super","InvalidArgumentException","mimeType","duration","hasAudio","hasVideo","audioCodec","videoCodec","audioDataRate","videoDataRate","audioSampleRate","audioChannelCount","width","height","fps","profile","refFrames","chromaFormat","sarNum","sarDen","metadata","segments","segmentCount","hasKeyframesIndex","keyframesIndex","audioInfoComplete","videoInfoComplete","isSeekable","getNearestKeyframe","milliseconds","table","keyframeIdx","_search","times","index","fileposition","filepositions","list","value","idx","last","mid","lbound","ubound","Math","floor","checkContinuation","uint8array","start","checkLength","array","decodeUTF8","out","input","ucs4","join","le","setInt16","Int16Array","AMF","parseValue","parseString","isObjectEnd","objectEnd","parseObject","getUint16","getUint32","v","getInt16","Date","type","getUint8","amfstr","terminal","amfobj","amfvar","parseVariable","strictArrayLength","val","date","parseDate","amfLongStr","SPSParser","src","src_length","dst","dst_idx","rbsp","_ebsp2rbsp","gb","_buffer","_buffer_index","_total_bytes","_total_bits","_current_word","_current_word_bits_left","destroy","_fillCurrentWord","buffer_bytes_left","bytes_read","min","word","subarray","readBits","bits","bits_need_left","bits_read_next","result2","readBool","readByte","_skipLeadingZero","zero_count","readUEG","leading_zeros","readSEG","profile_idc","level_idc","profile_string","getProfileString","level_string","getLevelString","chroma_format_idc","chroma_format","bit_depth","scaling_list_count","_skipScalingList","pic_order_cnt_type","num_ref_frames_in_pic_order_cnt_cycle","ref_frames","pic_width_in_mbs_minus1","pic_height_in_map_units_minus1","frame_mbs_only_flag","frame_crop_left_offset","frame_crop_right_offset","frame_crop_top_offset","frame_crop_bottom_offset","sar_width","sar_height","fps_fixed","fps_num","fps_den","aspect_ratio_idc","num_units_in_tick","time_scale","sarScale","crop_unit_x","crop_unit_y","codec_width","codec_height","present_width","ceil","chroma_format_string","getChromaFormatString","frame_rate","fixed","sar_ratio","codec_size","present_size","count","last_scale","next_scale","delta_scale","toFixed","chroma","MP4","types","avc1","avcC","btrt","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","sdtp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trun","trex","tkhd","vmhd","smhd","hasOwnProperty","constants","FTYP","STSD_PREFIX","STTS","STSC","STCO","STSZ","HDLR_VIDEO","HDLR_AUDIO","DREF","SMHD","VMHD","datas","Array","prototype","arguments","arrayCount","meta","box","timescale","trackId","id","presentWidth","presentHeight","xmhd","codec","mp3","channelCount","sampleRate","config","configSize","concat","avcc","codecWidth","codecHeight","track","baseMediaDecodeTime","sequenceNumber","samples","sampleCount","flags","isLeading","dependsOn","isDependedOn","dataSize","cts","hasRedundancy","isNonSync","init","SampleInfo","dts","pts","originalDts","isSync","isSyncPoint","MediaSegmentInfo","beginDts","endDts","beginPts","endPts","originalBeginDts","originalEndDts","syncPoints","firstSample","lastSample","appendSyncPoint","sampleInfo","MediaSegmentInfoList","_type","_list","_lastAppendLocation","isEmpty","clear","_searchNearestSegmentBefore","_searchNearestSegmentAfter","append","mediaSegmentInfo","msi","lastAppendIdx","insertIdx","splice","getLastSegmentBefore","getLastSampleBefore","segment","getLastSyncPointBefore","segmentIdx","Browser","ua","self","navigator","userAgent","toLowerCase","match","exec","indexOf","platform_match","matched","browser","version","majorVersion","platform","versionArray","major","parseInt","string","minor","build","chrome","opr","safari","webkit","rv","iemobile","msie","edge","msedge","opera","android","key","Object","assign","detect","command","transaction_id","command_object","additionalInfo","params","parseAMF0","from","obj","var_type","len","_parseAMF0Object","o2","keylen","keyName","param","keylength","getCommand","getTransactionId","getCommandObject","getAdditionalInfo","port","host","message_handler","wss_manager","wss","open","callback","WebSocket","binaryType","onopen","onclose","postMessage","onerror","registerMessageHandler","cb","onmessage","getSocket","getHost","close","addEventListener","cmd","success","handshake","state","onHandshakeDone","c1","c2","processServerInput","do","_generateC1","random","time","round","now","_generateC2","s1","_parseS0","_parseS1","_parseS2","_compare","ar1","ar2","netconnections","trackedCommand","chunk_parser","chunkstreams","conn_worker","parseChunk","newdata","header_length","payload_length","csid","onMessage","consumed","media_handler","_config","_onError","_onMediaInfo","_onMetaDataArrived","_onScriptDataArrived","_onDataAvailable","_onTrackMetadata","_dispatch","_hasAudio","_hasVideo","_hasAudioFlagOverrided","_hasVideoFlagOverrided","_audioInitialMetadataDispatched","_videoInitialMetadataDispatched","_mediaInfo","_metadata","_audioMetadata","_videoMetadata","_naluLengthSize","_timestampBase","_timescale","_duration","_durationOverrided","_referenceFrameRate","_flvSoundRateTable","_mpegSamplingRates","_mpegAudioV10SampleRateTable","_mpegAudioV20SampleRateTable","_mpegAudioV25SampleRateTable","_mpegAudioL1BitRateTable","_mpegAudioL2BitRateTable","_mpegAudioL3BitRateTable","_videoTrack","_audioTrack","_littleEndian","bytePos","_transmuxer","_emitter","ListenerList","event","listener","addListener","removeListener","entry","removeAllListeners","emit","_currentSegmentIndex","_ioctl","_pendingSeekTime","_pendingResolveSeekPoint","_statisticsReporter","_remuxer","_isLive","_dtsBase","_dtsBaseInited","_audioDtsBase","Infinity","_videoDtsBase","_audioNextDts","_videoNextDts","_audioStashedLastSample","_videoStashedLastSample","_audioMeta","_videoMeta","_audioSegmentInfoList","_videoSegmentInfoList","_onInitSegment","_onMediaSegment","_forceFirstIDR","_fillSilentAfterSeek","_mp3UseMpegAudio","_fillAudioTimestampGap","onInitSegment","onMediaSegment","insertDiscontinuity","seek","remux","audioTrack","videoTrack","_calculateDtsBase","_remuxVideo","_remuxAudio","_onTrackMetadataReceived","metabox","container","mediaDuration","flushStashedSamples","videoSample","audioSample","force","dtsCorrection","firstDts","lastDts","refSampleDuration","mpegRawTrack","firstSegmentAfterSeek","insertPrefixSilentFrame","mdatbox","mdatBytes","pop","sample","unshift","firstSampleOriginalDts","originalCodec","distance","firstSampleDts","videoSegment","silentUnit","silentFrameDuration","unit","mp4Samples","needFillSilentFrames","silentFrames","sampleDuration","curRefDts","maxAudioFramesDrift","frameCount","j","intDts","intDuration","frame","apply","latest","moofbox","info","_mergeBoxes","timestampOffset","firstPts","lastPts","isKeyframe","syncPoint","units","_onRemuxerInitSegmentArrival","bind","_onRemuxerMediaSegmentArrival","_mediaDataSource","_disableStatisticsReporter","on","off","stop","_internalAbort","_searchSegmentIndexContains","timestampBase","mediaInfo","setPrototypeOf","segmentInfo","_reportSegmentMediaInfo","initSegment","mediaSegment","seekpoint","is","ms","onTrackMetadata","onMediaInfo","onMetaDataArrived","onScriptDataArrived","onError","onDataAvailable","base","overridedDuration","overridedHasAudio","overridedHasVideo","resetMediaInfo","_isInitialMetadataDispatched","handleMediaMessage","tagType","_parseAudioData","_parseVideoData","_parseScriptData","scriptData","onMetaData","audiodatarate","videodatarate","framerate","keyframes","_parseKeyframesIndex","keys","tagTimestamp","soundSpec","soundFormat","soundRate","soundRateIndex","soundType","aacData","_parseAACAudioData","packetType","misc","samplingRate","mi","aacSample","_parseMP3AudioData","bitRate","mp3Sample","_parseAACAudioSpecificConfig","audioObjectType","originalAudioObjectType","samplingIndex","extensionSamplingIndex","samplingFrequence","channelConfig","requestHeader","ver","layer","bitrate_index","sampling_freq_index","channel_count","sample_rate","bit_rate","object_type","tagPosition","spec","frameType","codecId","_parseAVCVideoPacket","_parseAVCDecoderConfigurationRecord","_parseAVCVideoData","avcProfile","spsCount","sps","bitDepth","sarRatio","frameRate","codecArray","codecString","h","ppsCount","lengthSize","keyframe","naluSize","unitType","avcSample","mediainfo","_handleUserControlMessage","code","connect","connectionParams","_getNextChunkStreamID","options","play","streamName","pause","enable","receiveVideo","receiveAudio","_getNextMessageStreamID","application","appName"],"sourceRoot":""}